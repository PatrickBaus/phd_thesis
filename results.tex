\chapter{Results}
\label{sec:results}
\begin{chapquote}{Sir Terry Pratchett, \textit{A Hat Full of Sky}}
``It's still magic even if you know how it's done.''
\end{chapquote}

\section{Laser Current Driver}
For this project several commercial and in scientific literature publicly available laser current drivers were evaluated to assess their performance for the laser system discussed in section \ref{sec:prep_laser_system}. The following devices were tested for the requirements listed in \ref{lst:dgDrive_specs_environment} and \ref{lst:dgDrive_specs_electrical}.
\begin{itemize}
    \item Moglabs \device{DLC-102}
    \item Newport \device{TLB-6800-LN}
    \item Sisyph \device{SMC11 Puy Mary}
    \item Toptica \device{DCC 110}
    \item Vescent \device{D2-105}
    \item LQO \device{LQprO} \cite{datasheet_LQprO}
    \item A driver based on the work of \citeauthor{laser_driver_digital} \cite{laser_driver_digital}
\end{itemize}

As a disclaimer, Moglabs, Vescent and Sisyph provided demo units, free of charge, to the author and without any obligations regarding this work. The opinions and measurements in this work are in no way biased by this service.

All of the drivers presented claim to produce a very low-noise output current, but vary in features. The \device{DLC-102}, the \device{TLB-6800-LN} and the \device{D2-105} additionally include a Peltier controller. The former two also have an integrated modulation source that can, for example, be used to lock the laser to an external reference. The \device{TLB-6800-LN}, the \device{DCC 110} and the design by \citeauthor{laser_driver_digital} also feature a digital interface.

All drivers were compared to the requirements. although not all drivers have the required features, for example, like a remote accessible interface. Their performance was evaluated nonetheless to have a broader range of choices. A performance comparison can be found in the sections \ref{sec:output_impedance}, \ref{sec:results_current_noise} and \ref{sec:results_temperature_stability} . Unfortunately, not a single driver was able to properly drive the high compliance voltage required by the blue laser diode \device{PL 450B} \cite{datasheet_osram_pl450b} of about \qtyrange[range-units = single,range-phrase=\textup{~to~}]{6}{7}{\V} \cite{datasheet_osram_pl450b}. As it was discussed in section \ref{sec:compliance_voltage}, the compliance voltage of all laser drivers based on the design of \citeauthor{libbrecht_hall} \cite{libbrecht_hall} is limited to around \qtyrange[range-units = single,range-phrase=\textup{~to~}]{2}{3}{\V} at full output, see \ref{eqn:minimum_mosfet_vds} for details. Since the compliance voltage increases roughly proportional to the reciprocal of the output current multiplied by \qty{7}{\V}, limiting the maximum output current to about \qtyrange[range-units = single]{30}{40}{\percent} boosts the compliance voltage by up to \qty{5}{\V}. Not only does this limit the choice of drivers, but also requiring a \qty{500}{\mA} driver for a \qty{150}{\mA} laser diode seems excessive and does not help with the noise requirements because the output noise of the drivers scales with $I_{max}$ as detailed in section \ref{sec:current_source_noise} as the op-amp noise is the limiting factor. This lead to the decision to design a current source that meets all of the requirements, while surpassing the available alternatives and at the same time tackling the compliance voltage limit. This design and its individual components are discussed in the following sections. First, the state of the art is presented, then the problems encountered are outlined and finally the design design that resolves these issues is presented and the technical challenges are discussed.

\subsection{The State of the Art in Laser Current Drivers}
Prior to this work, all laser drivers commonly used for scientific purposes, were more or less strictly following the design proposed by \citeauthor{libbrecht_hall} \cite{libbrecht_hall}. This design was presented in 1993 and back then, blue laser diodes were were not available as these were developed in 1996. \citeauthor{blue_laser_diodes_history} \cite{blue_laser_diodes_history} gives for an interesting historic summary for the interested reader. In 2014, those efforts of Isamu Akasaki, Hiroshi Amano and Shuji Nakamura were then rewarded with the Nobel Prize in Physics. The original laser driver circuit was therefore designed for laser diodes requiring a low current and low compliance voltage compared to modern laser diodes. While the design remains useful for many low power near-infrared (NIR) laser diodes, these shortcomings were never addressed or even acknowledged by commercial alternatives. Sadly, the topic of the compliance voltage is usually not even mentioned in the datasheets -- the Moglabs \device{DLC-102} and Sisyph \device{SMC11} are notable exceptions, but it is unclear from the specification to which version and/or output currents of the devices the numbers relate. A comparison of features of these drivers is shown in table \ref{tab:laser_current_drivers_tested}. Do note, the Newport \device{TLB-6800-LN} is special with regard to the other drivers as it only works with with certain Newport laser heads. At startup it communicates with the laser head to determine parameters like the maximum current and voltage and refuses to start without the correct laser. It is included in the table for reference only because it came with the Newport \device{Vantage} laser that is part of the laser system presented in section \ref{} and its performance was assessed for this reason.
\begin{table}[ht]
    \centering
    \begin{tabularx}{0.95\linewidth}{l>{\raggedright\arraybackslash}Xl>{\raggedright\arraybackslash}X}
        \toprule
        Laser driver& Output current& Compliance voltage & Additional features \\
        \midrule
        Moglabs \device{DLC-102} & \textbf{\qty[text-series-to-math, reset-text-series = false, reset-math-version = false]{100}{\mA}}, \qty{250}{\mA}, \qty{500}{\mA}& \textbf{\qty[text-series-to-math, reset-text-series = false, reset-math-version = false]{6}{\V}}, \qty{3.2}{\V}  & TEC, PID, Piezo\\
        Newport \device{TLB-6800-LN} & & --& TEC, Piezo, Digital\\
        Sisyph \device{SMC11} & \qty{210}{\mA}, \textbf{\qty[text-series-to-math, reset-text-series = false, reset-math-version = false]{470}{\mA}}& \qty{5}{\V}&\\
        Toptica \device{DCC 110} & \textbf{\qty[text-series-to-math, reset-text-series = false, reset-math-version = false]{100}{\mA}}, \qty{500}{\mA}, \qty{3}{\A}, \qty{5}{\A} & --&\\
        Vescent \device{D2-105} & \qty{200}{\mA}, \textbf{\qty[text-series-to-math, reset-text-series = false, reset-math-version = false]{500}{\mA}} &  --& TEC\\
        LQO \device{LQprO} & \textbf{\qty[text-series-to-math, reset-text-series = false, reset-math-version = false]{140}{\mA}}, \qty{400}{\mA} & --&\\
        \bottomrule
    \end{tabularx}
    \caption{Overview of laser current drivers tested. Marked in bold is the version tested in this work. A dash denotes that no specification is given by the manufacturer.}
    \label{tab:laser_current_drivers_tested}
\end{table}

A quick overview of the individual drivers will now be given before proceeding to the performance test. This allows to better understand some of the design decisions affecting the device performance discussed later.

Starting with the Moglabs \device{DLC-102}, which is a fully integrated unit that includes a current driver, a piezo actuator (piezo) driver, a temperature controller for a thermoelectric cooler (TEC) and also a lock-in amplifier with a PID controller. It is the only driver that comes close to the required \qty{7}{\V} for the compliance voltage as it is specified for \qty{6}{\V}. It does not have any remote control capabilities though, but there is a monitoring output available. The high degree of integration makes this a very competitive solution.

The Vescent \device{D2-105} current source also features more than just the laser driver and includes a TEC controller as well, like the \device{DLC-102}. The output current can be adjusted via a 10-turn potentiometer, but also steered via an external input although this is not recommended by the manufacturer as it might degrade stability. It also the most expensive solution tested.

The Sisyph \device{SMC11} is the only rack-mountable unit, unlike the drivers discussed so far. The setpoint of the driver is adjusted via a recessed trimpot using a screwdriver and also externally using an input connector. The driver does not have any display and to read out the setpoints a voltmeter must be attached to the monitoring connector. It is the least expensive unit though.

The Toptica \device{DCC 110} is rack mounted as well. It comes with a separate display module, which connects via the backplane. The setpoint is adjusted with a 10-turn potentiometer and can additionally be adjusted via the backplane with an external signal.

The LQO \device{LQprO} is a solution that comes closest to the requirements, apart from the compliance voltage issue, as it is rack mounted and its output current can not only be adjusted via an analog input, but also using a 10-turn potentiometer.

The Newport \device{TLB-6800-LN} is the only driver, that has a digital interface and supports Standard Commands for Programmable Instruments (SCPI). It also incorporates a TEC controller and a piezo controller. As mentioned before this driver only works with the Newport \device{Vantage} laser it was sold with.

\subsection{Laser Driver: Design Concept}
It was outlined in the previous section that none of the low noise laser drivers commercially available or in scientific literature can properly drive new, and higher voltage, generations of laser diodes currently entering the market. These diodes include, for example, blue laser diodes or high power laser diodes like the \qty{780}{\nm} Thorlabs \device{L785H1}, which requires \qty{250}{\mA} at \qty{3}{\V} maximum. Since the ARTEMIS experiment requires a laser at \qty{441}{\nm} and novel quantum computing experiments need more laser power at \qty{780}{\nm}  a new laser driver design is presented in this work to cope with the high supply voltage demands without degrading other performance aspects, additionally fulfilling the requirements outlined in tables \ref{lst:dgDrive_specs_environment} and \ref{lst:dgDrive_specs_electrical}. The concept is, nonetheless, similar to the laser driver design presented by \citeauthor{libbrecht_hall} \cite{libbrecht_hall} because the application is related. To get a better understanding of the advances implemented, the previous state of the art proposed by \citeauthor{libbrecht_hall} will now be compared to the new system. The simplified version of the original design shown in figure \ref{fig:laser_driver_libbrecht_hall_concept} can be split into four building blocks. A supply voltage input filter, a reference voltage to create the setpoint, a unidirectional current source and some form of bidirectional current source used for modulating the laser current at high frequency. Each of these sections will be discussed in more detail. The chapters also list problems discovered and the solution proposed in the design presented here.
\begin{figure}[ht]
    \centering
    %\resizebox {0.8\textwidth} {!} {
        \import{figures/}{laser_driver_libbrecht_hall_concept.tex}
    %} % resizebox
    \caption{Building blocks of a laser driver based on \cite{libbrecht_hall}.}
    \label{fig:laser_driver_libbrecht_hall_concept}
\end{figure}

The original design is a straightforward approach and it is possible to reproduce it even on prototype printed circuit boards (PCBs), a key factor for its widespread use. This initial design was modified and improved in several publications by other authors. \citeauthor{laser_driver_digital} \cite{laser_driver_digital} replaced the potentiometer with a DAC, but left the other parts untouched. \citeauthor{laser_driver_qcl_taubman} \cite{laser_driver_qcl_taubman,laser_driver_qcl_taubman_multiplexer} published some extensive modifications, which not only replaced the reference circuit with a DAC and an \device{LTZ1000} reference, but also added extensive filtering of the supply. The changes introduced in this work go beyond any of the smaller modifications and present a fully revised system going beyond the capabilities of the original design.

\subsection{Power Supply}
Before moving to the discussion of the power supply filter, the power supply input is shown, which also contains additional safety features. As the device is rack mounted, it is installed in a slot of a 19-inch subrack. The standard power supply scheme used for most devices in this group is a dual \qty{\pm 15}{\V} supply. It is distributed using a  backplane in a 19-inch subrack. The subracks are, for example, Fischer Elektronik \device{BGT 384}. Into these, a backplane PCB \cite{git_backplane} can be fitted. The backplane has connectors for different modules and power connectors are laid out as standard \qty{4}{\mm} connectors allowing the use of rack mounted power supplies like a Keysight \device{6632B} or similar linear supplies. Each module in the subrack uses a male DIN41612 Type C, 64-pin connector to mate with the backplane. The pinout of this connector as used by the laser current drivers is shown in figure \ref{fig:laser_driver_connector}.
\begin{figure}[ht]
    \centering
    %\resizebox {0.8\textwidth} {!} {
        \import{figures/}{dgDrive_backplane.tex}
    %} % resizebox
    \caption{The default male DIN41612 backplane connector pin layout of the digital current controller.}
    \label{fig:laser_driver_connector}
\end{figure}

This layout is the default layout and configured on all standard units. Pins not marked both in figure \ref{fig:laser_driver_connector} and \ref{fig:laser_driver_connector_alternative}, are internally not connected and it does not pose a problem to connect other low voltage signals to those pins. For example, due to legacy compatibility with other devices, pins \numrange{30}{32} are normally tied together to \qty{-15}{\V} on the backplane and the same goes for pins \numrange{1}{3}, which are connected to \qty{15}{\V}.

There is also an alternative layout available, which can be configured using solder jumpers on the PCB. The secondary layout is similar to the layout used by Toptica and allows an upgrade path to replace existing hardware, but keeping the same subrack.
\begin{figure}[ht]
    \centering
    %\resizebox {0.8\textwidth} {!} {
        \import{figures/}{dgDrive_backplane_alternate.tex}
    %} % resizebox
    \caption{The alternative male DIN41612 backplane connector pin layout of the digital current controller.}
    \label{fig:laser_driver_connector_alternative}
\end{figure}

In order switch from one layout to another, consult table \ref{tab:jumper_power_supply_layout}.
\begin{table}[hb]
    \centering
    \begin{tabular}{lccl}
        \toprule
        Jumper& Default Layout& Alternative Layout & Function\\
        \midrule
        JP1 (bottom)& open& closed& Connect pin \num{31} to pin \num{2}\\
        JP2& closed& open\footnotemark& Disconnect pin \num{11} from pin \num{15}\\
        JP3& open& closed\addtocounter{footnote}{-1}\addtocounter{Hfootnote}{-1}\footnotemark& Connect digital supply to pin \num{12}\\
        JP4& closed& open\addtocounter{footnote}{-1}\addtocounter{Hfootnote}{-1}\footnotemark& Discconect digital supply from pin \num{2}\\
        \bottomrule
    \end{tabular}
    \caption{Jumper positions to enable different layouts. JP2 to JP3 are optional, see text.}
    \label{tab:jumper_power_supply_layout}
\end{table}

\footnotetext{optional, see text}
Jumper \num{1} is the on the backside of the PCB while the others are on the top side. Jumper \num{1} connects pins \num{2} to \num{31}. This layout is similar to the Toptica \device{DCC 110} current driver and allows the use of the \device{DgDrive} in existing racks. Do note the alternative layout is not fully compatible as the control pins are not supported and the manual of the \device{DCC 110} should be consulted first if other Toptica devices are still being used in the same rack. The system ground of the Toptica rack via pin \num{1} is currently not supported and must by wired using a small cable.

The alternative layout also offers an option for the digital supply, typically only used for development purposes. The digital power rail is normally fed from the same rail as the analog part and there is no disadvantage in doing so. Should the user nonetheless desire to drive the digital section from a separate supply, jumpers \numrange{2}{4} can be used to disconnect the digital supply from the analog side. The digital part of the laser driver is galvanically isolated and can be driven from a separate supply. Jumper \num{2} disconnects the digital ground at pin \num{11} from the system ground at pins \numrange{15}{18} and jumpers \numrange{3}{4} change the digital power supply over to pin \num{12}. A lower input voltage of \qty{5}{\V} is sufficient for the digital supply.

The digital current controller is equipped with advanced power supply protection features that ensure the device is not damaged due to incorrect handling. These protection features include over- and undervoltage protection, reverse polarity protection, reverse current protection, surge protection and circuitry that handles the correct power supply sequencing. The supply protection is available on all power pins and depends on the pin voltage rating. Table \ref{tab:jumper_power_supply_ratings} can be consulted for details regarding each rail.

\begin{table}[ht]
    \centering
    \begin{tabular}{lcc}
        \toprule
        Supply Rail& Working Range& Absolute Maximum \\
        \midrule
        \qty{+15}{\V}& \qtyrange[range-phrase=\textup{~to~}]{15}{18}{\V}& \qty{\pm 40}{\V} \\
        \qty{-15}{\V}& \qtyrange[range-phrase=\textup{~to~}]{-15}{-18}{\V}& \qty{\pm 40}{\V} \\
        \qty{+5}{\V} (layout 2)& \qtyrange[range-phrase=\textup{~to~}]{5}{18}{\V}& \qty{\pm 20}{\V} \\
        \bottomrule
    \end{tabular}
    \caption{Voltages above or below the absolute maximum rating may cause permanent damage to the device.}
    \label{tab:jumper_power_supply_ratings}
\end{table}

These types of protection are important in the context of the operating environment. Typically, in this lab, the subracks do not have an integrated power supply and are driven using an external laboratory bench supply like an HP/Keysight \device{6632B} \cite{datasheet_keysight6632B}, which is also mounted in the rack. Using this solution, there is no inherent protection against incorrectly setting up the power supply and no means to establish a foolproof procedure. These types of faults are furthered by the need to wire up two single channel power supplies for dual polarity. The most common error encountered by the author in this regard, was an incorrect polarity. Another problem experienced is associated with hot swapping.
\begin{figure}[ht]
    \centering
    \begin{subcaptionblock}{0.45\linewidth}
        %\scalebox{0.75}{%
        %\begin{minipage}[position][height][inner-pos]{width}
        \begin{minipage}[t][4.4cm]{\linewidth}
            \centering
            \import{figures/}{hot_swap_parasitics.tex}
        \end{minipage}
        %} % scalebox
        \caption{Power supply input parasitic elements forming an underdamped oscillator.}
        \label{fig:hot_swap_parasitics}
    \end{subcaptionblock}
    \begin{subcaptionblock}{0.45\linewidth}
        \centering
        %\scalebox{0.75}{%
            \input{images/hot_swap.pgf}
        %} % scalebox
        \caption{Simulated connection to a hot \qty{15}{\V} rail. The parameters were $L=\qty{3}{\uH}$, $R=\qty{10}{\milli\ohm}$ and $C=\qty{1}{\uF}$.}
        \label{fig:hot_swap_simulation}
    \end{subcaptionblock}
    \caption{Oscillations of the supply voltage caused by the parasitic cable inductance and hot swapping modules.}
    \label{fig:hot_swap_example}
\end{figure}

The issue arising from hot swapping is founded in the parasitic inductance of the power supply cable and the input capacitors of the device module. Figure \ref{fig:hot_swap_parasitics} shows a simplified model of those parasitic elements. The very low cable resistance is not enough to damp the LC resonator and upon insertion of a module into the subrack and there will be strong oscillations, easily surpassing the maximum voltage rating. Figure \ref{fig:hot_swap_simulation} shows a simulation with a \qty{3}{\m} cable between the power supply and the subrack having an estimated inductance of $L=\qty{3}{\uH}$ and a resistance of $R=\qty{10}{\milli\ohm}$. The input capacitance of the device is a \qty{1}{\uF} ceramic capacitor with a low equivalent series resistance (ESR). The latter value was taken from the circuit used by \cite{libbrecht_hall} as shown in figure \ref{fig:laser_driver_libbrecht_hall_filter}. The circuit designer must make sure that this LC circuit is (at best) critically damped. This is further discussed in section \ref{sec:supply_filtering} on page \pageref{eqn:lc_filter_rd}. Unfortunately, the length of the power supply cable is not under control and neither are neighbouring rack modules.

Ideally, hot swapping is therefore addressed by the backplane. Currently, most of the subracks in use do not have a dedicated backplane, but rather use directly wired connectors bolted to the subrack chassis. The backplane PCB mentioned above, will, in future, address this problem by adding bulk capacitors (and a damping network) directly on the backplane to bypass the inductance of the power supply cable. Additionally, inrush current limiting per port can be implemented to prevent modules with a large input capacitance loading the rail too much. This is part of the ongoing development and hot swapping is currently not supported for devices without proper inrush current limiting.

Experience has shown though, that contrary to advice, hot swapping is practised in the field, even if not supported. It is therefore mandatory to include a robust over- and undervoltage protection to safeguard against transient events like the one shown in figure \ref{fig:hot_swap_example} as harm to either the driver or laser diode can be costly. The protection system is designed to safely shut down the laser in case of a fault of any type.

The overvoltage protection against voltage spikes is realized using a \device{SMBJ40CA} \cite{datasheet_SMBJ-Q} \qty{40}{\V} bi-directional transient voltage suppressor (TVS) diode, while the undervoltage and reverse polarity protection uses an ADI \device{LTC4365} \cite{datasheet_LTC4365} controller and a Diodes Inc. \device{DMN6040SSD} \cite{datasheet_DMN6040SSD} dual \qty{60}{\V} MOSFET connected back-to-back. One MOSFET is used for reverse polarity protection, the other for overvoltage protection. The \device{LTC4365} controller will typically shut down the driver within \qty{< 5}{\us} after detecting the fault, preventing most, if not all, transient events to reach critical parts of the system. The \qty{40}{\V} limit was chosen because this is the upper voltage limit of most power supplies used for these applications in the lab. This makes sure that even considering worst case scenarios no damage to the driver or the laser diode can occur.

Another feature worth mentioning is the builtin inrush current limit. The current driver does have roughly \qty{1.1}{\milli\F} of capacitance on each rail, which needs to be charged at startup. This calls for inrush current limiting to prevent currents of several ampere from flowing. The \device{LTC4365} limits the inrush current to \qty{<100}{\mA} in order to prevent loading the power rails too much, affecting other devices sharing the same supply.

The full schematic of the input protection can be found in the GitHub repository at \cite{git_dgDrive}.

\subsection{Supply Filtering}
\label{sec:supply_filtering}
The supply section of the design by \citeauthor{libbrecht_hall} \cite{libbrecht_hall} as shown in figure \ref{fig:laser_driver_libbrecht_hall_concept} is simplified. The full input filter consists of a CLC filter or sometimes called \pi-filter shown in figure \ref{fig:laser_driver_libbrecht_hall_filter}. Due to the small input capacitance, the filter is basically just an LC filter regarding the filtering, but do note the use of low ESR ceramic capacitors as discussed in the previous section.
\begin{figure}[ht]
    \centering
    %\resizebox {0.8\textwidth} {!} {
        \import{figures/}{laser_driver_libbrecht_hall_supply_filter.tex}
    %} % resizebox
    \caption{Power supply filter of a laser driver based on \cite{libbrecht_hall}. The op-amps are driven by the unregulated filtered voltage and the current source is supplied by the \device{LM317}.}
    \label{fig:laser_driver_libbrecht_hall_filter}
\end{figure}

An LC filter is well suited for a low impedance source like a power supply, because it has a high input impedance. From the transfer function
\begin{equation}
    H(s) = \frac{\frac{1}{sC}}{sL + \frac{1}{sC}} = \frac{1}{s^2LC +1} = \frac{\frac{1}{LC}}{s^2 + \frac{1}{LC}} = \frac{\frac{1}{LC}}{\left(s+i\frac{1}{\sqrt{LC}}\right)\left(s-i\frac{1}{\sqrt{LC}}\right)}\,, \label{eqn:transfer_function_lc_filter}
\end{equation}
one can deduce, that the passband gain at DC is \num{1} (obviously) and additionally, there are two complex poles in the imaginary plane at $s = \frac{\pm i}{\sqrt{LC}}$, putting the cutoff frequency of the 2\textsuperscript{nd} order filter at $f_c = \qty{2.3}{\kHz}$. Due to the imaginary poles, there is some gain peaking at $f_c$. This can be solved by damping the filter as discussed later. An LC filter is fairly efficient at removing high frequency noise, if properly implemented, but low frequency noise like mains hum is left for the op-amp CMRR to suppress as discussed in section \ref{sec:current_source_noise} on page \pageref{sec:current_source_noise}. The paper of \citeauthor{libbrecht_hall} \cite{libbrecht_hall} shows some \qty{60}{\Hz} hum, but it is not clear wether is is introduced by the noise measurement setup or actually part of the laser current.
%TODO: Remeasure ripple noise
%Taking for example a low-noise switch-mode power supply like the Rohde \& Schwarz \device{HMP4040} used for compact high power designs, which does have fairly pronounced noise at the switching frequency at \qty{174}{\kHz} and harmonics \cite{hmp4040_noise}. The author measured these switching glitches to be about \qty{3}{\mV_{pp}} in a \qty{1}{\MHz} bandwidth. To estimate the noise injection into the diode current via the the supply lines one has to look at the two possible entry points. One is via the setpoint and the other through the op-amp supply pins. The former path is through the voltage regulator and heavily filtered by a low cutoff second order RC filter. This RC filter has enough suppression at \qty{170}{\kHz} if properly laid out to deal with the noise. The noise coming through power supply needs to get past the power rejection ratio (PSRR) of the op-amp. This value is around \num{5e-3} under ideal conditions \cite{datasheet_LT1028}.

To push the corner frequency of the filter below \qty{50}{\Hz} the product of the inductor value and the filter capacitor value has to be increased by about \num{6} orders of magnitude. Not an easy feat. The paper presented by \citeauthor{laser_driver_qcl_taubman} \cite{laser_driver_qcl_taubman} shows a brute-force approach. They applied very high values for the capacitor $C_{LC}$ and the inductor $L$ of the LC filter of \qty{10}{\milli\farad} and \qty{1}{\mH}. The cutoff frequency of this LC filter is about \qty{50}{\Hz}. The filter is then followed by a second filter with an even lower cutoff frequency. This implementation is shown in a simplified form in figure \ref{fig:laser_driver_taubman_filter} and is briefly discussed now. For a more detailed schematic and part names see \cite{laser_driver_qcl_taubman}.
\begin{figure}[ht]
    \centering
    %\resizebox {0.8\textwidth} {!} {
        \import{figures/}{laser_driver_taubman_filter.tex}
    %} % resizebox
    \caption{Power supply filter using a capacitance multiplier for a cutoff frequency of \qty{0.5}{\Hz}. This is a simplified schematic based on \cite{laser_driver_qcl_taubman}. Only the positive rail is shown.}
    \label{fig:laser_driver_taubman_filter}
\end{figure}

%\citeauthor{laser_driver_qcl_taubman} built this filter for a driver with an output current capacity of \qty{2}{\A}, which limits the size of the inductor that can be used, in order to make up for that, the author was forced to use giant capacitors. As a side note and a warning to the unsuspicious reader, the schematic shown by \citeauthor{laser_driver_qcl_taubman} \cite{laser_driver_qcl_taubman} omits a detail, which must be included, when handling such capacitances. The circuit must include a reverse polarity protection, or rather a reverse current protection, casually shown by \citeauthor{laser_driver_qcl_taubman} in a block diagram and not explicitly mentioned. If the input were shorted by accident, the \qty{10}{\milli\farad} of capacitance would immediately discharge via the parasitic body diode of the slow start-up transistor, likely vaporizing everything in its path. Such a protection can be implemented by adding a MOSFET (in reverse) to block the flow of current when the input drops below the voltage maintained by the capacitors.

% TODO: Add an appendix about the capacitance multiplier. See capacitance multipler/The Capacitance Multiplier Theory.pdf
The second stage of the filter is comprised of a capacitance multiplier, which is formed by wrapping a feedback loop around the 2\textsuperscript{nd} order filter created by $R_1 C_1$ and $R_2 C_2$. This feedback loop and the gain of the transistor allows to use only a very small part of the current to filter the main current going through $Q_1$, which in turn allows to use large values for $R_1$ and $R_2$ while maintaining a low output impedance of the filter. The properties of this construction will be analysed now, but the reader must be warned beforehand that the term capacitance multiplier is misleading. It neither multiplies the capacitance, nor does is behave like a real 2\textsuperscript{nd} order filter. This circuit was given the name capacitance multiplier because the output does not see $R_1$ (or $R_2$), but rather the fraction $\frac{1}{1+\beta}$ of it (roughly). Since the RC constant is still the same, the capacitor looks bigger on the output. Unfortunately, this effect highly depends on the characteristics of the transistor, which in turn depends on the operating conditions. The gain $\beta$ (or $h_{fe}$) of a transistor, for example, drops with increasing output current (although it rises with temperature). Since the transistor does not store energy like a capacitor the maximum ripple voltage that can be filtered by the capacitance multiplier depends on the voltage dropped across the transistor as its regulation headroom. This means the maximum input ripple must stay below the output voltage plus a diode drop of \qty{0.6}{\V} for the base-emitter diode. If more ripple rejection is required an additional resistor from the base of $Q_2$ to ground like shown as $R_b$ in figure \ref{fig:laser_driver_taubman_filter} can be applied. This increases the voltage dropped across $Q_1$. The downside is a reduced output voltage and more power burnt in the transistor. Another issue stems from the Early effect, which is similar to the channel-length modulation discussed in section \ref{sec:mosfet_current_source}. The Early effect can be represented as an output impedance $R_o$ in the small-signal model as well, just like the MOSFET model shown in figure \ref{fig:mostfet_small_signa_model_model_norton} on page \pageref{fig:mostfet_small_signa_model_model_norton}. This connection from collector to emitter typically limits the suppression to \numrange{500}{1000} (\qtyrange[range-phrase={~to~}]{50}{60}{\decibel}). For more details on the Early effect and bipolar transistors in general see \cite{transistor_bible,fet_equations}. The capacitance multiplier is very useful at low frequencies though because it can reach cutoff frequencies otherwise unreachable as it is shown in the publication of \citeauthor{laser_driver_qcl_taubman} \cite{laser_driver_qcl_taubman}.

%This means it will also drop about \qty{1.2}{\V} at \qty{500}{\mA} and about \qty{0.3}{\V} at \qty{1}{\mA}. The \qty{2}{\V} drop is also not a problem in this use case and even comes in handy. If just the supply rail of the laser diode current is fed through the capacitance multiplier, as it is the most sensitive, and the supply rail for the op-amps is not, then those extra \qty{2}{\V} will do not be a problem. In section \ref{sec:component_selection} it was already mentioned, that for example the \device{AD797} op-amp needs a supply that is \qty{3}{\V} above the diode supply. This means, that less voltage needs to be dropped by the linear regulator that follows the filter.
%A final point regarding the capacitance multiplier is the output resistance. A bipolar transistor has an output resistance similar to a diode, it increases with decreasing current.
To sum it up, the capacitance multiplier behaves like an ordinary RC filter, but with a lower output impedance compared to the RC filter and only works at low ripple voltages The filtering performance is limited by the Early effect, but it is very effective at low frequencies, which cannot be reached otherwise.
\begin{figure}[ht]
    \centering
    %\resizebox {0.8\textwidth} {!} {
        \import{figures/}{laser_driver_dgdrive_supply_filter.tex}
    %} % resizebox
    \caption{Power supply filter of the digital current driver. The component values are only given for the positive side. The passive components are same for both rails.}
    \label{fig:laser_driver_dgdrive_filter}
\end{figure}

% Note: 'Minimizing Input Filter Requirements In Military Power Supply Designs' has a more elaborate design
The power supply filter of the digital current driver shown in figure \ref{fig:laser_driver_dgdrive_filter} uses a similar design. The design shown in figure \ref{fig:laser_driver_dgdrive_filter} is only valid for PCB revisions <2.4.0, which comprises the first batch of units. Later revisions use a revised circuit as discussed below. A passive LC filter is applied first, then the analog supply rail for the op-amps and other monitoring functions is branched off while the laser diode supply voltage is fed into a capacitance multiplier. The negative rail is mirrored from the positive rail with same passive components but PNP instead of NPN transistors and vice versa. The diode supply and the analog rail, which is taken before the capacitance multiplier, are both going to low noise post-regulators, the ADI \device{LT3045} and its negative counterpart, the ADI \device{LT3094}. Both regulators have excellent power supply ripple rejection (PSRR) out to at least \qty{1}{\MHz} of more than \num{e3}. At low frequency the PSRR is even higher and more than \num{e5} can be expected. This allows a combined PSRR of better than \num{e6} from low to high frequencies, even beyond \qty{1}{\MHz}. The design and the choice of components for this filter will now explored in more detail before proceeding to the measurement of the rejection ratio.

Going back to equation \ref{eqn:transfer_function_lc_filter}, it was shown that the undamped LC filter is prone to ringing at the cutoff frequency because the filter poles are imaginary. To address this, there are several solutions. The most simple one is to add a damping element either in parallel to the capacitor or in parallel the inductor. In this case a damping element in parallel to the capacitor was chosen, because placing such an element in parallel with the inductor will degrade the filter performance by making the blocking inductor lossy. Such a damping element is typically a capacitor with a series resistor or a simple lossy capacitor with a high ESR. Using the arrangement shown in figure \ref{fig:laser_driver_dgdrive_filter}, the new transfer function can be calculated.
\begin{align}
    H(s) &= \frac{Z_2}{Z_1 + Z_2} \nonumber\\
    Z_1 &= sL_1 \nonumber\\
    Z_2 &= \left(R_d + Z_{C_d}\right) || Z_{C_1} = \left(R_d + \frac{1}{s C_d}\right) || \frac{1}{s C_1} = \left(\left(R_d + \frac{1}{sC_d}\right)^{-1} + sC_1\right)^{-1} \nonumber\\
    &= \frac{s C_d R_d +1}{s^2 C_1 C_d R_d + s \left(C_1 C_d\right)}\\
    H(s) &= \frac{\frac{s C_d R_d +1}{s^2 C_1 C_d R_d + s \left(C_1 C_d\right)}}{s L_1  + \frac{s C_d R_d +1}{s^2 C_1 C_d R_d + s \left(C_1 C_d\right)}} = \frac{s C_d R_d +1}{s^3 L_1 C_1 C_d R_d + s^2 L_1 \left(C_1 + C_d\right) + s C_d R_d +1 }
\end{align}

% TODO: Add derivation, because the Middlebrook paper is hard to come by. This is already prepared in 'Input Filter Derivation.pdf' and Input Filter Theory.pdf', but needs to be checked again.
This is the transfer function of a 3\textsuperscript{rd} order filter as there are three energy storage elements. This type of filter was discussed by \citeauthor{input_filter_middlebrook_solution} \cite{input_filter_middlebrook_solution} (reprinted in \cite{input_filter_middlebrook_reprint1} and \cite{input_filter_middlebrook_reprint2}). \citeauthor{input_filter_middlebrook_solution} concluded, that there is an optimal value for the series resistance $R_d$ given a capacitance $C_d$ and the filter components $L_1$ and $C_1$. This optimal value has minimal gain peaking, hence a minimal quality factor $Q$ at the resonance frequency. The existence of such an optimal value can be easily understood from the fact, that if $R_d = \infty$ the resonance frequency is $\omega_0 = \frac{1}{\sqrt{L_1 C_1}}$ and in case $R_d = 0$ it is $\omega_1 = \frac{1}{\sqrt{L_1 \left(C_1 + C_d\right)}}$. In between $\omega_0$ and $\omega_1$, there is a lossy zone, where $R_d$ due to its lossy nature reduces $Q$, but at both ends $Q = \infty$, so there must be a minimum in between. By calculating the minimum value of the output impedance at the point of resonance, \citeauthor{input_filter_middlebrook_solution} \cite{input_filter_middlebrook_solution} found the following results:
\begin{align}
    R_0 &\coloneqq \sqrt{\frac{L_1}{C_1}}\\
    n &\coloneqq \frac{C_d}{C_1} \Rightarrow C_d = n C_1 \label{eqn:lc_filter_cd}\\
    Q_{optimal} &= \sqrt{\frac{(4+3 n) (2+n)}{2 n^2 (4+n)}}\\
    R_d &= R_0 \cdot Q_{optimal} \label{eqn:lc_filter_rd}
\end{align}

% TODO: Derive the 2x T / 10 K rule. This is prepared in 'Capacitor life doubles theory.pdf'.
From these equations, it can be seen, that the damping capacitor $C_d$ needs to be fairly large, depending on $n$. A critically damped system with $Q = \num{0.5}$ would be preferred, but this would require $n \approx 5.9$ making $C_d$ prohibitively large. For this filter $n=3.9$ was chosen because there was a capacitor with a small diameter available at this capacitance, making the filter slightly underdamped. A bit of gain peaking at the resonance can therefore be expected. The following components were chosen. First, a large, low resistance inductor $L_1$ capable of carrying at least \qty{1}{\A} was selected. In this case a Coilcraft \device{MSS1210-125KEB}. High reliability capacitors were chosen to ensure a long lifetime of the device. Using capacitors rated with a lifetime of \qty{5000}{\hour} at \qty{105}{\celsius} gives a expected service life at \qty{60}{\celsius} of more than \qty{10}{\year}, when assuming an Arrhenius law with a doubling of the lifetime every \qty{10}{\kelvin}. Apart from the reliability of the capacitors, there are no special requirements for them as there is little ripple current to be expected. The input power supply is supposed to be a filtered low noise supply and not the unfiltered output of a DC/DC regulator. So it is possible to maximize $L_1$ and choose a physically smaller $C_1$ since board space is limited. This results in the following design values, calculated from equations \ref{eqn:lc_filter_cd} and \ref{eqn:lc_filter_rd}, given the components values discussed above.
\begin{align*}
    L_1 &= \qty{1.2}{\mF} & C_1 &= \qty{100}{\uF}\\
    C_d &= \qty{400}{\uF} \approx \qty{390}{\uF} & n &= 3.9\\
    Q_{optimal} &\approx \num{0.62} & R_d & \approx \qty{2.15}{\ohm}\\
    f_c &\approx \qty{300}{\Hz}
\end{align*}

Do note, that $R_d$ does include the ESR of $C_d$, so the ESR of the capacitor must be subtracted from the final value of the damping resistor placed on the board. This may even absolve one from the need for a discrete resistor if the ESR of the capacitor is high enough.

While the LC filter has a cutoff frequency of \qty{300}{\Hz} the capacitance multiplier can go far lower. The RC filter with \qty{10}{\kilo\ohm} and \qty{10}{\uF} formed by $R_m$ and $C_m$ has a cutoff frequency of \qty{1.6}{\Hz}. Only a single order filter filter was chosen because of the suppression limit imposed by the Early voltage discussed above. The attainable suppression of 30 (\qty{30}{\decibel}) at \qty{50}{\Hz} is sufficient. The transistors chosen were a combination of a Toshiba \device{TTA004B}/\device{TTC004B} and Onsemi \device{BC817-40}/\device{BC807-40} for the positive/negative rail. The \device{TTA004B}/\device{TTC004B} are good up to about \qty{500}{\mA}. At this point the gains start dropping. A higher power transistor like the Onsemi \device{D45H8}/\device{D44H8} is recommended for currents above \qty{500}{\mA}. The two transistors are configured as a Sziklai pair, which is similar to a Darlington pair but reduces the voltage drop across the transistors from two base-emitter diode drops of \qty{1.2}{\V} to \qty{0.6}{\V}.

A low cutoff frequency always implies a long start up time until the filter has settled. To reduce this time a fast startup circuit highlighted in green in figure \ref{fig:laser_driver_dgdrive_filter} is used. At startup, the capacitor $C_m$ at the base of $Q_2$ is still discharged and \qty{15}{\V} will be applied. It will then begin to charge with a current of \qty{1.5}{\mA} through the \qty{10}{\kilo\ohm} resistor $R_m$. Because the $Q_2$ is an emitter follower, the emitter follows the voltage at the base (minus a diode drop for the base-emitter diode) and the output rises like the RC filter. To reduce this time, $R_m$ needs to be bypassed. This is the purpose of the LED, a \qty{625}{\nm} Würth Elektronik \device{150080RS75000}. Applying the input voltage of \qty{15}{\V} at startup the LED it will start conducting immediately while dropping \qtyrange[range-units = single]{1.8}{2}{\V}. The current flowing into $C_m$ is then dependent on the diode series resistor, which was chosen to be \qty{680}{\ohm}, a value particularly important in this case because it limits the inrush current of the whole circuit due to the emitter follower. At startup about \qty{20}{\mA} will flow into $C_m$ through the LED. Since $Q_2$ and $Q_1$ act as emitter follower the emitter will follow the voltage of the base. So for every \qty{10}{\uF} of capacitance in the system a current of \qty{20}{\mA} will flow through $Q_1$ into the system. With a \qty{100}{\uF} capacitor at the output and assuming another \qty{100}{\uF} of distributed bypassing capacitance around the board, this is around \qty{400}{\mA}, which is still well below the damage threshold of the transistors (\qty{2.5}{\A} and \qty{0.5}{\A}), while \qty{20}{\mA} is below that of the LED (\qty{30}{\mA}), but these values must be kept in mind and $R_{led}$ increased accordingly when adding larger output capacitors. The fast startup circuit ensures an output voltage of \qty{13}{\V} within \qty{220}{\ms} instead of around \qty{0.5}{\second}, reducing the time to boot and leaving more time for self-checks without impacting the user experience.

To get a better understanding of the full frequency response of the filter, it was simulated using LTSpice. The simulation was conducted with a load current of \qty{500}{\mA} running through the capacitance multiplier to simulate the worst case because as discussed above, the current gain $\beta$ of the transistor drops at higher currents as the transistor saturates. The simulation source file can be found at \external{source/spice/input\_filter\_dgdrive.asc}. The simulation also includes the series resistance and parasitic parallel capacitance of the filter inductor $L_1$. The latter is the cause of the self resonance frequency of the inductor at \qty{1}{\MHz} and marks the usable upper bound of the filter after which the attenuation drops due to the capacitive coupling between the conductor windings.

The suppression of this LC filter is an order of magnitude better than the filter used by \citeauthor{libbrecht_hall} not including the high performance regulators that follow. The transfer function for both the damped LC filter and the filter with the capacitance multiplier in series is plotted in figure \ref{fig:laser_driver_input_filter}. The LC filter shows the expected self resonance peak at \qty{1}{\MHz} that is not damped by the inductor resistance. This is not critical and only marks the limit of the filter as can be seen from the output impedance plot. There is enough capacitance present to make up for the increasing output impedance of the inductor. The output impedance above \qty{1}{\MHz} is dominated by local bypass capacitors and not accurately represented by the simulation. It can be expected to be even lower than the simulated results, which do not include these distributed capacitors.
\begin{figure}[ht]
    \centering
    \input{images/input_filter_dgdrive.pgf}
    \caption{Simulated transfer function of the two stage input filter used in the digital current driver. Both magnitude and output impedance of the stages are shown.}
    \label{fig:laser_driver_input_filter}
\end{figure}

As discussed above the LC filter is not  critically but rather underdamped, which can also be seen in the output impedance that peaks at the corner frequency of \qty{300}{\Hz}. This peaking increases the output impedance of \qty{1.2}{\ohm} in the passband, which is mostly the resistance of the inductor, to a total of \qty{1.8}{\ohm}.

The rejection ratio of the LC filter and the capacitance multiplier combined is better than \num{e6} at \qty{100}{\kHz} and beyond. This can be anticipated to keep switch-mode noise away from the laser driver current.

The high rejection ratio of the filter is expected to make the the experimental validation rather challenging because there are a number of complications that derive from the active nature of the circuit. The capacitance multiplier must be loaded, preferably at the maximum current to show the worst case and additionally, the ripple voltage must be low enough to not saturate the capacitance multiplier.

This requires a highly sensitive vector network analyser (VNA) that has a low frequency range. This setup uses an Omicron Lab \device{Bode 100}, which can measure from \qty{1}{\Hz} to \qty{50}{\MHz} with an exceptionally low noise floor of about \qty[power-half-as-sqrt, per-mode=symbol]{180}{\nV \Hz\tothe{-0.5}} \cite{datasheet_bode100}. Additionally a Stanford Research \device{SR560} was used as a preamplifier. To apply the ripple voltage to the power supply rails a Picotest \device{J2123A} negative line injector and a self-designed positive line injector was used. The positive line injector design is available open-source and can be found in a GitHub repository at \cite{line_injector_github}. This injector is called \device{PB02}. During the measurement, it was found, that since the expected signal is extremely small, ground currents became an issue. There is an inherent ground loop issue built into the VNA. The output and the two inputs of the \device{Bode 100} are not isolated. The measurement is a 3-port measurement as shown in figure \ref{fig:laser_driver_supply_filter_measurement}. The \device{Bode 100} is driving the line injectors, measuring the signal going into the line injector and also sampling the signal across the output capacitor of the filter. The ground current now has two choices of flowing. One is through the low side of the measurement cables and their resistance, or through the ground plane of the VNA. The latter is the dreaded ground loop. This ground loop becomes more pronounced at higher frequencies, because the return path trough the cable is inductive and its impedance increases with frequency. Typically this problem would be addressed using a common-mode choke inserted into CH2. CH2 is the VNA input measuring the filter output. This common-mode choke prevents any current flowing through CH2, that has not flown through the cable.
%TODO: Add devices to the image
\begin{figure}[ht]
    \centering
    \resizebox {0.9\textwidth} {!} {
        \import{figures/}{laser_driver_dgdrive_supply_filter_measurement_setup.tex}
    } % resizebox
    \caption{Power and grounding scheme for a low noise measurement of the line filter rejection ratio, minimizing the interfernce of circuit return currents.}
    \label{fig:laser_driver_supply_filter_measurement}
\end{figure}

%TODO: Add an image showing the ground loop, the Bode 100 and the 2-port shunt-thru measurement.
Unfortunately, the author did not have a suitable common mode choke at hand, so the only feasible solution to at least suppress the ground loop at low frequencies was to add transformers at the output and the input of CH2. This isolates the output while the battery powered \device{SR560} is driving the VNA via the transformer, isolating the input as well. The transformer used for isolating the VNA output, was an injection transformer named \device{PB01}. It is center tapped to create an anti-symmetrical output for the line injectors. The center tap reduces the output amplitude by one half. The details regarding this device and its construction can be found in annex \ref{sec:injection_transformer}. The transformer used at the output of the \device{SR560} is a Picotest \device{J2123A}. Both transformers are unfortunately injection transformers and not dedicated isolation transformers as discussed in annex \ref{sec:injection_transformer}, yet the only transformers available at the time. The consequences of this subtle detail will become imminent in a moment.

The digital current driver is powered by a Rohde \& Schwarz \device{HMP4040} and there is a single point of ground connected to protective earth at the power supply. The power supply feeds into the line injectors, through which the current driver is powered. The output current is set to \qty{500}{\mA} across a \qty{10}{\ohm} dummy resistor. The SR560 measures the ripple voltage after the LC filter and drives the VNA input via the transformer. The measurement cable used is a short  twisted pair to reduce noise pickup.

The output of the VNA was set to \qty{-27}{\dB m} (\qty{10}{\mV_{rms}}), which must by multiplied by about $0.5 \cdot 0.975 = 0.485$ to give the ripple voltage seen on the positive supply, the latter term comes from the line injector \cite{line_injector_github}. To put this into perspective, given a \qty{-60}{\dB} (\num{e-3}) suppression, results in a ripple voltage of only \qty{4.9}{\uV_{rms}}.
\begin{figure}[ht]
    \centering
    \input{images/dgDrive_supply_filter_bode.pgf}
    \caption{Measured response of input filter used in the digital current driver. Above \qty{10}{\kHz} capacitive coupling through the transformer can be seen.}
    \label{fig:laser_driver_input_filter_bode}
\end{figure}

Figure \ref{fig:laser_driver_input_filter_bode} shows the measurement of the LC filter output. At low frequencies, there is good agreement with the simulation and the filter rolls off with \qty{-40}{\dB \per decade}. At around \qty{10}{\kHz} and \qty{-55}{\dB} the noise floor of the measurement is reached. Then the ground loop manifests itself again coupling through the transformers. The magnitude rising with \qty{20}{\dB \per decade} is an artifact, which can be significantly influenced by changing the type of probing and the location of probing. To record any usable data above \qty{10}{\kHz} a common-mode choke is required. Additionally the noise floor of the measurement is reached at around the same frequency, requiring a lower noise amplifier. Due to the lack of another amplifier and the choke, the author left the measurement as is. It is still a good example to show the ground loop pitfalls of a 2 or 3-port measurement. This topic will be revisited later in section \ref{sec:results_current_noise}, when measuring the current noise of the driver.

To conclude, the measurements show that the LC supply filter is correctly damped with the expected corner frequency of \qty{300}{\Hz} and it will likely perform as intended, but above \qty{10}{\kHz} the filter performance cannot be accurately measured due limits of the setup.

\subsection{Voltage Reference and Setpoint Adjustment}%
\label{sec:voltage_reference}
The voltage reference used in this Design is the ADI \device{LM399} and alternatively the ADI \device{ADR1399}, but the latter was not available in sufficient quantities for production. Only preliminary tests were conducted on this reference. The \device{LM399} is also used by most current drivers tested for the laser system of highly charged ions, because, as discussed in section \ref{sec:component_selection}, it is the most economical solution, although this statement will by qualified again in section \ref{sec:zener_diode_selection} with regard to the Zener diode selection process.

For the \device{LM399} used in this design there are two approaches to integrate it as a voltage reference. The first concept is the one used by \citeauthor{libbrecht_hall} \cite{libbrecht_hall} and shown in figure \ref{fig:laser_driver_libbrecht_hall_concept}. It is a simple arrangement of a resistor in series with the Zener diode. The resistor is used to regulate the current through the diode. According to the data sheet around \qty{1}{\mA} \cite{datasheet_LM399} should be used. The circuit presented by \cite{libbrecht_hall} and carried over unmodified by \citeauthor{laser_driver_mosfet_noise} \cite{laser_driver_mosfet_noise} uses a variable current of up to \qty{2}{\mA} at the maximum diode supply voltage of \qty{12}{\V} as this voltage is user-adjustable. It can be adjusted up to voltage the input supply voltage of \qty{15}{\V} minus the minimum dropout voltage of the \device{LM317}, which is \qty{3}{\V} \cite{datasheet_LM317}. This is used to limit the compliance voltage as discussed below, but also reduces the Zener current accordingly.

As a sidenote, the diode supply voltage adjustment circuitry is rather peculiar because it would allow output adjustment of the \device{LM317} up to a maximum \qty{24}{\V}, although there is only a \qty{15}{\V} input. Maybe the trimmer resistance value $R_{trim}$ of \qty{5}{\kilo \ohm} was intended for a higher input voltage or was a left-over from a previous design phase. Using the equation given in the datasheet \cite{datasheet_LM317}
\begin{equation*}
    V_{out} = \qty{1.25}{\V} \left( 1 + \frac{R_2}{R_1} \right) = \qty{1.25}{\V} \left( 1 + \frac{R_{trim}}{\qty{275}{\ohm}} \right) \,,
\end{equation*}
it can be seen that half the value of $R_{trim}$ would have sufficed to provide the \qty{12}{\V} minimum output.

This voltage adjustment option is advertised as a current/voltage limit, but its use is particularly deceitful. As discussed in section \ref{sec:compliance_voltage} the MOSFET needs a certain voltage to remain in saturation for correct operation with good performance, but it will work at lower voltages as a variable resistor. As shown by the output impedance over $V_{DS}$ graph in figure \ref{fig:ltspice_output_impedance_simulation} on page \pageref{fig:ltspice_output_impedance_simulation} there is considerable leeway between the saturated zone on the right and the current being limited on the left because $V_{DS}$ has reached \qty{0}{\V}. This can be illustrated with an example. The \device{VP0106} MOSFET \cite{datasheet_VP0106} used by \citeauthor{libbrecht_hall} \cite{libbrecht_hall} requires about \qty{2}{\V} for correct operation. The voltage limit would be adjusted to include the voltage required by the diode, the sense resistor voltage drop at the maximum allowable diode current and the \qty{2}{\V} for the MOSFET. In an overcurrent event the latter \qty{2}{\V} would shift to the \qty{50}{\ohm} sense resistor. This means that an extra current of $\frac{\qty{2}{\V}}{\qty{50}{\ohm}} = \qty{40}{\mA}$ can flow before the current limits engages. This is \qty{40}{\percent} of the total range of the driver. The typical \qty{100}{\mA} laser diode will likely be damaged by then. This feature is therefore best not relied on.

Going back the Zener diode, the adjustable supply voltage has another drawback, because it influences the Zener voltage of the reference. The \device{LM399} has a dynamic impedance of \qty{1.5}{\ohm} \cite{datasheet_LM399}. This means that the Zener voltage changes \qty{1.5}{\mV \per \mA}. Using the value of the Zener diode bias resistor $R_{bias} = \qty{7.5}{\kilo\ohm}$ given in \cite{libbrecht_hall} gives a suppression of
\begin{equation*}
\frac{1.5}{7500 + 1.5} \approx \frac{1.5}{7500} = \frac{1}{5000} \,,
\end{equation*}
totally obliterating the stability of the diode. So it is best adjusted once, then left alone.

Fortunately, this has little bearing on the high frequency performance due to the filter that follows. Coming to the filter, there is another issue in the original design due to the filter impedance. As shown in equation \ref{eqn:output_impedance_rc_filter} on page \pageref{eqn:output_impedance_rc_filter}, the output impedance of an RC filter at low frequency is $R_{filt}$. For the filter circuit shown in figure \ref{fig:laser_driver_libbrecht_hall_concept} taken from \cite{libbrecht_hall} $R_{filt} = \qty{6}{\kilo\ohm} + \qtyrange[range-units = bracket, range-phrase=\textup{~to~}]{0}{5}{\kilo\ohm}$, depending on the potentiometer setting, with the maximum of \qty{5}{\kilo \ohm} in the center position. Considering the \device{LT1028} op-amp after the filter results in \qty[power-half-as-sqrt]{47}{\nV \per \Hz\tothe{0.5}} at \qty{10}{\Hz} from the op-amp input current noise compared to the voltage input noise contribution of only \qty[power-half-as-sqrt]{1}{\nV \per \Hz\tothe{0.5}}. The current noise is therefore clearly dominating the noise of the op-amp below the filter cutoff. This number is, thankfully, still a lot less than the \qty[power-half-as-sqrt]{170}{\nV \per \Hz\tothe{0.5}} at \qty{10}{\Hz} of the \device{LM399}, but when considering the \device{ADR1399}, which has a noise density of \qty[power-half-as-sqrt]{65}{\nV \per \Hz\tothe{0.5}} at \qty{10}{\Hz}, it is no longer negligible, especially given that this number is attenuated by the potentiometer setting.

All of these issues were addressed in the design detailed now. A condensed version of the setpoint generation circuit is shown in figure \ref{fig:dgDrive_setpoint_generation}, which is reduced to the most important components. The full schematic can be found in the Git repositories of the reference module and the laser driver \cite{git_dgDrive,git_dgDrive_reference}.
\begin{figure}[ht]
    \centering
    %\resizebox {0.8\textwidth} {!} {
        \import{figures/}{LM399_reference.tex}
    %} % resizebox
    \caption{Setpoint generation using the \device{LM399} reference module and an \device{AD5781} DAC followed by a 2:1 divider and an RC filter.}
    \label{fig:dgDrive_setpoint_generation}
\end{figure}

To better follow the discussion of figure \ref{fig:dgDrive_setpoint_generation} it is essential to remember, that the setpoint voltage is referenced to the diode voltage supply $V_{sup}$ as opposed of ground like in a normal circuit. For example the \qty{-7}{\V} Zener voltage becomes $V_{sup} + (\qty{-7}{\V})$ and so on. Due the use of a p-channel FET as it was shown in figure \ref{fig:precision_current_source} on page \pageref{fig:precision_current_source} when the precision current source was introduced, the setpoint to adjust the current must be referenced to $V_{sup}$. For reasons of simplicity, the author only refers to these values as \qty{-7}{\V}.

The circuit shown in figure \ref{fig:dgDrive_setpoint_generation} is best split into two parts, the voltage reference, which is a separate module shown in a red dashed box and the setpoint generation using a DAC. The DAC circuit will be discussed first, because some of the design decisions are rooted there.

While there are many DACs available on the market, fine grained adjustment of the laser current is desired limiting the choice of DACs. \citeauthor{laser_driver_digital} \cite{laser_driver_digital} used an ADI \device{AD5541} \qty{16}{\bit} DAC in their design, which can provide up to \qty{100}{\mA}, having a resolution of about \qty{1.5}{\uA}. \citeauthor{laser_driver_qcl_taubman_multiplexer} \cite{laser_driver_qcl_taubman_multiplexer} presented a higher power \qty{1}{\A} controller with an \qty{18}{\bit} Texas Instruments (TI) \device{DAC9881SB} DAC granting a resolution of \qty{4}{\uA}. The resolution required by this design is mostly defined by the blue laser and, as it was mentioned in section \ref{sec:design_goal_environment}, the laser is stable over the range of a few tens of \unit{\uA} and requires up to \qty{145}{\mA}. A \qty{16}{\bit} DAC offers a resolution of \qty{2}{\uA}, which would only allow a few DAC codes of stable operation. Therefore a DAC with \qty{18}{\bit} or more is desirable. The choice between an \qty{18}{\bit} and a \qty{20}{\bit} DAC is predetermined by the given reference. A \qty{20}{\bit} DAC has a resolution of \qty{1}{\ppm} while the noise of the \device{LM399} is around \qty{0.5}{\uV \per \V} at low frequency. The noise and drift performance \cite{datasheet_LM399} of the \device{LM399} makes an \qty{18}{\bit} DAC the more reasonable selection. The type of current source circuit limits the choice of DACs further. Using a current source, which is referenced to $V_{sup}$ requires the DAC to either accept $V_{sup}$ as the positive reference voltage directly or one must float the DAC like \citeauthor{laser_driver_digital} \cite{laser_driver_digital} did. Additionally both \citeauthor{laser_driver_digital} \cite{laser_driver_digital} and \citeauthor{laser_driver_qcl_taubman_multiplexer} \cite{laser_driver_qcl_taubman_multiplexer} divided down the reference voltage from \qty{-7}{\V} to \qty{-5}{\V} to match the maximum input voltage of the DAC. Floating the DAC brings about a number of problems, like having to level-shift all control signals as \citeauthor{laser_driver_digital} \cite{laser_driver_digital} did. Correct power supply sequencing also becomes vital.

A simpler approach can be taken if the DAC can accept both $V_{sup}$ as the positive reference and $V_{sup} + V_{ref}$ as the negative reference without being floated to $V_{sup} + V_{ref}$. A typical bipolar output DAC almost matches those requirements. The only problem is a constraint typically imposed by the negative reference input, which must be at a potential lower than ground. This problem can be solved by amplifying the reference voltage to ensure $\left|V_{ref}\right| \geq V_{sup}$. This also has the added benefit of reducing the noise contribution and offset drifts of the added circuitry, like thermal electromotive force (EMF). The suppression is inversely proportional to the gain. This approach is pursued here and its implementation is explained below.

The only bipolar DACs meeting the requirements are the TI \device{DAC91001} \cite{datasheet_DAC91001} and the ADI \device{AD5781} \cite{datasheet_AD5781}. Both are \qty{18}{\bit} devices with a pin compatible upgrade path to a \qty{20}{\bit} version should the need arise. The two devices are fairly similar in regard to this application. The device chosen was based on the availability, the \device{DAC91001} is only available through TI, while the \device{AD5781} is available through multiple distributors. Additionally, the author has worked with multiple DACs from ADI before and the implementation details are similar, which cut down the development time.

The DAC reference inputs and the output is buffered using an ADI \device{ADA4077-4} quad op-amp in a remote sensing arrangement as per the data sheet recommendation \cite{datasheet_AD5781}. $V_{sup}$ is taken directly from the four-wire sense resistor, a Vishay \device{VPR221Z} (see section \ref{sec:results_precision_current_source} for details). The negative reference voltage $V_{sup} + V_{ref}$ is the amplified Zener voltage taken from the reference module output. Typically, $V_{ref} = \qty{-15}{\V}$ is used, because this ensures that $\left|V_{ref}\right| \geq V_{sup}$ at all times. The typical supply voltage of the current driver is \qty{\pm 15}{\V} (maximum \qty{\pm 18}{\V}) and therefore $V_{sup} \leq \qty{15}{\V}$ due to required headroom of \qty{3}{\V} for the op-amps used as discussed in section \ref{sec:component_selection}.

The \qty{-15}{\V} reference must be divided down after the DAC because the setpoint, which will the voltage dropped across the sense resistor, must be between GND and $V_{sup}$. The resistor network forming a 2:1 divider is a Vishay \device{DSMZ} \qty{10}{\kilo\ohm}/\qty{10}{\kilo\ohm} network. The factor of $\frac{1}{2}$ is chosen because it is the most stable ratio, as both resistor values are of the same magnitude. An ADI \device{AD8676} \cite{datasheet_AD8676} dual op-amp buffers both $V_{sup}$ to supply one arm of the divider and also the output of the divider using the second op-amp. The output buffer uses a \qty{5}{\kilo\ohm} compensation resistor in the feedback path to match the input resistance as shown in figure \ref{fig:dgDrive_setpoint_generation}. This compensates for an input offset drift due to changes in the input bias current of the op-amp to cover the worst-case specifications (\qty{\pm 4.5}{\nA}). If there there were no compensation resistor a drift would result from the difference of the two input bias currents because one input sees \qty{5}{\kilo\ohm}, while the other input sees zero resistance. The divider is then followed by single pole filter and discussed next.

In contrast to the second order filter used by \cite{laser_driver_digital,laser_driver_mosfet_noise,libbrecht_hall} and shown in figure \ref{fig:setpoint_filter_libbrecht_hall}, this design uses a simpler first order filter.
\begin{figure}[ht]
    \centering
    %\resizebox {0.8\textwidth} {!} {
        \import{figures/}{laser_driver_libbrecht_hall_ref_filter.tex}
    %} % resizebox
    \caption{Setpoint filter used in \cite{laser_driver_digital,laser_driver_mosfet_noise,libbrecht_hall}.}
    \label{fig:setpoint_filter_libbrecht_hall}
\end{figure}

The second order filter shown in figure \ref{fig:setpoint_filter_libbrecht_hall} is overdamped ($\zeta = 1.5$) with a cutoff frequency of \qty{2.4}{\Hz}. The likely reason such a filter is applied is due the \device{LT1028} used in the design by \citeauthor{libbrecht_hall} \cite{libbrecht_hall}. It does have a very low flicker noise corner of \qty{3.5}{\Hz} \cite{datasheet_LT1028}, which matches the filter corner frequency.

There are two problems with the approach though. First, the current noise of the \device{LT1028} is dominating at low frequencies with more than \qty{5}{\kilo\ohm} of input resistance and second the bias current cancelling circuit inside the op-amp, which requires a matched source resistance. The bias current bias current cancelling circuit is injecting a small amount of correlated current noise into both inputs. Using a large input resistance, this noise needs to be considered as well. With unmatched source resistances it is not suppressed by the common mode rejection as explained in section \ref{sec:current_source_noise}. Therefore, contrary to intuition, using no resistor further increases the noise. The inputs in the original design are not balanced and therefore the low frequency performance of the circuit below the filter cutoff is degraded. The issues encountered when designing a high performance and high stability filter are discussed next.

A filter designed for the ADI \device{AD797} needs to be less aggressive, because the flicker noise corner frequency is about an order of magnitude higher and around \qty{30}{\Hz} \cite{datasheet_AD797}. Therefore, a first order filter as shown in figure \ref{fig:setpoint_filter} can be used. According to the discussion regarding the current noise above, the capacitor size should be maximized so that the resistive part $R_f$ of the RC filter can be reduced. Ideally $R_{f}$ is kept well below \qty{1}{\kilo\ohm} to make sure that the total noise
\begin{align}
    e_{total} &= \left(e_n^2 + 4 k_B T R_{total} + i_n R_{total} \right)^{\frac{1}{2}} \nonumber\\
    &= \left(e_n^2 + 4 k_B T \left(R_f + R_s\right) + i_n  \left(R_f + R_s\right) \right)^{\frac{1}{2}}
\end{align}

is minimized. $e_n$ is the voltage noise of the op-amp, $i_n$ the current noise, $R_f$ the filter resistor and $R_s$ the sense resistor used for the current source as shown in figure \ref{fig:precision_current_source}. In order to determine to optimal filter components several options were simulated and also verified experimentally. The simulation results are shown in figure \ref{fig:dgDrive_filter_resistor_simulation}.
\begin{figure}[ht]
    \centering
    \input{images/current_source_noise_filter_resistors.pgf}
    \caption{Simulated noise density of a \qty{250}{\mA} current source running at \qty{50}{\mA} built according to figure \ref{fig:dgDrive_setpoint_generation}. Compared are different values of the filter resistor.}
    \label{fig:dgDrive_filter_resistor_simulation}
\end{figure}

The simulation is a simplified simulation of the circuit shown in figure \ref{fig:dgDrive_setpoint_generation}. The reference module, including the DAC is replaced by a noise model, which includes the flicker noise and the white noise of the Zener reference and the DAC. The noise of most op-amps is neglected here, because the noise figure of the DAC as quoted in the datasheet \cite{datasheet_AD5781} already includes the buffers. The noise of the Zener module buffer can also be neglected as is an order of magnitude less than the Zener diode noise. The ADI \device{AD8676} buffer following the resistive divider is included and so is the \device{AD797} current source. The sense resistor value is \qty{30}{\ohm}. The output current was set to \qty{50}{\mA}. The full LTSpice simulation can be found among the supplemental material at \external{source/spice/current\_regulator\_AD797\_noise.asc}.

The simulation was conducted for several different values of $R_{filt}$. A range of values between \qty{249}{\ohm} and \qty{1.5}{\kilo\ohm} were simulated. The values chosen reflect resistor values, that are commonly available. I can be seen that for higher values of $R_{filt}$, the current noise starts dominating the low frequency noise of the \device{AD797} amplifier as discussed above. The inflection point is around \qty{0.6}{\Hz} and the current source becomes increasing noisy below this frequency with increasing filter resistance. The choice of the capacitor (\qty{150}{\uF}) is explained below.

As expected, the difference between a \qty{249}{\ohm} and a \qty{510}{\ohm} resistor is pretty small and the noise contribution only becomes noticeable for $R_{filt} \geq \qty{1}{\kilo\ohm}$ underpinning the statement above. Using a larger resistor $R_{filt}$, does improve the noise contribution above \qty{0.6}{\Hz} though. This advantage is fairly small however. Table \ref{tab:dgDrive_filter_resistor_integrated_noise} shows the integrated noise of the plot shown in figure \ref{fig:dgDrive_filter_resistor_simulation} and it can be seen that the numbers are close together, yet there is a slight improvement with a value of \qty{510}{\ohm}. In order to derive these values from the simulation, it is important to remember, that LTSpice can only deal with voltage noise, so a shunt resistor for the current source output is used for the simulation. Its thermal noise was subtracted from the result. This procedure is documented in the simulation file.
\begin{table}[ht]
    \centering
    \begin{tabular}{lc}
        \toprule
        $R_{filt}$& Integrated noise, \qtyrange[range-phrase=\textup{~to~}]{e-2}{e2}{\Hz} \\
        \midrule
        \qty{249}{\ohm} & \qty{4.58}{\nA_{rms}}\\
        \qty{510}{\ohm} & \qty{4.34}{\nA_{rms}}\\
        \qty{1}{\kilo\ohm} & \qty{4.43}{\nA_{rms}}\\
        \qty{1.5}{\kilo\ohm} & \qty{4.81}{\nA_{rms}}\\
        \bottomrule
    \end{tabular}
    \caption{Integrated noise of the current source for different values of $R_{filt}$. The integration range is \qtyrange{e-2}{e2}{\Hz}.}
    \label{tab:dgDrive_filter_resistor_integrated_noise}
\end{table}

Using the simulation as a guideline, several values of $R_{filt}$ were tested and \qty{510}{\ohm} was also found to be optimal in the final circuit regarding the noise and the temperature coefficient of the filter. The latter is discussed in more detail below. The resistor is a high quality Susumu \device{RG3216P-5100-B-T1} \qty{0.1}{\percent} resistor in a large 3216 package because \citeauthor{resistor_current_noise_ligo} \cite{resistor_current_noise_ligo} has shown, that larger resistors are of consistently higher quality and exhibiting less noise. Having settled on the optimal resistor value, the filter capacitor must be considered.

The capacitor value can be estimated from the required suppression. The \device{AD797} reaches \qty{1}{\nV \Hz\tothe{-0.5}} at \qty{100}{\Hz} and the \device{LM399} has a noise density of about \qty{90}{\nV \Hz\tothe{-0.5}} at \qty{100}{\Hz}. This means, that a cutoff frequency of \qty{1.1}{\Hz} is desired for about two order of magnitude of suppression at \qty{100}{\Hz}, requiring a filter capacitor of \qty{280}{\uF}. Taking into account the limited board space, it is clear, that the \qty{280}{\uF} marks an upper bound when considering capacitors with low volumetric efficiency. This warrants the examination of different types of capacitors and their properties. \citeauthor{libbrecht_hall} \cite{libbrecht_hall} for example used special hermetically sealed tantalum capacitors, but there are also other options available. Modern low-leakage electrolytic capacitors and film capacitors were also investigated. Ceramic capacitors were not considered for this filter, because they are either piezoelectric (X5R, X7R, etc.) or too big in physical size (C0G). The properties studied are the leakage current and its temperature stability, while optimizing volumetric efficiency. Table \ref{tab:capacitor_properties} shows an overview of different dielectric materials and their suitability according to those properties. More information on other types of capacitors can also be found in \cite{linear_circuit_design_handbook} or \cite{basic_linear_design}.
\begin{table}[ht]
    \centering
    \begin{tabular}{lccc}
        \toprule
        Capacitor type& Volumetric efficiency & Leakage& Temperature stability\\
        \midrule
        Electrolytic & $++$ & $--$ & $--$\\
        Tantalum & $+$ & $-$ & $-$\\
        Film & $-$ & $+$ & $+$\\
        Ceramic C0G & $--$ & $++$ & $++$\\
        \bottomrule
    \end{tabular}
    \caption{Capacitor properties of different dielectrics.}
    \label{tab:capacitor_properties}
\end{table}

The leakage current of a capacitor is of concern, because it affects the filter performance at low frequency. Figure \ref{fig:setpoint_filter} shows the first order filter of the digital current driver and two major sources of error currents. The leakage of the capacitor and the input bias current of the op-amp. Due to the filter resistor, both currents create an error offset voltage seen by the op-amp.
\begin{figure}[ht]
    \centering
    %\resizebox {0.8\textwidth} {!} {
        \import{figures/}{leakage_filter.tex}
    %} % resizebox
    \caption{Setpoint filter and error currents. The ADI \device{AD797} is depicted as a buffer instead of the precision current source circuit.}
    \label{fig:setpoint_filter}
\end{figure}

According to the datasheet, the \device{AD797} \cite{datasheet_AD797} has temperature dependent input bias current of about \qty[retain-explicit-plus]{+2}{\nA \per \kelvin}, which results in a drift of about \qty{-1}{\uV \per \kelvin} using the \qty{510}{\ohm} resistor. Do note, that an increase in the leakage and bias current causes a negative temperature coefficient. This number can only be influenced by using the better and more expensive B grade devices but must otherwise be accepted as given. All in all, the drift caused by the leakage and bias current should not exceed the reference drift of about \qty{0.3}{\uV \per \V \per \kelvin} (\qty{2.25}{\uV \per \kelvin} for a \qty{-7.5}{\V} reference voltage), which results in \qty{4.4}{\nA \per \kelvin}. Using a larger filter resistor like the \qty{6}{\kilo\ohm} in the second order filter used by \citeauthor{libbrecht_hall} \cite{libbrecht_hall}, the same bias current of \qty{2}{\nA \per \kelvin} would cause an offset of \qty{12}{\uV \per \kelvin}, almost \qty{1.7}{\uV \per \V \per \kelvin} considering the reference voltage of \qty{-7}{\V}. \label{sec:dielectric_absorption} The leakage current of a capacitor in this context is comprised of two effects, the first is leakage through the bulk resistance of the capacitor and the second is dielectric absorption. Dielectric absorption is an effect that describes how the molecules of the dielectric material slowly align to the external electric field applied. It can be modelled as a parallel RC circuit with a very large resistance. Depending on the type of capacitor, this effect can take several days to subside.

Electrolytic capacitors do have the highest capacitance per volume, but suffer from dielectric absorption and large changes in capacitance over temperature. Tantalum capacitors also exhibit large leakage currents \cite{tantalum_leakage} that depend on temperature, but they are more compact than film or ceramic capacitors. Film capacitors are very stable capacitors along with paraelectric NP0 ceramic capacitors. NP0 capacitors, being the most stable, unfortunately have the worst volumetric efficiency. Polyester film capacitors are a compromise between stability and size.

In order to asses the magnitude of the problem, the leakage current current over temperature was measured for several capacitors.
\begin{figure}[ht]
    \centering
    %\resizebox {0.8\textwidth} {!} {
        \import{figures/}{leakage_measurement.tex}
    %} % resizebox
    \caption{Setup for measuring the leakage current of a capacitor.}
    \label{fig:capacitor_leakage_measurement}
\end{figure}

The simple measurement setup shown in figure \ref{fig:capacitor_leakage_measurement} was placed in a thermal chamber. A Vishay \device{MRS25} \qty{2.2}{\mega\ohm} resistor was placed in series with the capacitor and a \qty{12.8}{\V} test voltage from a low noise DC supply was applied. -- in this case a stack of \num{8} alkaline batteries. Batteries were used to ensure, that no AC line noise is mistakenly recorded as leakage. The voltage drop across the resistor was measured using an HP \device{3458A} digital multimeter (DMM). The input bias current of the \device{3458A} is on the order of a few \unit{\pA} \cite{article_3458A_input_impedance, article_3458A_input_impedance_2}, which is small compared to the leakage current measured in this setup and henceforth neglected. The capacitor was first allowed to settle for \qty{24}{\hour} so that dielectric absorption can subside. The initial temperature was set to \qty{24}{\celsius} and then stepped to \qty{45}{\celsius} and left until the reading had settled again, then stepped down to \qty{24}{\celsius}. This was done to observe the settling behaviour, which would cause a low frequency random walk in a filter arrangement as outlined in section \ref{sec:random_walk}. This setup forms a low- pass filter with a settling time of several minutes due to the large value resistor and capacitor. This means, that any fast settling dielectric absorption like that of a film capacitor cannot be observed.

Three samples each from the same batch of the following capacitors where compared:
\begin{itemize}
    \itemsep0em
    \item Nichicon \device{UKL1V331KHD} low leakage \qty{330}{\uF}, \qty{35}{\V} electrolytic capacitor
    \item Kemet \device{T491X157K020AT} \qty{150}{\uF}, \qty{20}{\V} tantalum capacitor
    \item WIMA \device{MKS4B061507G00JSSD} \qty{150}{\uF}, \qty{50}{\V} polyester (PET) film capacitor
\end{itemize}

 The capacitors were chosen to have at least \qty{150}{\uF} and a voltage rating of \qty{\geq 16}{\V}, because the maximum setpoint voltage applied is \qty{-7.5}{\V} and a derating of at least \qty{50}{\percent} is applied to improve reliability.

This test was conducted with all capacitors and the results are summarised in table \ref{tab:capacitor_leakage}.

\begin{table}[ht]
    \centering
    \begin{tabularx}{0.9\linewidth}{>{\hsize=1.5\hsize}Xc>{\hsize=0.8\hsize}X>{\hsize=0.7\hsize}X}
        \toprule
        Capacitor& Capacitance& DC leakage at\newline\qty{12.8}{\V}, \qty{24}{\celsius} & Temperature\newline stability\\
        \midrule
        Nichicon \device{UKL1V331KHD} & \qty{330}{\uF}& \qty{1.1}{\nA} & \qty{390}{\pA \per \K}\\
        Kemet \device{T491X157K020AT} & \qty{150}{\uF} & \qty{19}{\uA} & \qty{16}{\nA \per \K}\\
        WIMA \device{MKS4B061507G00JSSD} & \qty{150}{\uF} & \qty{2.2}{\nA} & \qty{150}{\pA \per \K}\\
        \bottomrule
    \end{tabularx}
    \caption{Capacitor leakage current and temperature stability of the leakage current for different types of capacitors.}
    \label{tab:capacitor_leakage}
\end{table}

The electrolytic capacitor showed strong dielectric absorption and it took about \qty{24}{\hour} to settle from about \qty{500}{\nA} to \qty{1}{\nA}. After settling, stability was surprisingly good, although long relaxation constants were observed when changing the temperature. These are due to a change in capacitance. A measurement of a typical sample is shown in figure \ref{fig:leakage_current_ukl}.

The tantalum capacitor was a standard industrial grade capacitor and not a special low leakage version. The reason was that low leakage wet slug tantalum capacitors are very costly and similar in size to the PET film capacitor. The Kemet \device{T491} capacitor was tested to get an idea about the performance of standard tantalum capacitors. The leakage current observed for the tantalum capacitor was the highest of the components tested. Especially the temperature stability was unacceptable, as it was almost an order of magnitude larger than was considered acceptable above.

The type of film capacitor was chosen because its size was still possible to fit it onto the PCB. The \qty{150}{\uF} WIMA \device{MKS4B061507G00JSSD} is the \qty{50}{\V} version. There is also a \qty{63}{\V} available, but these were not available in small quantities for testing. If available the \qty{63}{\V} version should be preferred, because higher voltage capacitors have better leakage specifications, when biased at the same voltage. Dielectric absorption was not observed during testing, but could haven been masked by the large $RC = \qty{330}{\s}$ time constant, as the initial current takes about \qty{40}{\min} to decay to \qty{3}{\nA}. The measurement is shown in figure \ref{fig:leakage_current_mks4}. The PET film capacitor gave the best results with very good repeatability and very little capacitance change due to temperature. Its leakage current was also the lowest of the three types of capacitors tested.

Based on the results summarised in table \ref{tab:capacitor_leakage} the \qty{150}{\uF} WIMA \device{MKS4B061507G00JSSD} capacitor and a \qty{510}{\ohm} Susumu \device{RG3216P-5100-B-T1} resistor were chosen for the filter.

\begin{figure}[ht]
    \centering
    \input{images/leakage_current_ukl.pgf}
    \caption{Leakage current over temperature of a Nichicon \device{UKL1V331KHD} \qty{330}{\uF} electrolytic capacitor biased at \qty{12.8}{\V}. The capacitor was allowed to soak for \qty{24}{\hour} prior to the measurement.}
    \label{fig:leakage_current_ukl}
\end{figure}
\clearpage

\begin{figure}[ht]
    \centering
    \input{images/leakage_current_mks4.pgf}
    \caption{Leakage current over temperature of a WIMA \device{MKS4B061507G00JSSD} \qty{150}{\uF} PET capacitor biased at \qty{12.8}{\V}.}
    \label{fig:leakage_current_mks4}
\end{figure}
\clearpage

Having discussed the DAC it is clear, that the Zener voltage must be amplified to meet the requirements of the negative reference input of the DAC. An optimal value of \qty{-15}{\V} was also found above.

The voltage reference was realized as an additional reference module that is connected to the main PCB via a pin header. This allows additional testing of the much simpler reference module in a special test bench. These tests are detailed in section \ref{sec:zener_diode_selection}, but the circuit is discussed here first.

Amplifying the Zener voltage has the advantage that it is possible to bootstrap the Zener diode to produce its own reference current. The \device{LM399} only has a limited rejection of $\frac{1}{5000}$ against changes of the supply voltage when connected like shown in figure \ref{fig:laser_driver_libbrecht_hall_concept} on page \pageref{fig:laser_driver_libbrecht_hall_concept} because any change in the supply voltage results in a change of the Zener current. Bootstrapping the Zener improves the rejection ratio towards changes of the diode supply voltage and noise, because the Zener current is now produced by the amplified Zener voltage. Any noise and ripple has to additionally get past the amplifier CMRR as discussed in \ref{sec:current_source_noise}.

The bootstrapped circuit is shown in figure \ref{fig:dgDrive_setpoint_generation} on page \pageref{fig:dgDrive_setpoint_generation} and can be divided into an upper part with $R_{bias}$ and a lower part with a feedback network. The feedback network, based on a Vishay \device{300144Z} \cite{datasheet_300144Z} resistor network, is used to amplify the \qty{-7}{\V} Zener voltage to
\begin{equation*}
    \qty{-7}{\V} \cdot \left(1 + \frac{Rn_1}{Rn_2}\right) = \qty{-7}{\V} \cdot \left(1 + \frac{\qty{20}{\kilo\ohm}}{\qty{17}{\kilo\ohm}}\right) = \qty{-15.2}{\V}\,,
\end{equation*}
again referenced to $V_{sup}$. With \qty{-15.2}{\V} at the output and \qty{-7}{\V} at the Zener diode, $R_{bias}$ will then provide
\begin{equation*}
    I_{bias} = \frac{\qty{-15.2}{\V} - (\qty{-7}{\V})}{\qty{7.5}{\kilo\ohm}} \approx \qty{1.1}{\mA} \,,
\end{equation*}

which is independent of $V_{sup}$, just as desired. $R_{bias}$ is a \qty{0.1}{\percent}, \qty{10}{\micro\ohm \per \ohm \per \K} Panasonic \device{ERA-6ARB752V} resistor, but in principal any \qty{100}{\micro\ohm \per \ohm \per \K} resistor can be used, because the sensitivity of $R_{bias}$ is roughly
\begin{equation}
    \frac{\qty{-1}{\mA} \cdot \qty{1.5}{\ohm}}{\qty{7}{\V}} \frac{\mathrm{d} R_{bias}}{R_{bias}} \approx \num{215e-6} \cdot \frac{\mathrm{d} R_{bias}}{R_{bias}}\,.
\end{equation}

Using a \qty{100}{\micro\ohm \per \ohm \per \K} resistor instead, would cause a temperature coefficient of \qty{-20}{\nV \per \V \per \K}, which is small compared to the \qty{0.3}{\uV \per \V \per \K} of the \device{LM399}. The higher quality resistor was chosen to limit long-term drift. The feedback network is far more critical in this regard, hence the use of the Vishay \device{300144Z} high-precision network. All capacitors used in this circuit are NP0 capacitors, which are very stable over the whole temperature range.

There is one last issue to address. Unfortunately, the bootstrapped reference circuit is not guaranteed to start up correctly. The self-biased circuit has two stable points of operation. The desired one is at $V_{sup} - V_z$ and the other is $V_{sup} + V_f$, when the Zener diode is forward biased. The cause of this is the positive feedback to the \device{LT1001}. At startup, the Zener diode has a very high impedance (see the typical Zener diode I-V curve, e.g. \cite{fet_equations}) and can be considered open, while $R_{bias}$ is small compared to the feedback network. The op-amp inputs are slightly capacitive and the non-inverting input then pulls high faster, delivering positive feedback. This unwanted operating point can be reached if the op-amp supply comes up before $V_{sup}$. The Zener diode will then be forward biased by the op-amp. Of course, this can only happen if the op-amp supply voltage is higher, than $V_{sup}$, which in this case is true. This situation is critical, because the output would then go above \qty{0}{\V}. This output is connected to the negative reference input of the DAC, which must not be positively biased. To prevent this case and damage to the DAC, the second diode at the output of the op-amp is used. It ensures that the output cannot go above ground and the gain of the positive feedback is drastically reduced and the negative feedback takes over quickly.

The setpoint circuitry can be summarised as follows. The reference module outputs an amplified reference voltage of \qty{-15}{\V}, which is fed to the negative reference input of an ADI \device{AD5781} \qty{18}{\bit} DAC, which is used to create a setpoint voltage between $V_{sup}$ and  $V_{sup} - \qty{15}{\V}$. The DAC output voltage is divided down by a factor of two (with regard to $V_{sup}$) using a Vishay \device{DSMZ} resistor network. The resulting voltage between $V_{sup}$ and  $V_{sup} - \qty{7.5}{\V}$ is then buffered and low-pass filtered using a \qty{510}{\ohm} and \qty{150}{\uF} RC low pass. The filter capacitor, a WIMA \device{MKS4B061507G00JSSD}, was tested for low leakage to ensure stability of the filter. The filtered voltage is at last fed to the precision current source discussed in the next section.

The reference module, mounted on a standoff, secured with a screw is shown in figure \ref{fig:reference_module_pcb}. The reference is on the right hand side with slots surrounding it for better thermal isolation. The serial number and red dot can be seen on can. This is the serial number of the Zener diode and the dot shows that it passed the burn-in test. The Vishay \device{300144Z} divider is far away from the heated reference in the upper left corner to reduce thermal EMF.

% TODO: Fix exposure, check CR3 file. The LM399 is overexposed.
\begin{figure}[hb]
    \centering
    \includegraphics[width=0.75\textwidth]{images/BM1A6694_reference_15V_lowres.JPG}
    \caption{The voltage reference module mounted on its socket on the main current driver PCB. \device{LM399} no. 20 is marked with a red dot because it passed quality control. In the background, the large red filter capacitor can be seen.}
    \label{fig:reference_module_pcb}
\end{figure}

\subsection{Precision Current Source}
\label{sec:results_precision_current_source}
The theory behind the precision current source was laid out in section \ref{sec:precision_current_source}, but some interesting details were not discussed yet. One of the main drawbacks of the current source from section \ref{sec:precision_current_source} is that the setpoint has a direct impact on the compliance voltage as discussed in section \ref{sec:compliance_voltage}. Given an input supply voltage of \qty{15}{\V} it is immediately evident that with a reference voltage of \qty{7.5}{\V} a compliance voltage of \qty{8}{\V} as defined in specification \ref{lst:dgDrive_specs_electrical} is impossible to reach.

One solution would be to increase the division ratio after the DAC to three, for example, reducing the reference voltage to \qty{5}{\V}. Unfortunately, this solution increases the current noise by a factor of $\frac{7.5}{5} = 1.5$ according to table \ref{tab:current_source_noise_contributers}, because the sense resistor has to be scaled by the factor of $\frac{2}{3}$ to get the same output current.

Another option is to use the negative \qty{-15}{\V} rail instead of ground to connect the cathode of the laser diode. This would directly increase the compliance voltage by \qty{15}{\V} and include enough headroom for other components of the current source, like the MOSFET. This solution, however, brings along the problem that was discussed in section \ref{sec:current_sink_current_source}. Directly connecting the laser diode to a voltage rail can have catastrophic consequences for the diode in case the other side is accidentally connected to ground.

This work therefore presents a novel third option, which separates the current source from the compliance voltage requirement and enhances the current source shown in figure \ref{fig:precision_current_source} on page \pageref{fig:precision_current_source}. This circuit is shown in figure \ref{fig:dgDrive_current_source}.
\begin{figure}[ht]
    \centering
    %\resizebox {0.8\textwidth} {!} {
        \import{figures/}{dgDrive_current_source.tex}
    %} % resizebox
    \caption{Simplified current source implemented in the digital current driver. The voltage across $R_s$ is Kelvin sensed. The laser diode is wrapped in a feedback loop and the current source is shielded from the load. $U_1$ is an ADI \device{AD797B} and $U_2$ is an ADI \device{ADA4625-1}.}
    \label{fig:dgDrive_current_source}
\end{figure}

This circuit consists of the current source introduced in section \ref{sec:precision_current_source} and a current sink, that wraps the laser diode in a feedback loop to shield the current source from the load. In addition to the circuit shown in section \ref{sec:precision_current_source} in figure \ref{fig:precision_current_source} on page \pageref{fig:precision_current_source}, the sense resistor is connected differently. The sense resistor used is a Vishay \device{VPR221Z} \cite{datasheet_VPR}, a four-terminal device. This allows Kelvin sensing of the voltage across $R_s$. The positive voltage is buffered using several precision ADI \device{ADA4077-4} \cite{datasheet_ADA4077} op-amps. This voltage is then supplied to the voltage reference circuit, the DAC and the divider that follows. It is important that no current is drawn from this net. The negative voltage is sensed by $U_1$, an ADI \device{AD797} (B grade), to close the feedback loop around $R_s$.

To understand the current sink, it is easiest, to assume, for now, $V_{offset} = \qty{0}{\V}$ and the non-inverting input of $U_2$, an ADI \device{ADA4625-1}, is grounded. Applying a setpoint voltage $V_{set}$ to $U_1$ will cause the upper current source to source a current into the virtual ground and the laser diode. This will cause the virtual ground potential to rise and the op-amp $U_2$ will that see a positive voltage at its inverting input. $U_2$ will then pull its output low, pulling the gate of the p-channel MOSFET $Q_2$ low as well, causing the current sink to drain the appropriate amount of current. $U_2$ will always steer $Q_2$ in such a way that the virtual ground is maintained. Do note, that using a p-channel MOSFET for $Q_2$, will put an extra burden on the op-amp $U_2$, because it has to follow the load voltage with its output. Fortunately, remembering the Shockley equation \ref{eqn:shockley} it is clear that the voltage of a diode changes little with the current and this issue can therefore be neglected. On the other hand, using a p-channel MOSFET does not require the op-amp output to go down all the way to the negative diode supply to turn off the MOSFET. The p-channel MOSFET turns off at $V_{offset}-V_{th}$, which is close to \qty{0}{\V}. This arrangement is similar to the concept of a transimpedance amplifier, except that instead of a resistive element in the feedback path, a (laser) diode is used. Putting the laser diode into a feedback loop has a number of advantages, which are discussed below.

The most important one is that the current source does no longer see the load and only has to source the current into a virtual ground. The compliance voltage required from the upper current source is reduced to $V_{offset}$, because this is the voltage at the virtual ground. This also important for the modulation current source because its compliance voltage is limited as well as shown in equation \ref{eqn:howland_current_compliance_voltage}. The compliance voltage, that can be provided by the combined source is increased to more than \qty{10}{\V} with this design, more than adequate to meet the design specifications of \qty{8}{\V} given in specification \ref{lst:dgDrive_specs_electrical}. Using a higher voltage negative supply is also possible to further increase the compliance voltage. The compliance voltage is essentially independent of the upper current source.

The circuitry supplying the voltage for the current source is essentially a voltage source, so additional care must be taken to protect the laser diode. This is where the offset voltage comes into play. Choosing a positive offset is interesting because if the virtual ground is accidentally shorted to the system ground, the inverting input of $U_2$ will be pulled low and the output of $U_2$ will go high, closing the MOSFET $Q_2$, protecting the laser diode. If $V_{offset}$ were negative, $U_2$ would open $Q_2$, likely destroying the laser diode. $V_{offset}$ must therefore always be $\qty{\geq 0}{\V}$. In this design $V_{offset} = \qty{500}{\mV}$ has proven successful, but in future, it may be reduced to around $\qty{100}{\mV}$ for an increased headroom for the MOSFET $Q_1$ in higher current designs. The reduced load voltage seen by the current source is also important for the modulation current source discussed in section \ref{sec:howland_current_source}.

In addition to solving compliance voltage related problems, there is another benefit from this configuration. Since the current source does not see the load, but rather the constant virtual ground, the output impedance is considerably improved. In essence, any change of the virtual ground potential is suppressed by the gain of the op-amp $U_2$, which means the output impedance is multiplied by the open-loop gain of $U_2$. Typically, a gain of \num{e7} at low frequencies can be expected from the \device{ADA4625-1} \cite{datasheet_ADA4625}. The output impedance at this level is no longer limited by the current source, but rather other circuit parasitics. This helps the rather poor output impedance of the Howland current source to meet the requirements stated in specification \ref{lst:dgDrive_specs_electrical}.

There is one downside of this solution though. The laser diode is wrapped in a feedback loop that needs to close around the diode. This means, that the physical size of the loop is (regarding op-amps) enormous, because the laser head is not located on the PCB, but rather separated by several meters of cable, located on an optical table next to the rack. This introduces a considerable phase shift into the control loop at high frequencies. The details of the cabling are discussed in more detail in section \ref{sec:cables_and_connectors}. For now only the propagation speed of light is of interest. The DVI cables used have a velocity factor of \num{0.8} and a typical \qty{3}{\m} cable will therefore cause a delay of about $\tau = \qty{12.5}{\ns}$. The signal has to go through the cable twice, so at \qty{1}{\MHz}, this will introduce a phase delay of
\begin{equation*}
    \theta = 2 \pi \cdot 2 \tau \cdot \qty{1}{\MHz} \approx \frac{\pi}{20} = \qty{9}{\degree} \,.
\end{equation*}

While at \qty{1}{\MHz}, this is not yet critical. The phase delay of $\frac{\pi}{2}$ introduced at \qty{10}{\MHz} will send the control loop into oscillations. The bandwidth of $U_2$ is therefore limited to \qty{1}{\MHz}, which works well with cables of up to \qty{3}{\m}. Longer cables are not compatible with this device and should not be used. More details about the circuit surrounding $U_2$ can be found in the schematics \cite{git_dgDrive}.

The last issue that needs to be discussed is the power dissipation in the sense resistor. This is less problematic for low currents, but at currents of several hundred \unit{\mA} it becomes more and more of a problem. The power lost in the resistors scales linearly with the maximum output current as the maximum setpoint voltage of \qty{7.5}{\V} is fixed. At a full scale output of \qty{500}{\mA}, for example, the sense resistor is required to dissipate \qty{3.75}{\W}. The resistors used are rated for \qty{8}{\W} when mounted on a heat sink, but only at \qty{25}{\celsius} ambient, which is illusory, when mounted inside a box without active cooling. The chassis to which the resistors are bolted will already be warmer than \qty{25}{\celsius} inside a typical rack.

The \qty{8}{\W} maximum is also detrimental to the long-term stability target. The datasheet of the sense resistor gives a maximum load life stability of \qty{150}{\micro \ohm \per \ohm} for \qty{2000}{\hour} at \qty{8}{\W} \cite{datasheet_VPR}  when using a proper heat sink. A technical note from Vishay \cite{ResistorDrift} gives some hints regarding the long-term drift of the older C-Foil resistors. Assuming the Z-foil \device{VPR221Z} resistors behave in a similar way, the load life drift for \qty{30}{\day} (\qty{720}{\hour}) can be estimated as
\begin{equation*}
    \frac{\Delta R}{R}(\qty{30}{\day}, 3\sigma) = \qty{150}{\micro \ohm \per \ohm} \cdot \sqrt[\leftroot{-2}\uproot{2}3]{\frac{720}{2009}} = \qty{107}{\micro \ohm \per \ohm}\,.
\end{equation*}

Using the power derating curve in the datasheet \cite{datasheet_VPR} to estimate a thermal resistance of \qty{14}{\K \per \W} from the metal foil to ambient gives a temperature of \qty{112}{\K} above ambient for an \qty{8}{\W} load. Consulting \cite{ResistorDrift}, such a temperature causes in increase in the drift by a factor of \num{15} when compared to room temperature. Reducing the load to \qty{2}{\W} will decrease the internal temperature of the metal foil considerably to \qty{28}{\K} above ambient and therefore reduces the drift to less than a factor of \num{4} when compared to room temperature. The drift estimated above would then reduce to about \qty{29}{\micro \ohm \per \ohm}, far less than the required \qty{240}{\micro \ohm \per \ohm} as given by specification \ref{lst:dgDrive_specs_environment}, leaving a safe headroom for higher ambient temperatures.

In order to reduce the power lost in the resistor to the desired \qty{2}{\W}, $R_s$ can be split into multiple resistors to distribute the current. While this idea is neither novel nor interesting, it does become so, when looking at it in a different context. Splitting the sense resistor only becomes necessary at currents above a few hundred \unit{mA}. At these currents the sense resistor is of a fairly low value, typically \qty{< 50}{\ohm}, and the current noise of the current source is no longer dominated by the sense resistor. As a reminder, the voltage noise of the \device{AD797} op-amp is \qty{0.9}{\nV \Hz\tothe{-0.5}}. This is the equivalent to a \qty{50}{\ohm} resistor at room temperature. With $R_S < \qty{50}{\ohm}$, the op-amp becomes the dominant noise source of the current source. The voltage noise of the op-amp, in contrast to the thermal noise of the resistor, does see an improvement when averaged. Using $n$ op-amps improves the high frequency noise by a factor of $\sqrt{n}$. This assumes, that the wideband noise is uncorrelated, which should be the case, as any power supply noise is effectively filtered out and the noise is only produced inside the op-amp. At low frequencies, the reference noise still dominates the noise and using a single reference and setpoint DAC, which is fed into both current sources, the noise is correlated and therefore adds normally, so it does not see any improvement using this technique.

The simulation found at \external{source/current\_regulator\_AD797\_noise.asc} can be used to estimate the potential improvement. The simulation gives a more complete picture, because it includes the noise created by the resistors and the feedback network around $U_1$. Table \ref{tab:dual_current_source_noise_comparison} gives the simulated output noise for two solutions of a \qty{500}{\mA} laser driver, one with a single current source and the other with two current sources. The sense resistors in this case are smaller than the \qty{50}{\ohm} discussed above. The single source uses a \qty{15}{\ohm} resistor, while the dual current source solution employs two \qty{30}{\ohm} resistors.
\begin{table}[ht]
    \centering
    \begin{tabular}{lcc}
        \toprule
        & LF Noise \qtyrange[range-phrase=\textup{~to~}]{e-2}{e2}{\Hz}  & HF noise, \qtyrange[range-phrase=\textup{~to~}]{e2}{e5}{\Hz}\\
        \midrule
        Single & \qty{27.2}{\nA_{rms}} & \qty{21.7}{\nA_{rms}}\\
        Dual & \qty{27.2}{\nA_{rms}} &\qty{17.0}{\nA_{rms}}\\
        \bottomrule
    \end{tabular}
    \caption{Noise comparison of a single current source with $R_S = \qty{15}{\ohm}$ and dual current source with $2 \times \qty{30}{\ohm}$, both at \qty{500}{\mA}.}
    \label{tab:dual_current_source_noise_comparison}
\end{table}

From the simulation it can be easily gathered that the high frequency noise of a dual current source design is about $\frac{1}{\sqrt{2}}$ that of a single source design, just as predicted above. The low frequency noise is also not affected as discussed above. In order to improve the frequency noise, a lower noise reference like the \device{ADR1399} must be used. Judging from the datasheet of the \device{LM399} and \device{ADR1399} \cite{datasheet_LM399, datasheet_ADR1399} and preliminary tests, the \device{ADR1399} has \qty{30}{\percent} less noise. While the dual current source design is already very close to the desired \qty{30}{\nA_{rms}} in \qty{100}{\kHz} bandwidth, it is still slightly above the desired target with a total noise of \qty{31.9}{\nA_{rms}}. A low noise reference is therefore key and given the loose datasheet specifications of those references, selecting them for low noise is important. This is discussed in section \ref{sec:zener_diode_selection}.

Using a second current source also helps with reducing the statistical spread of both the drift and the temperature coefficient of the sense resistor and the \device{AD797} op-amp $U_1$. While the datasheet of the sense resistor gives a \textit{typical} value of \qty{\pm 0.05}{\micro\ohm \per \ohm \per \K}, the $3\sigma$ range is more like \qty{\pm 2}{\micro\ohm \per \ohm \per \K} \cite{ResistorTCR}. Using two current sources results an inherent statistical averaging regarding the temperature coefficient, making the \qty{1}{\uA \per \A \per \K} target of specification \ref{lst:dgDrive_specs_environment} easier to reach.
\begin{table}[hb]
    \centering
    \begin{tabular}{lcc}
        \toprule
        Configuration & Sense resistor value & Maximum current\\
        \midrule
        \device{DgDrive-150} & \qty{50}{\ohm} & \qty{150}{\mA}\\
        \device{DgDrive-250} & \qty{30}{\ohm} & \qty{250}{\mA}\\
        \device{DgDrive-300-LN} & $2 \times \qty{50}{\ohm}$ & \qty{300}{\mA}\\
        \device{DgDrive-500-LN} & $2 \times \qty{30}{\ohm}$ & \qty{500}{\mA}\\
        \bottomrule
    \end{tabular}
    \caption{Different configurations of the digital current driver current tested and built.}
    \label{tab:dgDrive_configurations}
\end{table}

Combining more than two current sources unfortunately yields diminishing returns as the noise scales as $\frac{1}{\sqrt{n}}$, whereas cost and complexity goes with $n$. Therefore a maximum of two current sources are used in this design. Table \ref{tab:dgDrive_configurations} lists the current source configures, that were built for this project. The \device{DgDrive-300-LN}, which is using a \qty{50}{\ohm} resistors is at the limit where adding a second current source has any benefits regarding the wideband noise. The difference in wideband noise is about \qty{15}{\percent} (\qty{13.8}{\nA_{rms}} versus \qty{11.6}{\nA_{rms}}) when comparing the simulation against a \qty{25}{\ohm} configuration. Only two of these units were built to test the extra stability added by the statistical averaging scheme.

A final note regarding the second current source and the Kelvin sensing mentioned above. As discussed above and shown in figure \ref{fig:dgDrive_current_source} one side of the sense resistor feeds the voltage reference to create the setpoint, the other goes to the \device{AD797} to create the current. This is different for the second resistor. The upper sense pin is not used in this case. One could, in theory, connect the sense pins of both resistors via another resistor to the op-amp and average the voltage, but the voltage difference between both pins is small because a copper pour on the PCB connects both resistors and the chance to introduce thermocouples is large.

Noise measurements of the digital current driver in comparison to other current drivers and the simulation results shown above are presented in section \ref{sec:results_current_noise}.

To summarize the results, a novel current source configuration was presented that addresses the limited compliance voltage by removing the load seen by the current source. The compliance voltage in this design is more than \qty{10}{\V}, limited by the power supply rails of \qty{\pm 15}{\V}. In addition, a solution was given to limit the increasing current noise contribution of the op-amp in high output current configurations that use small sense resistors. These results were underpinned by simulations and a simulation model was provided to estimate the expected improvements.
\begin{center}
    \begin{deviceProperties}[label={lst:dgDrive_properties_current_source}]{DgDrive current source}
    \begin{itemize}
        \item Compliance voltage: \qty{10}{\V}
        \item Long-term drift over \qty{30}{\day}: \qty{<100}{\micro\ohm \per \ohm}
        \item Current noise (\qty{1}{\Hz} to \qty{100}{\kHz}), \device{DgDrive-250}: \qty{19}{\nA_{rms}}
        \item Current noise (\qty{1}{\Hz} to \qty{100}{\kHz}), \device{DgDrive-500-LN}: \qty{19}{\nA_{rms}}
    \end{itemize}
    \end{deviceProperties}
\end{center}

\subsection{Modulation Current Source}%
\label{sec:modulation_current_source}
Several options for the modulation current source are presented in literature. Some designs use a simple AC coupled input \cite{diodelaser_modulation,libbrecht_hall}, which drastically reduces the high-frequency output impedance of the current source. Others use a JFET in parallel to the laser diode to divert some of the current \cite{laser_modulation_jfet,laser_modulation_jfet2,laser_modulation_jfet_appel}, which causes poor DC performance due to the missing feedback loop. \citeauthor{libbrecht_hall} \cite{laser_driver_digital,libbrecht_hall} in addition to the AC coupled input also presented a more rugged approach similar to a Howland current source, which delivers a reasonable DC performance and a claimed bandwidth of more than \qty{10}{\MHz}. The modulation circuit shown by \citeauthor{libbrecht_hall} is likely an update of an earlier version of the same laser driver printed in the paper of \citeauthor{diodelaser_modulation} \cite{diodelaser_modulation}, which would explain the rather peculiar arrangement. This circuit is shown in figure \ref{fig:libbrecht_hall_current_source} and will be discussed in more detail, because it also used in the legacy laser drivers found in this group.
\begin{figure}[ht]
    \centering
    %\scalebox{0.5}{%
        \import{figures/}{libbrecht_hall_current_source.tex}
    %} % scalebox
    \caption{The modulation current source used by \cite{laser_driver_digital,libbrecht_hall}. $R_1 = R_2 = R_3 = R_4 = \qty{1}{\kilo\ohm}$ are matched resistors. $\frac{R_5}{2} = R_6 = R_7 = R_8 = \qty{1}{\kilo\ohm}$. $C_1 = \qty{1}{\uF}$ $R_{t} = \qty{54}{\ohm}$ is optional.}
    \label{fig:libbrecht_hall_current_source}
\end{figure}

Looking at figure \ref{fig:libbrecht_hall_current_source}, the current source can be identified as the classic HCS. The Howland current source does require a very low impedance input $V_{in}$, because otherwise the tight matching of the four resistors $R_1 = R_2 = R_3 = R_4$ is imbalanced. This brings about a problem with an external input, having to either short the input to ground or keep it connected to a low impedance source at all times. If the input were kept open one side of the Howland current source would be imbalanced thus creating an offset current. \citeauthor{libbrecht_hall} addressed this problem by using an inverting amplifier $U_2$ to invert the output of $U_1$. Since the output current of $U_1$ is equally divided between one trace going to the inverting input of $U_1$ via $R_4$ and $R_3$ and the other trace with $R_1$ and $R_2$, the current that $U_2$ injects into the input trace must be divided by half, hence $R_5 = 2 \cdot R_x$. $R_x$ being the value used by the Howland current source. The resistor $R_8$ does not serve any immediate purpose. The design by \citeauthor{libbrecht_hall} uses the \device{OP07} \cite{datasheet_OP07} precision op-amp for both $U_1$ and $U_2$. This op-amp does have an internal bias current compensation scheme\footnote{This detail can either be read from the simplified schematic as there is a current source feeding into both inputs or from the input offset current and input bias current specification. The offset current is about the same as the bias current and does not have a defined polarity indicating the possibility of over- and undercompensation.} so its input bias current is very low and on the order of a few \unit{\nA}. This makes one wonder about the purpose of the resistor $R_8$, which is not only the wrong value for a compensation resistor, as it should be $R_8 = R_6 || R_7 = \qty{500}{\ohm}$, but also pretty much unneeded. This could be relic from an earlier design stage with different op-amps. The matching of the resistors $\frac{R_5}{2} = R_6 = R_7 = R_x$ fortunately does not need to be as tight as the ones of the HCS as discussed in section \ref{sec:howland_current_source}, because $U_2$ forms an inverting amplifier with gain $A_2 = \frac{R_6}{R_7} \approx -1$ and feeds back a current of $\frac{A_2 \cdot V_{o,U1}}{R_5}$ into the input node. The error current is then distributed between the input source and the HCS, so only the fraction $R_1 || R_{in}$ of the error current flows into $R_1$ and the HCS. For example, assuming a modulation source has an output impedance of \qty{50}{\ohm}, the error current flowing into $R_1$ is attenuated by a factor of $\frac{1}{47}$, relaxing the requirements of the matched resistor network by the same factor.

An issue that can be identified with the above circuit is the capacitor $C_1$. It forms a low-pass filter with the cutoff frequency
\begin{equation*}
    f_c = \frac{1}{2 \pi R_6 C_1} \approx \qty{159}{\Hz}
\end{equation*}
for $R_6 = \qty{1}{\kilo\ohm}$ and $C_1 = \qty{1}{\uF}$ as given in \cite{laser_driver_digital,libbrecht_hall}. This has two detrimental effects as it offsets the careful balance created by the feedback of $U_2$. First, it will dramatically decrease the output impedance of the current source. It was already shown in appendix \ref{sec:appendix_howland_current_source}, that the Howland current source is very sensitive to an imbalance of the resistor ratios and if the feedback of $U_2$ is reduced, the output impedance of the source starts playing a role. This effect can be seen in figure \ref{fig:output_impedance_libbrecht_hall}, which shows an LTSpice simulation of the circuit shown in figure \ref{fig:libbrecht_hall_current_source} with a \qty{50}{\ohm} source at the modulation input. The fast modulation input found in \cite{libbrecht_hall} was omitted in the simulation, but it would introduce an additional limit of \qty{10}{\kilo\ohm} above \qty{1.59}{\kHz} to ($CR=\qty{10}{\nF} \cdot \qty{10}{\kilo\ohm}$). The simulation file can be found at \external{source/spice/modulation\_input\_LibrechtHall.asc}.
\begin{figure}[hb]
    \centering
    \input{images/output_impedance_libbrecht_hall.pgf}
    \caption{The output impedance of the HCS from figure \ref{fig:libbrecht_hall_current_source} with \qty{0.01}{\percent} worst-case resistor matching and a \qty{50}{\ohm} source. The simulation was repeated with and without the capacitor $C_1$.}
    \label{fig:output_impedance_libbrecht_hall}
\end{figure}

Figure \ref{fig:output_impedance_libbrecht_hall} gives the output impedance for two configurations. With and without the capacitor $C_1$. The output impedance at low frequencies is around \qty{3.5}{\mega\ohm} for both configurations, which is the limit found due to the op-amp gain and the resistor array mismatch. This changes rapidly when inserting the capacitor. The output impedance drops to around \qty{20}{\kilo\ohm} at \qty{1}{\kHz}, created by the \qty{50}{\ohm} mismatch added to $R_1$. At even higher frequencies, the results converge again, because the op- amp gain is the more limiting factor.

The second effect of the capacitor $C_1$ is more subtle, but poses a serious problem for a high bandwidth servo. This has to do with the input impedance presented by the circuit. By inspection of figure \ref{fig:libbrecht_hall_current_source}, one finds the input impedance to be $R_6 || R_1 \approx \qty{667}{\ohm}$. The required termination resistor $R_t$ would be \qty{54}{\ohm}, or two \qty{27}{\ohm} resistors in series, which can be bought off-the-shelf. Unfortunately as soon as the current source balance is disturbed by the gain of the circuit surrounding $U_2$ rolling off, its input impedance changes. This makes proper input matching impossible and causes unpredictable high frequency behaviour depending on the load. This was also mentioned by \cite{laser_driver_digital} and investigated closer by \citeauthor{thesis_tilman} \cite{thesis_tilman} and therefore not covered here. \citeauthor{thesis_tilman} showed that this type modulation current source shows a highly load dependent behaviour above \qty{1}{\MHz}.

This work proposes a different approach to the problem. Instead of using the more complicated approach above, a simple buffer as part of a dual op-amp (Texas Instruments \device{OPA2140} \cite{datasheet_OPA2140}) is used. Earlier PCB version also used an ADI \device{AD8672} \cite{datasheet_AD8672}, which was replaced because the \device{OPA2140} has similar specifications, but a lower bias current and a rail-to-rail output. A buffer allows proper termination and has no bandwidth dependent issues. The design focuses on a maximally flat response up to \qty{1}{\MHz} and a well defined roll-off afterwards because the integrated modulation current source is typically used to steer the laser or lock it to an atomic transition. The former requires a well defined amplitude transfer function while the latter depends on a fast response with litte phase lag. The full circuit is shown in figure \ref{fig:dgDrive_mod_current_source}.
\begin{figure}[ht]
    \centering
    %\scalebox{0.5}{%
        \import{figures/}{dgDrive_mod_current_source.tex}
    %} % scalebox
    \caption{The modulation current source used by digital laser driver DgDrive. $R_1=R_2=R_3=R_4 = \qty{1}{\kilo\ohm}$ and $C_c = \qty{10}{\pF}$. The op-amp is a Texas Instruments \device{OPA2140}.}
    \label{fig:dgDrive_mod_current_source}
\end{figure}

The idea behind this design is simple. A current source is, by definition, a high impedance source. It can not be matched to the typical \qty{50}{\ohm} transmission line. Reflections, cable and load dependent behaviour are an inevitable consequence. By deliberately limiting the bandwidth to around \qty{1}{\MHz} these problems can be avoided. If a faster solution is desired it is best to move the current source directly into the laser head like it was done in \cite{current_mod_paper}.

As discussed in section \ref{sec:howland_current_source}, the four resistors $R_1$, $R_2$, $R_3$ and $R_4$ need to be closely matched. This is achieved using a Vishay \device{MORNTA1001AT5} \cite{datasheet_MORN} array. The ratio matching is \qty{0.05}{\percent} and according to table \ref{tab:howland_current_source_summary} on page \pageref{tab:howland_current_source_summary} one can expect a mediocre worst case output impedance of \qty{500}{\kilo\ohm}, which is in parallel with the precision current source that generates the bulk current. As discussed in section \ref{sec:precision_current_source} this current source has an output impedance of several \unit{\giga\ohm} and easily surpasses the requirement of \qty{7.5}{\mega\ohm} listed in table \ref{lst:dgDrive_specs_electrical} on page \pageref{lst:dgDrive_specs_electrical}. The modulation current source on the other hand fails to meet that target.

Normally this would be disastrous and a either a better resistor array or trimming would be required to restore the output impedance, but in this implementation it is less of a problem because as shown in the last section \ref{sec:results_precision_current_source}, the modulation output is sinked into a virtual ground node created by a current sink. The final output impedance is therefore multiplied by the gain of the \device{ADA4625-1}, which has plenty of bandwidth and open-loop gain with a unity-gain-bandwidth of \qty{45}{\MHz} and a gain of \num{e7}. The output impedance of the combined current source is therefore independent from the performance of the modulation current source and limited only by the physical properties of the cable as discussed in section \ref{sec:output_impedance}. This brings up the next subject to be discussed, the bandwidth of the current source.

The bandwidth of the modulation source is limited by the op-amp bandwidth and circuit parasitics. \citeauthor{laser_driver_digital} \cite{laser_driver_digital} used a \qty{50}{\ohm} dummy load (and likely a very short cable) to test their modulation current source. This gives a better performance due to the impedance matching of the cable and the load. To give a more realistic picture of the performance, a real laser was used in this work and the modulation was recorded using a photodiode.

Figure \ref{fig:dgDrive_modulation_amplitude} shows a frequency sweep of the modulation input of the DgDrive using a Keysight \device{DSOX1102G} oscilloscope, which has a signal generator output to create simple Bode plots. The DgDrive current source was driving an in-house ECDL with a Thorlabs \device{LD785-H1} laser diode via a \qty{2}{\m} cable. The laser diode was impedance matched using a matching network in the laser head as presented in \cite{current_mod_paper}. The laser output amplitude was recorded using a Hamamatsu \device{S9055-01} \cite{datasheet_photodiode} photodiode with a transimpedance amplifier as discussed in \cite{thesis_tilman} and a $\qty{1}{\V_{rms}} \equiv \qty{1}{\mA_{rms}}$ modulation was applied. The laser power is proportional to the current modulation \cite{diodelaser_modulation} and can therefore be used to test the modulation capability of the driver. The amplitude shown in the graph was normalised to the average of the flat part below \qty{100}{\kHz} to calibrate out the transimpedance amplifier gain of the photodiode. The op-amp used by the DgDrive modulation current source was an ADI \device{AD8672} and not the \device{OPA2140} discussed above because a hardware revision 2.2.1 laser driver was used.
\begin{figure}[ht]
    \centering
    \input{images/dgDrive_modulation_input.pgf}
    \caption{Modulated output current over frequency, measured using a Thorlabs \device{LD785-H1} laser diode as the load. Source: \cite{thesis_tilman}.}
    \label{fig:dgDrive_modulation_amplitude}
\end{figure}

The frequency response of the modulation shown in figure \ref{fig:dgDrive_modulation_amplitude} demonstrates the excellent capability of the integrated modulation current source for the purpose of frequency stabilisation or frequency steering. It has a very flat and predictable amplitude and phase response up to \qty{1}{\MHz}. A slight gain peaking of \qty{2}{\decibel} (\qty{26}{\percent}) is seen at \qty{1.8}{\MHz}, due to the op-amp input capacitance and other parasitic capacitance of the PCB. At \qty{1}{\MHz} the gain peaking is \qty{0.78}{\decibel} (\qty{9}{\percent}) with a phase shift of \qty{-8}{\degree}. The \qty{3}{\dB} bandwidth is \qty{4}{\MHz}. Due to the gain peaking, the phase shift is \qty{-150}{\degree} -- unsuitable for a control loop, but it may still be used for modulation purposes. These values provide excellent behaviour in a control loop up to \qty{1}{\MHz} as desired in specification \ref{lst:dgDrive_specs_electrical}. Future revisions > 2.3.0 include an additional input resistor $R_f$, which serves two purposes, first it makes the design more robust against electrostatic discharge (ESD) and second, it can be configured as a low pass filter using $C_f$. This can help mitigate gain peaking if a faster op-amp is used. The optional capacitor $C_c$ was added in case a faster op-amp needs some compensation to prevent oscillations. It is normally unpopulated but makes the design more flexible.

To summarize the modulation current source properties, the following list is given.
\begin{center}
    \begin{deviceProperties}[label={lst:dgDrive_properties_modulation}]{DgDrive modulation input}
    \begin{itemize}
        \item Transconductance \qty{1}{\mA \per \V}
        \item \qty{3}{\decibel}-bandwidth \qty{4}{\MHz}
        \item Recommended maximum control loop bandwidth \qty{1}{\MHz} with \qty{8}{\degree} phase shift
    \end{itemize}
    \end{deviceProperties}
\end{center}

\subsection{Cables and Connectors}
\label{sec:cables_and_connectors}
This section covers the cables used for the digital current driver. These include the external connection to the laser head and the internal connection of the analog board with the front end user interface board.

Several cabling options for connecting the current driver with the laser head were investigated while testing different current drivers. Both twisted pair cables and coaxial solutions are employed in the field by different solutions. Vescent, for example, uses an SMA connector and a coaxial cable. This solution is a universal approach as an abundance of SMA cables can be found in any lab. On the other hand, the typical RG-316 cable used with SMA connectors is geared towards high frequency applications. This is reflected in the rather poor capacitance of around \qty{100}{\pF \per \m}, which can be improved to \qty{75}{\pF \per \m} by using larger RG-58X cables with a polyethylene (PE) foam dielectric \cite{datasheet_7808A}. A coaxial cable works well, when only a single conductor is required.

During the design of the new digital laser driver, it was clear, that the number of conductors would increase. The past has shown that additional features like protection circuitry and a fast current modulation input should be moved into the laser head. The laser head design was presented in \cite{current_mod_paper} and shall not be discussed here, but this design requires a dual voltage supply and a signal line to actuate the protection relay. On top of that, the voltage of the laser diode is remote sensed, directly at the laser diode, adding another pair of conductors.

In addition to the need for more conductors, experience has shown, that self-made cables are a common source of problems in the lab. The legacy laser driver design, employed in this group, used a LEMO \device{ERA.0S.303.CLL} socket at the laser and the driver. For these sockets, cables were typically self-made using a LEMO \device{FFA.0S.303.CLAC44} plug on both ends. While the quality of the connectors is excellent, their assembly requires skilled hands, which resulted in fluctuating quality. Switching to professionally made cables considerably improved the situation in the past. Using custom specialty cables has the disadvantage of limited availability, high cost and likely longer lead times, so an off-the-shelf solution was preferred.

The laser head connector must be mechanically secure, be able to handle a current of \qty{500}{\mA} or more and ideally be widely available. Moglabs and \citeauthor{laser_driver_digital_update} proposed a Digital Visual Interface (DVI) connector \cite{laser_driver_digital_update} and the same approach was also adopted in this work. The DVI cable, which nowadays is a DVI-D cable, only contains twisted pairs. There are also DVI-I cables, which carry legacy analog signals through coaxial conductors, but these are obsolete. This brings up the question of the difference between a twisted pair cable and a coaxial cable, which needs to be addressed.

The most mundane difference is that twisted pairs are cheaper to manufacture than coaxial cables and they require less space, allowing more conductor in a cable. On the other hand, at high frequencies, the impedance of a coaxial cable is more uniform than that of the twisted pair. Fortunately, the latter property has greatly improved in recent years and, for example, the DVI cable is rated for clock rates of \qty{165}{\MHz}, far more than is needed for this application. While the price difference and space savings are interesting for large installations it is less critical for this application, where signal integrity is premium.

Regarding noise immunity there is a profound difference between the two types of cables and electric and magnetic field coupling must be distinguished. A coaxial cable grounded at one end with a floating load offers fairly good protection against low frequency electric and magnetic field coupling, while at frequencies above about \qty{100}{\kHz}, the shield forms an antenna. For the floating shield to work, the laser head construction must ensure, that it does not have a ground connection, because as soon as both ends are grounded, a ground loop is formed. At low frequencies, magnetically induced noise current can then flow in the shield, which also serves as the return conductor. This introduces a noise voltage via the shield resistance, which must be minimized with a thick braid to reduce the resistance. On the other hand, high frequency noise above around \qty{100}{\kHz} is kept out and the skin effect helps to confine the current loop closer to the inner conductor, thereby reducing magnetic pickup. With a coaxial cable one must choose between good low frequency protection or high frequency noise attenuation.

Looking at the twisted pair cable, it has very good magnetic shielding due to the twisted wires as long as there are enough turns per unit length \cite{ott_electromagnetic, twisted_pair_magnetic_shielding}. The mutual capacitance between the two conductors of a twisted pair is also lower, although the conductors are closer together, but the different geometry helps.  In case of a shielded twisted pair there is also the capacitance between the shield and the two conductors in addition to the mutual capacitance. Through this capacitance, electric field interference can still couple into the cable. In order to reduce the susceptibility, it is important to keep the cable capacitance as low as possible, which can be achieved using an insulating material with a low relative permittivity $\epsilon_r$ for the twisted pairs. To meet their high frequency specification, DVI cables typically use a low $\epsilon_r$ dielectric, namely air injected PE foam. Another option would be expanded PTFE (ePTFE), which is a microporous structure that contains air and is held together by strands of PTFE. Finally, having a dedicated shield allows to use a hybrid grounding scheme, by only capacitively coupling the shield at one end. This breaks the ground loop, yet keeps the shield effectively grounded at high frequency. A good overview of different grounding schemes can be found in \citep[p. 72]{ott_electromagnetic}. In order to find a suitable cable several options were explored.

The cables tested for the laser driver are a DVIGear \device{SHR} \cite{dvigear_SHR}, a SUPRA Cables \device{DVI-DVI Single-Link} \cite{supra_dvi_cable}, an unbranded DVI cable for comparison and a Gore \device{RCN9034-24} Category 6a Ethernet cable \cite{gore_cat6}. The former three cables have a PE foam dielectric and \num{17} conductors while the latter is an ePTFE cable with \num{8} conductors. The DVIGear \device{SHR} cable does have the largest conductors with \qty{0.33}{\square\mm} (AWG22) followed by the SUPRA cable with \qty{0.26}{\square\mm} (AWG23), then the Gore \device{RCN9034-24} with a conductor diameter of \qty{0.20}{\square\mm} (AWG24) and finally the unbranded cable with just \qty{0.05}{\square\mm} (AWG30).

The twisted pairs of all DVI cables are triple shielded, using a foil around the pairs, then another foil around all conductors and finally a braid over the outer foil. The Gore Category 6a cable has a foil shield around the 4 pairs and a braid around all conductors. The braid helps with low frequency shielding and the more coverage it has, the better. Since the braid can never fully shield a cable, the foil is added to help with high frequency shielding. Figure \ref{fig:braid_coverage} shows the the shielding of several cables tested. The Supra Cables \device{DVI-DVI Single-Link} is not shown, because the braid coverage is similar to the DVIGear cable and a photo can also be found in the datasheet \cite{supra_dvi_cable}.
\begin{figure}[ht]
    \centering
    \begin{subfigure}[t]{0.45\linewidth}
        \centering
        \includegraphics[width=0.95\textwidth]{images/braid_coverage/14-39-55.jpg}
        \caption{Unbranded DVI cable. \qty{60}{\percent} braid coverage.}
        \label{fig:braid_coverage_unknown}
    \end{subfigure}
    \begin{subfigure}[t]{0.45\linewidth}
        \centering
        \includegraphics[width=0.95\textwidth]{images/braid_coverage/14-37-27.jpg}
        \caption{DVIGear \device{SHR}. \qty{80}{\percent} braid coverage.}
        \label{fig:braid_coverage_dvigear}
    \end{subfigure}
    \begin{subfigure}{0.45\linewidth}
        \centering
        \includegraphics[width=0.95\textwidth]{images/braid_coverage/14-57-9.jpg}
        \caption{Gore \device{RCN9034-24}. \qty{95}{\percent} braid coverage.}
        \label{fig:braid_coverage_gore}
    \end{subfigure}
    \caption{Braid coverage of several DVI cables and a Category 6a cable.}
    \label{fig:braid_coverage}
\end{figure}

The braid of the unbranded cable has the least coverage with about \qty{60}{\percent} calculated according to ANSI/SCTE 51 2018 \cite{ANSI_SCTE_51_2018}. In addition, the braid is made of aluminium instead of copper. This increases the impedance and typically reduces the effectiveness by about \qty{20}{\decibel} \cite{circuit_designers_companion}. The other cables have an \qty{80}{\percent} and a \qty{95}{\percent} copper braid coverage. The braid and foil shield combination is fairly effective up to several dozen \unit{MHz} \citep[p. 84]{ott_electromagnetic} covering the most important frequency range for this device if a decent copper braid is used.

As it was mentioned above, using a shielded cable brings more capacitance to the table. A factor that needs to be considered when shielding a current source as it reduces the output impedance. It is therefore important to have a more detailed look at the cable capacitance in this application. Neglecting the parasitic capacitances to earth ground, the two capacitances most interesting are the mutual capacitance between the conductors $C_m$ and the capacitance between each conductor and the shield $C_{ws}$, for details see \cite{twisted_pair_cable}. The cable capacitances of all cables were measured using an LCR Research \device{LCR Pro 1 Plus} and the results are given in table \ref{tab:dvi_cable_capacitance}. To measure the capacitance between the conductor and the shield, one of the twisted pairs was shorted to the shield using a DVI connector with a solder joint connecting both the shield and the conductor. The Category 6a cable was soldered together without a connector. The capacitance was then measured between the shorted pins and the remaining conductor. The measured total capacitance $C_{tot}$ is the paralleled capacitance between the shield and the conductor $C_{ws}$ and the mutual capacitance $C_m$. $C_{ws}$ can then be calculated as
\begin{equation*}
    C_{ws} = C_{tot} - C_m\,.
\end{equation*}

\begin{table}[ht]
    \centering
    \begin{tabular}{lccc}
        \toprule
        DVIGear \device{SHR}& $C_m$& $C_{ws}$& Conductor Size\\
        \midrule
        DVIGear \device{SHR}& \qty{49 \pm 1}{\pF \per \m}& \qty{46 \pm 1.5}{\pF \per \m}& \qty{0.33}{\square\mm}\\
        SUPRA \device{DVI Single-Link}& \qty{42 \pm 1}{\pF \per \m}& \qty{36 \pm 1.5}{\pF \per \m}& \qty{0.26}{\square\mm}\\
        Gore \device{RCN9034}& \qty{43 \pm 1}{\pF \per \m}& \qty{95 \pm 1.5}{\pF \per \m}& \qty{0.20}{\square\mm}\\
        Unbranded DVI dual link& \qty{42 \pm 1}{\pF \per \m}& \qty{41 \pm 1.5}{\pF \per \m}& \qty{0.05}{\square\mm}\\
        \bottomrule
    \end{tabular}
    \caption{Measured cable capacitance for two DVI cables using a PE foam dielectric and an ePTFE Category 6a cable. All values were measured at \qty{10}{\kHz}.}
    \label{tab:dvi_cable_capacitance}
\end{table}

All DVI cables tested fared well regarding the capacitance and gave a similar performance of the mutual capacitance when compared to the ePTFE Category 6a Gore \device{RCN9034}. Given the measurement uncertainties of the \device{LCR Pro 1 Plus} no distinction can be made. Due to the smaller outer diameter of the Gore cable the shield capacitance unfortunately doubles.% In addition, to the low capacitance, the DVI cables are available off-the-shelf in good quality if some care is exercised. The connector itself is relatively rugged and cables in various lengths are available. Unfortunately, availability has declined over the years with the move towards HDMI, DisplayPort and USB-C connections. For example, the DVIGear \device{SHR} cables, which were tested, are mostly discontinued by now. This issue might need addressing in the long-term.

To give a figure for the capacitance seen by the current source, it must be determined, whether the circuit is balanced or unbalanced. Remembering section \ref{sec:results_precision_current_source} and especially figure \ref{fig:dgDrive_current_source} on page \pageref{fig:dgDrive_current_source} where the current source schematic was shown, it is clear, that the circuit is not balanced. The virtual ground has very little impedance, while the other conductor presents a high impedance current source via the MOSFET of the current sink. The virtual ground is the most sensitive node. Any noise current injected into it cannot be distinguished from the drive current. Noise current is injected via capacitive coupling, so the capacitance seen by the virtual ground node is the most important. This is analogous to transimpedance amplifier input node. This capacitance seen is $C_{tot}$ measured above. Looking at the number it can be seen that a DVI cable is indeed a good choice for this use case as it has the least capacitance when compared to the Gore Cat6a cable or a typical coaxial cable, which has about \qty{100}{\pF \per \m}.

The final decision was made in favor of the SUPRA \device{DVI Single-Link} cable, because of its decent shielding and very low capacitance, while being readily available in contrast to the DVIGear cables, some of which have already been given the end-of-life status.
A word of caution regarding the unbranded DVI cable needs be said. In addition to the meager shielding, the \qty{0.05}{\square\mm} wire is not recommended for carrying  \qty{500}{\mA} because it has a resistance of about \qty{330}{\milli\ohm \per \m}, Using a cable of \qty{3}{\m} length would already drop \qty{1}{\V} (or \qty{500}{\mV} when using a dual link cable) at \qty{500}{\mA}. The \qty{0.26}{\square\mm} cable chosen, for comparison, only drops \qty{82}{\mV} using a single link.
\begin{figure}[ht]
    \centering
    \scalebox{3}{%
        \import{figures/}{DVI_connector.tex}
    } % scalebox
    \caption{Pin layout of the DgDrive DVI connector. Ground is gray, positive voltages red, negative voltages blue, digital i/o pins brown. White pins are not connected.}
    \label{fig:dvi_connector_pin_layout}
\end{figure}

With the cable chosen, the connector layout needs to be discussed. DVI-D cables come in two flavours, single link and dual link cables. Dual link cables have twice the number of data lines. These data lines are called TMDS data lines. Those pairs and the clock line are shielded twisted pairs, each pair wrapped in an aluminium foil. Depending on the type of cable, it has \num{17} or \num{23} pins with either \num{3} or \num{6} TMDS lines. Each shield is brought out with a separate pin except for the additional TMDS lines in the dual link configuration. The shields of the additional neighbouring TMDS lines is connected together so only \num{4} pins are required to connect the shields of the TMDS and clock line twisted pairs as shown in figure \ref{fig:dvi_connector_pin_layout}. Apart from the shielded twisted pairs, there are \num{5} conductors available for additional functions. Theses conductors are neither shielded nor twisted. The connector layout of the DVI port of the digital current driver is shown in figure \ref{fig:dvi_connector_pin_layout}. A number of twisted pairs are left unconnected (NC) for future applications and some cannot be used because they are part of the legacy analog function of the DVI connector. Pin 8 and pins C1 to C5 are can only be used with a DVI-I digital and analog cable. As mentioned above, these cables have became rare as analog displays are mostly extinct.
\begin{table}[ht]
    \centering
    \begin{tabular}{llll}
        \toprule
        Pin    & Function    & Pin    & Function\\
        \midrule
        \numrange{1}{2}& NC& \num{14}& \qty[retain-explicit-plus]{+12}{\V}\\
        \num{3}& Shield, GND& \num{15}& GND\\
        \numrange{4}{5}& NC& \num{16}& Open-collector, enable laser\\
        \num{6}& \qty{-12}{\V}& \numrange{17}{18}& NC\\
        \num{7}& EEPROM& \num{19}& Shield, GND\\
        \num{8}& NC& \numrange{20}{21}& NC\\
        \num{9}& LD cathode& \num{22}& Shield, GND\\
        \num{10}& LD anode& \num{23}& LD voltage sense positive\\
        \num{11}& Shield, GND& \num{24}& LD voltage sense negative\\
        \num{12}& LD cathode& C5& GND\\
        \num{13}& LD anode& & \\
        \bottomrule
    \end{tabular}
    \caption{DVI connector pin layout. See figure \ref{fig:dvi_connector_pin_layout} for the pin labels.}
    \label{tab:dvi_connector_pin_layout}
\end{table}

Pin \num{9} and \num{10} are used to deliver the laser diode drive current, while the shielded clock line on pins \num{23} and \num{24} are used to sense the diode voltage. When a dual link cable is used, pin \num{12} and \num{13} are also used to carry current. Using a single link cables reduces the capacitance in comparison to a dual link cable.

The other conductors are used to supply the laser head with a \qty{\pm 12}{\V} rail and to actuate the protection relay in the laser head. Additionally, there is an  electrically erasable programmable read-only memory (EEPROM) chip inside the laser to identify it. This chip can be read using a one-wire protocol via pin \num{7} and contains information about the laser diode and maximum current settings, the date of assembly of the laser and more.

As discussed above, the shielding and grounding plays an important role to suppress noise. The digital current driver uses a floating DC power supply to supply the sub rack. The subrack is connected to chassis ground and so is the front panel of the current driver through the SMA connectors. The DVI cable shield is also connected to the front panel of the current driver and the system ground. This chassis forms the path of least impedance for any noise current present and diverts it around the PCB ground plane. On the laser side the shield is connected to the laser head, which is grounded as well to protect the laser from electrostatic discharge (ESD). The PCB inside the laser head is only connected to the return conductor, effectively staying inside the shield.

Finally the cable for connecting the display board with the analog board is presented. The analog board and the front panel are two separate boards as the current driver design is a modular concept. Both PCBs feature separate microcontrollers that communicate via a digital Inter-Integrated Circuit (I²C) bus. The cable is shielded as well and is grounded on the analog board as well as capacitively coupled via a \qty{10}{\nF} capacitor on the digital front panel board to keep the digital signals from interfering with the analog board. It is a 5 conductor cable as shown in figure \ref{fig:dgDrive_display_cable}. For example, a Belden \device{9535} cable can be used, but any other foil shielded cable can be used. The use of a foil is recommended because it is most effective for shielding against high frequency signals. The connectors are from the JST \device{PHR} series and currently the cable features an asymmetric layout. Initially the front panel board did not contain a separate microcontroller and the display required more control lines. It was found during development that a self-sufficient board is easier to maintain and also able to support more features like USB. The number of connectors was therefore reduced. The \num{7}-pin header on the analog side will be replaced with a \num{6}-pin header on both side with revision 2.4.0 of the analog board.
\begin{figure}[ht]
    \centering
    \scalebox{0.8}{%
        \import{figures/}{cable_dgDrive_display.tex}
    } % scalebox
    \caption{Display cable used to internally connect the display board with the analog board. The \num{7}-pin header is deprecated and will be replaced with a \num{6}-pin header.}
    \label{fig:dgDrive_display_cable}
\end{figure}
\begin{table}[hb]
    \centering
    \begin{tabular}{llllll}
        \toprule
        Pin& Function& Colour& Pin& Function& Colour\\
        \midrule
        \num{1}& \qty[retain-explicit-plus]{+3.3}{\V}& Red& \num{4}& I²C SCL& Green\\
        \num{2}& GND& Black& \num{5}& Interrupt& White\\
        \num{3}& I²C SDA& Brown& \num{6}& Shield& --\\
        \bottomrule
    \end{tabular}
    \caption{Display cable pin layout. See figure \ref{fig:dgDrive_display_cable} for the connector layout.}
    \label{tab:dgDrive_display_cable_pin_layout}
\end{table}

\subsection{Test Results: Output Impedance}%
\label{sec:output_impedance}
There are several ways of measuring the output impedance of a current source. Two such methods were used to test the output impedance of the current source and are shown in figure \ref{fig:measuring_output_impedance}.
\begin{figure}[ht]
    \centering
    \begin{subfigure}{0.35\linewidth}
        \centering
        \import{figures/}{measuring_output_impedance_dc.tex}
        \caption{DC scheme.}
        \label{fig:measuring_output_impedance_dc}
    \end{subfigure}
    \begin{subfigure}{0.55\linewidth}
        \centering
        \import{figures/}{measuring_output_impedance_ac.tex}
        \caption{AC scheme.}
        \label{fig:measuring_output_impedance_ac}
    \end{subfigure}
    \caption{Two methods for measuring the output impedance of a current source.}
    \label{fig:measuring_output_impedance}
\end{figure}
Figure \ref{fig:measuring_output_impedance_dc} shows the simpler scheme. It can be used to determine the static output impedance at DC and its setup only requires three components, an ammeter or multimeter, a resistor, and a switch. The resistor value should be scaled such that $R_{shunt} \cdot I_{out}$ is just below the compliance voltage of the current source to maximize the resolution. To calculate the output impedance, the following steps are required. The current flowing through the shunt is measured using the ammeter and then the switch is closed to short out the resistor and the current is measured again. Assuming the resistance of the switch and the internal shunt of the ammeter is very small in comparison to $R_{out}$ the current source is essentially shorted and it can be seen in figure \ref{fig:measuring_output_impedance_dc} that all current $I_{out}$ is flowing through the switch and the ammeter when the switch is closed. When opened, the current is split between $R_{shunt}$ and $R_{out}$. This allows calculating $R_{out}$ as
\begin{equation}
    R_{out} = \frac{R_{shunt} \cdot I_{shunt}}{I_{out} - I_{shunt}} = \frac{V_{shunt}}{\Delta I}\,. \label{eqn:output_impedance_dc}
\end{equation}

The shunt resistance $R_{shunt}$ can usually be determined with sufficient accuracy, but the difference in $\Delta I$ between to current with and without $R_{shunt}$ is an entirely different matter though. Given a high impedance source, $\Delta I$ is naturally small. For educational purposes this problem can be illustrated by measuring the output impedance of the digital laser driver, which is expected to be very high due to the novel current source configuration discussed in the last section.

The measurement shown in \ref{fig:dgDrive_output_impedance_dc} was conducted according to figure \ref{fig:measuring_output_impedance_dc}. The ammeter was a \num{7.5} digit Keysight \device{34470A} multimeter and the shunt resistor value was $R_{shunt} = \qty{3.298 \pm 0.002}{\mega\ohm}$, which was measured using a Keysight \device{3458A}. The output current was chosen as low as reasonably possible to allow for a larger shunt resistor to improve the sensitivity. The DMM settings were \qty{10}{\plc} with autozeroing enabled. To further improve the sensitivity a \qty{30}{\second} sample was taken for both switch positions to allow for additional averaging. Using the same settings, the measurement noise floor was determined first. A \qty{30}{\second} sample with open inputs resulted in a noise floor of \qty{7.1}{\pA_{rms}} using the \device{34470A} on the \qty{10}{\uA} range. This noise floor is low enough to be neglected as can be seen below. The measurement was then repeated with the setup shown in figure \ref{fig:measuring_output_impedance_dc}. Since the output impedance of the current source is so high and even though the noise of the current source is extremely low with only \qty{1.5}{\nA_{rms}} ($\equiv \qty{6}{\nA \per \A}$ referred to full scale output) over \qty{30}{\s}, the difference between the two switch settings is hardly recognizable. Figure \ref{fig:dgDrive_output_impedance_dc} shows, in orange, the mean value of both measurements before and after switching in the shunt resistor. Longer measurement or integration times in an attempting suppress more noise are ineffective due to the presence of flicker noise in the current source, rendering longer integration times futile.
\begin{figure}[ht]
    \centering
    \input{images/dgDrive_output_impedance_dc.pgf}
    \caption{Measurement of the output current using the technique illustrated in figure \ref{fig:measuring_output_impedance_dc}. $R_{shunt} = \qty{3.298 \pm 0.002}{\mega\ohm}$, $I_{out} = \qty{2.72 \pm 0.0015}{\uA}$. The shunt resistor was switched in at $T = \qty{30}{\s}$. The DMM was nulled before the measurement.}
    \label{fig:dgDrive_output_impedance_dc}
\end{figure}

The results nulled to \qty{2.72}{\uA} and extracted from figure \ref{fig:dgDrive_output_impedance_dc} are
\begin{align}
    I_{out} &= \qty{2.72}{\uA} + \qty{-0.31 \pm 1.48}{\nA} & I_{shunt} &= \qty{2.72}{\uA} + \qty{1.54 \pm 1.10}{\nA}\,. \label{eqn:measurement_output_impedance_dc}
\end{align}

There are two things to note about the result $\Delta I = \qty{-1.85}{\nA}$. First, the output current increases when the resistor is switched in which can also be seen from the negative sign of $\Delta I$. This means the output impedance is negative, which will be discussed below in more detail. The other issue concerns the statistical uncertainty. As it can be seen, the uncertainty of $\Delta I$ is in excess of \qty{50}{\percent} of its value. This means that applying the conventional approach of using the mean value and applying the simplified formula for the propagation of uncertainty
\begin{equation*}
    \sigma_f(x,y,...) \approx \sqrt{\left(\frac{\partial f}{\partial x} \sigma_x \right)^2 + \left(\frac{\partial f}{\partial x} \sigma_y\right)^2 + \dots}
\end{equation*}
will yield improper results for the calculation of $R_{out}$ since it requires the uncertainty to be limited to a close neighbourhood around the mean because the formula is only an approximation. More background information on working with asymmetric or large uncertainties can be found in \cite{asymmetric_uncertainty}.

There are several ways to address the problem and a common solution is a Monte Carlo simulation to calculate both the expected value of $R_{out}$ and its uncertainty. Such a simulation was prepared in Python and the source file can be found at \external{data/simulations/sim\_output\_impedance\_mc.py} as part of the online supplemental material \cite{supplemental_material}. For the simulation, the uncertainties of $R_{shunt}$ and the measurement noise floor were neglected because they are very small in comparison to the uncertainty of $\Delta I$. The same goes for the systematic uncertainty resulting from the DMM calibration error of $R_{shunt}$ and $I_{out}$. The simulation uses \num{e8} samples, which are drawn from a normal distribution of \qty{1.85 \pm 1.56}{\nA} to calculate the output impedance applying equation \ref{eqn:output_impedance_dc}. Drawing from a normal distribution is technically not correct because the measurement noise contains significant flicker noise, which is not white. Since the result is expected to have considerable uncertainty anyway, which gives a result of questionable significance, this is acceptable though. Using the samples drawn, $R_{out}$ was calculated and \num{81.6e6} results were found the range $\left[0, \qty{20}{\giga \ohm}\right]$. Those are shown in the histogram given in figure \ref{fig:dgDrive_output_impedance_dc_mc}.
\begin{figure}[ht]
    \centering
    \input{images/dgDrive_output_impedance_dc_mc.pgf}
    \caption{Monte Carlo simulation to derive the output impedance of the DgDrive from the parameters given in \ref{eqn:measurement_output_impedance_dc}.}
    \label{fig:dgDrive_output_impedance_dc_mc}
\end{figure}

From the largest bin of the histogram and the one-$\sigma$ range the following result for the static output impedance
\begin{equation*}
    R_{out} = 2.7\substack{+4.70 \\ -0.64}\,\unit{\giga\ohm}
\end{equation*}
was found.

From the simulation results one can gather that the DC output impedance is likely a lot higher than \qty{2}{\giga\ohm}. Given the high value of $R_{out}$ measurement technique can only yield limited results. These limits are imposed by the current noise of the source and its flicker noise character. As explained in section \ref{sec:flicker_noise} this type of noise cannot be averaged out or filtered to yield a better uncertainty. It must be stressed though that this is not a problem with the source, but rather the measurement technique. The source itself allows measurements down to \qty{6}{\nA \per \A} over \qty{30}{\second}, which is a very low noise figure. To get more conclusive results a different approach is therefore needed. Using the method shown in figure \ref{fig:measuring_output_impedance_ac}, a signal generator in combination with an oscilloscope or a network analyser can be used to determine the output impedance over a wide frequency range. Moving away from DC is beneficial since the laser driver current source relies on op-amps and their gain. The output impedance therefore declines with increasing frequency. This way, the limited resolution of the previous measurement can be evaded. Additionally, the output impedance frequency spectrum can reveal a lot more details about the current source as will be discussed next.

The setup shown in figure \ref{fig:measuring_output_impedance_ac} puts a few requirements on the signal generator/VNA and the amplifier that need to be addressed first. The measurement setup can be configured in two ways as shown in figure \ref{fig:measuring_output_impedance_challenges} below. One approach requires a floating signal generator because the resistor is ground referenced and the other technique requires a floating or differential amplifier because the signal generator is grounded. Due to this nature, the whole measurement becomes more of a test of CMRR and ground isolation than anything else. This statement will be briefly elucidated to help understand the final solution implemented.

Starting with a ground referenced amplifier as shown in figure \ref{fig:measuring_output_impedance_cmrr}, it is clear that the amplifier sees the common-mode voltage $V_{cm}$ produced by the signal generator on both inputs. An ideal amplifier is unaffected by $V_{cm}$ and has a common-mode gain $A_{cm} = 0$, but any amplifier existing in reality has both a common-mode and a differential mode gain $A_d$ with the CMRR defined as \citep[p. 328]{tietze_1991}
\begin{equation*}
    CMRR \coloneqq \frac{A_d}{A_{cm}}\,.
\end{equation*}
\begin{figure}[ht]
    \centering
    \begin{subfigure}{0.4\linewidth}
        \centering
        \import{figures/}{measuring_output_impedance_cmrr.tex}
        \caption{Grounded signal generator.}
        \label{fig:measuring_output_impedance_cmrr}
    \end{subfigure}
    \begin{subfigure}{0.5\linewidth}
        \centering
        \import{figures/}{measuring_output_impedance_isolation.tex}
        \caption{Floating signal generator.}
        \label{fig:measuring_output_impedance_isolation}
    \end{subfigure}
    \caption{Different configurations of the amplifier have a profound effect on the measurement. Placing the signal generator on top gives significant coupling to ground, yet allows a single-ended amplifier.}
    \label{fig:measuring_output_impedance_challenges}
\end{figure}

The common-mode rejection quickly becomes a problem, because a larger output impedance implies a smaller differential signal albeit the same common-mode signal. Therefore the CMRR of the amplifier presents an upper limit to the sensitivity in this configuration. The most frequently used amplifier for this situation is a so-called instrumentation amplifier, which is a difference amplifier with buffered high impedance inputs \cite{tietze_1991}. It is a design based on three op-amps and the CMRR is mostly limited by the matching of four internal resistors. To give some numbers, a \qty{1}{\kilo\ohm} shunt resistor in combination with a modern high precision instrumentation amplifier like the Texas instruments \device{INA821} \cite{datasheet_INA821} will give a CMRR of around \qty{120}{\decibel} limiting the maximum output impedance that can be measured to $R_{out} \ll \qty{1}{\giga \ohm}$. Increasing $R_{shunt}$ is impractical, because the CMRR will also drop with increasing source imbalance due to the input impedance of the instrumentation amplifier. AC coupling the amplifier as shown in figure \ref{fig:measuring_output_impedance_cmrr} aggrandizes the CMRR problem discussed before. In addition to the common-mode rejection of the amplifier, the transfer function of both high-pass filters has to be closely matched as well, because a gain mismatch translates into a decreased CMRR. Matching those filters to \num{e-6} is a tedious venture.

Alternatively, the signal generator can be floated and placed above the shunt resistor as shown in figure \ref{fig:measuring_output_impedance_isolation}. This allows to use a singled ended amplifier, which can be easily AC coupled to remove the DC offset. While this takes care of the CMRR issues, it creates another one. The signal generator may have a isolated outputs, but there is still a capacitive coupling $C_{iso}$ to earth and if either the amplifier, the current source, or the oscilloscope is connected to protective earth an AC leakage current can be observed. Using a high value shunt resistor of several \unit{\mega \ohm} to improve the signal-to-noise ratio (SNR) of the measurement exaggerates the problem, especially around the line frequency, and multiples thereof. This foiled any attempts to measure the output resistance at low frequencies. Using a low capacitance isolation transformer could solve this issue, but there is a solution, that promises fewer sources of error.

Instead of floating the signal generator or using a differential amplifier, the amplifier can be floated as well. Battery driven amplifiers, like the Stanford Research \device{SR560} or the Signal Recovery \device{5113} are available off-the-shelf and include additional filters and a variable gain. Using a floating amplifier either requires an isolated oscilloscope or an isolated differential probe to connect a grounded oscilloscope. Amplifying the signal first greatly relaxes the common-mode rejection and noise requirement of the active probe allowing the use of commercial off-the-shelf solutions. The performance difference between an isolated oscilloscope and isolated probe only depends on the input capacitance of the device or probe as the capabilities of battery driven scopes has vastly improved in recent years and their performance matches that of mains powered scopes in this application. Both option will be compared below.
\begin{figure}[ht]
    \centering
    %current_regulator_TIA_simple_output_impedance.asc was used for the simulation
    \input{images/dgDrive_output_impedance_comparison.pgf}
    \caption{Measured output impedance of several laser diode drivers. The shaded region is the limit imposed by a \qty{3}{\m} RG-213 coaxial cable with a capacitance of \qty{315}{\pF} between conductor and shield. The coloured dashed lines show the results of an LTSpice simulation.}
    \label{fig:dgDrive_output_impedance_comparison}
\end{figure}

The instruments used for the dynamic output impedance measurement were a Keysight \device{33522B} signal generator, a Stanford Research \device{SR560} \cite{datasheet_SR560}, a Sapphire \device{HVP70} differential probe and a Keysight \device{MSO9254A} oscilloscope. Additionally, a Rohde \& Schwarz \device{RTH1004} \cite{datasheet_RTH1004} isolated battery powered oscilloscope and an Omicron \device{Bode 100} \cite{datasheet_bode100} VNA was used for parts of the measurement. The devices tested were the Vescent \device{D2-105-500}, the Moglabs \device{DLC-102}, the Sisyph \device{SMC11} and the DgDrive-250, a \qty{250}{\mA} version of the current driver. An overview of all versions is shown in table \ref{tab:dgDrive_configurations} on page \pageref{tab:dgDrive_configurations}. The shunt resistor was mounted in a test fixture and connected via a \qty{1}{\m} RG-213 coaxial cable to the driver, either directly or via a DVI adaptor. The cable length was deliberately kept short to limit the cable capacitance as the impedance of that capacitance is in parallel with the output impedance of the current source and therefore presents an upper limit to the output impedance measurable at high frequencies. The commercial drivers were tested using a \qty{10}{\ohm} shunt resistor while the \device{DgDrive-250} required several different shunt resistors to meet the signal-to-noise requirements. The results of the measurements are shown in figure \ref{fig:dgDrive_output_impedance_comparison}.

Both the Sisyph \device{SMC11} and the Vescent \device{D2-105-500} show a familiar characteristic. The output impedance is reminiscent of the simulation shown in figure \ref{fig:output_impedance_libbrecht_hall} on page \ref{fig:output_impedance_libbrecht_hall}. This is not surprising as Vescent claims, in the datasheet \cite{datasheet_vescent_laser_driver}, that the heritage of their driver is the design by \citeauthor{libbrecht_hall} \cite{libbrecht_hall}. Regarding the \device{SMC11} this is unknown but it is likely that a similar circuit for the modulation current source is used. Moglabs on the other hands employs a different circuit as confirmed by the author. The output impedance of those three drivers is nonetheless limited, at low frequencies, by the resistor matching of the modulation current source. Going above \qty{1}{\kHz} the op-amp gain becomes the major limiting factor as discussed in section \ref{sec:modulation_current_source}. The peaking of the output impedance seen with both the \device{D2-105-500} and the \device{SMC11} around \qty{1}{\MHz} stem from the test fixture and its parasitic effects, including the impedance mismatch from connecting a current source to a low impedance sink. Some of the parasitic effects are shown in figure \ref{fig:measuring_output_impedance_parasitics} and will discussed along with the output impedance of the \device{DgDrive-250}.

All commercial current drivers share the same problem, the limited output impedance of the modulation current source confines the combined current source to below \qty{1}{\mega\ohm}. Assuming a \qty{3}{\m} cable length required to connect the laser with the laser driver, none of these drivers manage to get close to the physical limit imposed by a \qty{3}{\m} RG-213 coaxial cable. RG-213 cables are commonly used in experimental setups and the ones used in the group have a measured capacitance of \qty{105}{\pF \per \m}. Do note, the \device{DLC-102} and the \device{DgDrive-250} use a DVI cable with less capacitance, but both the \device{SMC11} and the \device{D2-105-500} have an SMA output for the laser current and such a connection would likely be adopted in a real situation. The \qty{315}{\pF}-limit is shown as a dotted black line with a light blue fill below in figure \ref{fig:dgDrive_output_impedance_comparison}. The values within the blue shaded region marks the output impedance physically realisable when a \qty{315}{\pF} capacitor is connected in parallel to a high impedance current source. This means that the commercial drivers do not utilize the full potential to suppress external noise sources because a higher output impedance serves the purpose of suppressing current noise as detailed in section \ref{sec:ideal_current_source} on page \pageref{sec:ideal_current_source}. The topic of noise will be discussed in depth in the next section \ref{sec:results_current_noise}.

The \device{DgDrive-250} (serial number: \#13) required special attention when measuring its output impedance. First of all, this current source has a floating output, which makes a floating output of the signal generator mandatory. It also means that the oscilloscope measuring the signal generator voltage needs two isolated inputs one for the signal generator and one for the shunt resistor signal. To facilitate this, the \device{MSO9254A} was replaced with the fully isolated, battery powered \device{RTH1004}. In addition to that complication, the output impedance of the laser driver is so high that at low frequencies between \qty{0.5}{\Hz} and \qty{110}{\Hz} a \qty{1}{\mega\ohm} resistor had to be used to reach the required signal-to-noise ratio. The test current was set to \qty{5}{\uA} for the \qty{1}{\mega\ohm} resistor, which had no bearing on the result due to the novel current source design. This can be confirmed using the LTSpice simulation found at \external{source/spice/current\_regulator\_TIA\_simple\_output\_impedance.asc}. Between \qty{260}{\Hz} and \qty{250}{\kHz} the \qty{1}{\mega\ohm} shunt was replaced by a \qty{1}{\kilo\ohm} resistor and the current was increased to \qty{5}{\mA}. Beyond that, a \qty{49.9}{\ohm} shunt resistor was used and the current again increased to \qty{50}{\mA}. Along with the change to a \qty{49.9}{\ohm} shunt resistor the amplifier was removed and the signal was directly fed into the \device{RTH1004}, because the bandwidth of the \device{SR560} is limited to \qty{1}{\MHz} \cite{datasheet_SR560}. The low noise \qty{10}{\bit} ADC of the \device{RTH1004} \cite{datasheet_RTH1004} was able to compensate for the loss in gain. In order to reduce parasitic effects, the shunt resistor was a small 0805 SMD high power (\qty{250}{\mW}) resistor, that was soldered between the pins of an isolated BNC connector. Using this scheme it was possible to measure the output impedance between \qty{0.5}{\Hz} and \qty{10}{\MHz} without significant distortion. Towards lower frequencies, the measurement is limited by noise and the minimum cutoff frequency of \qty{0.03}{\Hz} of the band-pass filter in the \device{SR560} \cite{datasheet_SR560}. Nonetheless \qty{1}{\giga\ohm} at \qty{1}{\Hz} was measured, which agrees well with the results from the DC measurement shown above. Towards higher frequencies, the output impedance drops by an order of magnitude per decade of frequency -- the typical behaviour of an RC filter. This RC filter is created by the parasitic capacitance of the test fixture and the \qty{1}{\m} coaxial cable used to connect the driver to the fixture. That cable is an RG-213 coaxial cable soldered to pins of a DVI connector. The test fixture including the cable was measured as having a capacitance of \qty{155}{\pF}. This capacitance is between the output and the return path of the current source. Additionally, the input capacitance of the \device{RTH1004} must be considered. Its value is \qty{12}{\pF} \cite{datasheet_RTH1004} and it is connected in parallel with the shunt resistor. These parasitic capacitances are shown in figure \ref{fig:measuring_output_impedance_parasitics} for better illustration.
\begin{figure}[ht]
    \centering
    %\scalebox{0.5}{%
        \import{figures/}{measuring_output_impedance_parasitics.tex}
    %} % scalebox
    \caption{Simplified setup for measuring the output impedance including the mutual capacitance of the cable $C_m$ and the parasitic input capacitance $C_{in}$ of the instrument.}
    \label{fig:measuring_output_impedance_parasitics}
\end{figure}

Figure \ref{fig:measuring_output_impedance_parasitics} shows a model of the test setup along with the most prominent parasitic effects. The mutual capacitance between the two conductors $C_m$ of the current driver output lead is in parallel with the output resistance $R_{out}$. In addition, the input capacitance $C_{in}$ of the measurement instrument is in parallel with the shunt resistor $R_{shunt}$. The measurement instrument is either the \device{Bode 100} VNA, the \device{SR560} amplifier, or the \device{RTH1004} oscilloscope along with a \qty{25}{\cm} RG-213 coaxial cable.

Using these numbers a simulation in LTSpice was conducted and the results are also shown in figure \ref{fig:dgDrive_output_impedance_comparison} as dashed lines of the same colour as the corresponding measurement trace. From the agreement of the simulation, when the parasitics are included, with the impedance measurement, it can be inferred that this measurement only delivers a lower bound, constrained by the test setup. Nonetheless, the \qty{155}{\pF} capacitance of the test setup gives a reasonable approximation of the real-life situation. As measured in section \ref{sec:cables_and_connectors} and presented in table \ref{tab:dvi_cable_capacitance} on page \pageref{tab:dvi_cable_capacitance}, the DVI cable has a mutual capacitance of \qtyrange[range-units = single]{42}{49}{\pF \per \m}, depending on the model. The \qty{155}{\pF} therefore represents a typical value for a \qty{3}{\m} cable and the results presented in figure \ref{fig:dgDrive_output_impedance_comparison} can be anticipated in real-life situations.

To confirm the results obtained using the signal generator and the oscilloscope, the measurement was repeated using a different setup. The generator and the oscilloscope was replaced by an Omicron \device{Bode 100} VNA. This setup needs some introduction because, as before, the signals of interest have different ground potentials. The VNA itself can be floated but its inputs and outputs share the same ground reference and must therefore be individually isolated. To inject the modulation, a Picotest \device{J2101A} injection transformer was used to isolate the output. The injected signal behind the transformer, referenced to the low side of the current source, was sampled using a Sapphire \device{HVP70} differential probe. The second input, sampling the shunt voltage, was floated to the shunt resistor potential. The shunt was a \qty{1}{\kilo\ohm} resistor without the \device{SR560} preamplifier to simplify the setup. Therefore, is was only possible to cover the frequency range between \qty{100}{\Hz} and \qty{10}{\MHz}. The lower limit comes from the signal to noise ratio and the upper limit is given by the injection transformer bandwidth of about \qty{10}{\MHz} \cite{datasheet_j2101a}. As can be seen in figure \ref{fig:dgDrive_output_impedance_comparison}, both measurements agree very well. The only difference is visible at frequencies above \qty{1}{\MHz}. The flattening of the output impedance curve is caused by the input capacitance of the VNA (\qty{55}{\pF}, \cite{datasheet_bode100}). To understand this, figure \ref{fig:measuring_output_impedance_parasitics} can again be consulted to aid with the following explanation.

The output impedance shown in figure \ref{fig:dgDrive_output_impedance_comparison} is calculated without parasitics and only valid if the assumption
\begin{align}
    R_{out} &= \frac{v_{mod}}{i_{shunt}} - R_{shunt} & i_m &\ll i_{shunt} & i_{in} &\ll i_{shunt} \label{eqn:measurement_output_impedance_ac}
\end{align}
holds. As can be seen from the parasitics shown in figure \ref{fig:measuring_output_impedance_parasitics} the validity of the assumptions made about the parasitic currents is frequency dependent as the impedance of the parasitic capacitances is determined by frequency. It also depends on the respective resistances $R_{out}$ and $R_{shunt}$. The current $i_m$, flowing into the cable capacitance, is the most sensitive parasitic because $R_{out}$ is very large. $C_m$ must therefore be kept very low. If $i_m \ll i_{shunt}$ cannot be satisfied, a substantial current flows around $R_{out}$ and applying equation \ref{eqn:measurement_output_impedance_ac} without taking this into account makes the output impedance look smaller. This is responsible for the one decade per decade roll-off seen in figure \ref{fig:dgDrive_output_impedance_comparison} as already mentioned above. The effect of $i_{in}$ can only be seen at high frequencies or large values of $R_{shunt}$. For this reason, $R_{shunt}$ must be reduced with increasing frequency. This was done by going from a \qty{1}{\mega\ohm} resistor to a \qty{1}{\kilo\ohm} and then to a \qty{50}{\ohm} resistor. Skipping this procedure causes the effect seen in the measurement conducted with the VNA. Using a fixed \qty{1}{\kilo\ohm} resistor in combination with the larger input capacitance of the VNA leads to an apparent increase of the output impedance at frequencies above \qty{1}{\MHz}, which is entirely due a systematic measurement error. This can also be reproduced in the simulation by inserting the capacitor $C_{in} = \qty{55}{\pF}$ into the model as shown in figure \ref{fig:measuring_output_impedance_parasitics}. Those simulation results are shown as a dashed blue line in figure \ref{fig:dgDrive_output_impedance_comparison}.

When comparing the simulation with the measured results a drop in the output impedance by a factor of \num{2} at \qty{1}{\kHz} is currently not well understood. It could be due of the test fixture, which was already found to be the limiting element of the measurement. There are plans to revise the test fixture and replace it with a dedicated PCB along with amplifiers directly on the board to reduce the capacitance seen by the current source. This would give a clearer picture on the source of this phenomenon.

The results shown in this section can be summarized as follows. A high output impedance is desirable to ensure a good noise immunity of the current source as shown in figure \ref{fig:ideal_current_source_thevenin} on page \pageref{fig:ideal_current_source_thevenin}. The output impedance of all commercial laser drivers tested were limited by the output impedance of the modulation current source and measured below \qty{1}{\mega\ohm} at low frequencies. This limit was shown to be result of the resistor matching in the modulation current source. It can be expected to vary widely between individual samples of the devices as explained in figure \ref{fig:ltpsice_howland_mc_output_impedance} on page \pageref{fig:ltpsice_howland_mc_output_impedance}. The \device{DgDrive-250} was demonstrated to have a very high output impedance of at least \qty{1}{\giga\ohm} at \qty{1}{\Hz}, which was the limit of the test setup, rather than that of the \device{DgDrive-250}. At higher frequencies, the field of tested drivers moves closer together, because the output impedance is limited by the bandwidth of the op-amps used. All drivers are within a range of \qty{100}{\ohm} to \qty{1}{\kilo\ohm} at \qty{1}{\MHz}.

None of the commercial current drivers tested reached the physical limits imposed by the external cabling. A typical \qty{3}{\m} RG-213 coaxial cable was chosen as an example for connecting the laser driver. Of the drivers tested, the Moglabs \device{DLC-102} has shown the best performance between \qty{100}{\Hz} and \qty{100}{\kHz}, a range containing a lot of noise sources like fluorescent overhead lights and switch mode power supplies. The Vescent \device{D2-105} and Sisyph \device{SMC11} demonstrated a similar behaviour as seen with the design of the original paper presented by \citeauthor{libbrecht_hall} \cite{libbrecht_hall}. Those drivers could do lot better by improving on the modulation current source circuit. The Vescent \device{D2-105} driver has generally shown the worst performance in this test, so a poor noise immunity is expected in later tests.

The DgDrive in turn managed to push the limits of a low capacitance DVI cable and delivered a performance only limited by the cable capacitance which translates in a superior noise rejection capability compared to the commercial devices. The noise performance will be discussed next.
\begin{center}
    \begin{deviceProperties}[label={lst:dgDrive_output_impedance}]{DgDrive output impedance}
    \begin{itemize}
        \item $R_{out} \geq \qty{1}{\giga\ohm}$ at \qty{1}{\Hz}
        \item $R_{out}$ is limited by the capacitance of the DVI cable not the driver
    \end{itemize}
    \end{deviceProperties}
\end{center}

\subsection{Test Results: Current Noise}%
\label{sec:results_current_noise}
The spectral current noise density is a quantity, that is both seemingly trivial to measure and also easy to understand and graphically compare. Therefore, it is a figure widely by manufacturers and many devices are emblazoned by such graphs. The upside is that these numbers can used for reference although comparing devices is not trivial, because the noise depends on the output current range as discussed in section \ref{sec:current_source_noise}.

Defining the bandwidth of such a measurement is a matter of debate and depends on the future use-case of the current driver. In this work an upper frequency of \qty{1}{\MHz} was chosen for two reasons, first, to limit the number of amplifiers required. As the noise power rises with the bandwidth (in the best case as $\sqrt{\Delta f}$ for white noise) and impedance matching comes into play, a higher power amplifier is required, a trait that does not bode well with low noise, low frequency front ends. So for frequencies above a few \unit{\MHz} more than one amplifier is called for. Additional amplifiers make the whole measurement more intricate, because the amplifiers are the most critical parts in the whole chain.

The second reason does not root in the laziness of the researcher, but has a physical origin. Cables used in the lab like RG-58 or RG-223 have a capacitance of about \qty{100}{\pF \per \m}. With a cable length of \qty{3}{\m}, resulting in \qty{300}{\pF}, one finds that at \qty{10}{\MHz} the impedance seen by the laser diode approaches \qty{50}{\ohm}. Not unsurprising, given that the cable design impedance is \qty{50}{\ohm} and a signal at \qty{10}{\MHz} has a wavelength of $\lambda \approx \qty{2}{\m}$ calling for impedance matching. At this point the performance of a current source is naturally limited as discussed in the previous section and the laser should be stabilized to an external reference using a current source closer to the laser diode like in the laser head as demonstrated by \citeauthor{current_mod_paper} \cite{current_mod_paper}.

The measurement technique used in this section is a simple shunt resistor, through which the current is sourced to convert the current noise into a voltage noise. An AC coupled amplifier is then used to amplify the voltage noise. This measurement setup is owed to the fact, that most publications \cite{laser_driver_digital,laser_driver_qcl_taubman,libbrecht_hall,laser_driver_mosfet_noise} and commercial drivers \cite{datasheet_LQprO,moglabs_noise_noise_measurement,datasheet_vescent_laser_driver} use this method and it therefore allows intercomparison. A better signal-to-noise ratio could be achieved using a transimpedance amplifier configuration, which would provide more gain and less noise. Nonetheless, sufficient SNR can be achieved using a \qty{10}{\ohm} resistor and a low noise amplifier (LNA). A \qty{10}{\ohm} resistor was chosen to keep the load on the current driver low to exclude any compliance voltage related effects. These will be discussed separately at the end of this section. Using a test current of \qty{50}{\mA} gives a voltage drop of only \qty{500}{\mV}, well below the typical forward voltage of a laser diode, compliance voltage related effect should therefore not be visible. In addition, using \qty{250}{\mA} and \qty{2.5}{\V} is close to the specifications of the Thorlabs \device{L785H1} \cite{datasheet_thorlabs_780nm} laser diode used in the group. Both scenarios can be covered using a single resistor, simplifying the setup.

A \qty{10}{\ohm} resistor creates a thermal noise density of \qty{400}{\pV \per \Hz\tothe{0.5}}. This excludes the \device{SR560} as an amplifier, because it would severely limit the measurement by its own noise figure of \qty{4}{\nV \per \Hz\tothe{0.5}} \cite{datasheet_SR560}, the equivalent of a \qty{1}{\kilo\ohm} resistor. While the \device{SR560} uses a FET input amplifier with a very high input impedance and low input current noise, the \qty{10}{\ohm} input impedance allows the use of bipolar transistors at the input of the amplifier similar to the front end shown in figure \ref{fig:op-amp_input_stage} on page \pageref{fig:op-amp_input_stage}. Bipolar transistors are more sensitive to the source impedance since they do not present a high impedance input like a JFET, resulting in a higher input current noise, but achieving a lower voltage noise in return. A design based on the amplifier presented in \cite{appnote_low_noise_amp} with a noise floor of \qty{460}{\pV \per \Hz\tothe{0.5}}, a \qty{3}{\decibel}-bandwidth of \qty{10}{\Hz} to \qty{1.5}{\MHz} and a fixed gain of \qty{80}{\decibel} (\num{e4}) was built for this purpose. The amplifier is powered by alkaline batteries to prevent mains hum from entering the amplifier through the power supply. The input impedance is only \qty{500}{\ohm}, so this has to be taken into account for the source impedance of \qty{10}{\ohm} as proposed above. The voltage divider formed will reduces the gain to about \num{9800}.
\begin{figure}[ht]
    \centering
    \input{images/lna_background_noise.pgf}
    \caption{Noise floor of the low noise amplifier based on \cite{appnote_low_noise_amp}.}
    \label{fig:noise_lna}
\end{figure}

Figure \ref{fig:noise_lna} shows the noise of the amplifier in two configurations. One with the input shorted and the other with a \qty{10}{\ohm} resistor between the inputs. The latter was corrected for the reduced gain and presents the intrinsic noise of the current noise measurement setup. The white noise floor including the \qty{10}{\ohm} resistor is at \qty{615}{\pV \per \Hz\tothe{0.5}}, which agrees well with theory, which predicts
\begin{equation*}
    \sqrt{\left(\qty{400}{\pV \per \Hz\tothe{0.5}}\right)^2 + \left(\qty{450}{\pV \per \Hz\tothe{0.5}}\right)^2} = \qty{610}{\pV \per \Hz\tothe{0.5}}\,.
\end{equation*}
The noise floor is mostly white with two exceptions. Even though the amplifier is battery powered, the \qty{50}{\Hz} mains frequency and its third harmonic highlights a weakness of such low noise amplifiers. They are very susceptible to magnetic pickup and must be shielded (preferably in mild steel) and kept away from linear power supplies with large transformers. In practice, a distance of \qty{3}{\m} from any linear power supply was found to be sufficient. One potential issue regarding the amplifier noise must be mentioned here. The amplifier does not use a voltage regulator and is directly powered from the batteries. This has the advantage of requiring fewer batteries but comes at the cost of affecting the amplifier performance. As can be seen in figure \ref{fig:op-amp_input_stage}, the current flowing through the transistors is not regulated with a current source and only relies on a resistor and the supply voltage. With a decreasing supply voltage the current through the input transistors reduces and the amplifier noise increases. To reach the performance shown in figure \ref{fig:noise_lna} a fresh set of batteries is required.

To measure the spectral density shown in figure \ref{fig:noise_lna}, multiple recording devices were used since no low frequency FFT analyser or the like was available. At low frequency the digitizing function of a Keysight \device{34470A} DMM with a sampling rate of up to \qty{10}{\kHz} was utilised for the range of \qtyrange[range-phrase={~to~}]{0.1}{260}{\Hz}. A Keysight \device{MSO9254A} oscilloscope was used between \qty{260}{\Hz} and \qty{40}{\kHz}, and above that, a Tektronix \device{RSA306} USB spectrum analyser (SA) served to measure up to \qty{1}{\MHz}. Each range was band-pass filtered using an SRS \device{SR560} connected after the LNA. The \device{SR560} is also responsible for the gain dropping off towards \qty{1}{\MHz}. The time-domain data collected by the DMM and the oscilloscope, was converted into its frequency representation using an algorithm developed by \citeauthor{welch} \cite{welch} to estimate the power spectrum.

An LTSpice simulation of the circuit was also conducted, but it slightly overestimates the noise figure of the \device{THAT300} NPN transistor array yet still gives reasonable results. The SPICE model used was the noise model provided by the manufacturer \cite{THAT300_noise_model}. The simulated data is included in figure \ref{fig:noise_lna} as solid orange lines for reference.

The system noise floor of \qty{615}{\pV \per \Hz\tothe{0.5}} or \qty{61.5}{\pA \per \Hz\tothe{0.5}} obtained from figure \ref{fig:noise_lna} limits the resolution of the test setup to laser drivers with a current noise of about \qty{100}{\pA \per \Hz\tothe{0.5}}. In this case an error of \qty{17}{\percent} is incurred, which must be kept in mind. Lower noise drivers require a larger resistor as the resistor noise scales with $\sqrt{R}$ while the gain scales with $R$. For the very low noise drivers a \qty{1}{\kilo\ohm} resistor was chosen and the test current was reduced to \qty{5}{\mA}. Since the LNA does not work well with a source impedance of \qty{1}{\kilo\ohm} and the thermal noise of the resistor is \qty{4}{\nV \per \Hz\tothe{0.5}}, on par with the \device{SR560}, the latter can be used standalone without the additional low noise preamplifier.
\begin{figure}[ht]
    \centering
    %\resizebox {0.9\textwidth} {!} {
        \import{figures/}{laser_driver_noise_measurement_setup.tex}
    %} % resizebox
    \caption{Power and grounding scheme for the current noise measurement. The shunt and amplifier are located \qty{3}{\m} away from the power supply to prevent magnetic coupling.}
    \label{fig:laser_driver_noise_measurement_setup}
\end{figure}

The test setup shown in figure \ref{fig:laser_driver_noise_measurement_setup} requires utmost care in order to not introduce ground loops that erroneously show up as noise from the current source. To ensure this, all measurement instruments either had floating inputs or were battery powered without a direct connection to earth. The Keysight \device{34470A} DMM has floating inputs, the Keysight \device{MSO9254A} oscilloscope was used with an isolated differential probe and the Tektronix \device{RSA306} SA was powered via an ALLDAQ \device{ADQ-USB 3.0-ISO-W} USB 3.0 isolator to remove the high frequency noise coming from the host computer. The isolated side of the USB 3.0 isolator connected to the \device{RSA306} was supplied through an Agilent \device{E3631A} linear power supply. All amplifiers were always powered from battery. The full setup including grounding is shown in figure \ref{fig:laser_driver_noise_measurement_setup}. All laser drivers except the \device{DgDrive-500-LN} used the power supply that came with the unit to give an example of the full system performance that can be expected out of the box. The \device{DgDrive-500-LN}, which does not come with a power supply of its own, was tested with both an Agilent \device{E3631A} linear supply and a R\&S \device{HMP4040} switch-mode supply to demonstrate the suppression of the input filter, which was already examined in section \ref{sec:supply_filtering}. As mentioned before, the custom low noise amplifier and the \device{SR560} as well are very sensitive to magnetic coupling. Since shielding at this level either requires an expensive mu-metal box or a thick steel box, the amplifier was instead moved away from any large transformers, namely the power supplies of the drivers. The shunt resistor was connected via a \qty{3}{\m} cable as shown in figure \ref{fig:laser_driver_noise_measurement_setup}, also resulting in a more realistic scenario when compared to a typical laser setup. The effect of different cables and lengths on the current source output was discussed in the previous section \ref{sec:output_impedance}.

The results of the measurements are shown in figure \ref{fig:laser_driver_noise_measurement} and the performance each device will now be discussed, starting with the Toptica \device{DCC 110}. Although the \device{DCC 110} is a legacy device no longer sold by Toptica, it was widely adopted and is still used in many labs, including the \qty{441}{\nm} diode laser system intended for the ARTEMIS experiment. Unfortunately, the driver has shown the worst performance of all devices tested. A whole range of mains harmonics can be seen. Additionally, there is substantial interference around \qty{15}{\kHz} and its harmonics. On top of that, the baseline noise density is around \qty{10}{\nA \per \Hz\tothe{0.5}} dropping off at \qty{10}{\kHz} probably due filtering of the reference. The noise floor then levels off at \qty{300}{\pA \per \Hz\tothe{0.5}}.

\begin{figure}[hp]
    \centering
    \rotatebox{90}{
        \input{images/laser_driver_noise_measurement.pgf}
    } % rotatebox
    \caption{Noise spectra of several current drivers tested. The \device{DgDrive-500-LN} and the \device{SMC11} were measured to \qty{1}{\Hz} using the \device{SR560} and a \qty{1}{\kilo\ohm} shunt resistor to improve the SNR. The amplifier noise floor was not subtracted form the measurements. The legend is ordered by the noise density in descending order.}
    \label{fig:laser_driver_noise_measurement}
\end{figure}

The next device evaluated was the LQO LQprO-140 developed at the neighbouring group \textit{Laser und Quantenoptik} \cite{ThorstenFuehrer}. The author would like to thank the group for providing a demo device for testing. The unit came in small rack with an integrated power supply. The author was pleasantly surprise of the little mains hum or harmonics present from this supply. Apart from the few mains harmonics up to \qty{350}{\Hz} there no other noise present. The noise floor itself was lower than the one presented by Toptica, but unfortunately the \qty{<300}{\pA \per \Hz\tothe{0.5}} claimed in the datasheet \cite{datasheet_LQprO} cannot be confirmed. A feature of this driver might be a boon and a bane at the same time and be responsible for the high noise floor. The driver has a full-scale modulation input with a bandwidth of \qty{200}{\kHz} \cite{datasheet_LQprO}, so aggressive filtering of the current source setpoint with a low cutoff is not possible and therefore quite some noise is present up to \qty{200}{\kHz}. Some of this noise is introduced by its linear regulators and with this feedback considerable improvements were made by \citeauthor{thesis_holger} \cite{thesis_holger}, bringing the driver closer to the performance of the Moglabs \device{DLC-102} discussed next.

The Moglabs \device{DLC-102} displays a flat noise floor of \qty{500}{\pA \per \Hz\tothe{0.5}}. Moglabs gives several numbers for the output noise of their between \qty{100}{\pA \per \Hz\tothe{0.5}} and \qty{250}{\pA \per \Hz\tothe{0.5}}, but it is not clear to which version of the driver these numbers refer. This number is likely owned to the fact that the \device{DLC-102} has a high compliance voltage of \qty{6}{\V}, which is the highest of all drivers tested. With a circuit architecture like the precision current source discussed in \ref{sec:precision_current_source}, a low value sense resistor must be employed. This in turn results in less transconductance gain, which increases the current noise as discussed in section \ref{sec:current_source_noise} and shown in table \ref{tab:current_source_noise_contributers} on page \pageref{tab:current_source_noise_contributers}. The \qty{50}{\Hz} noise and harmonics are likely due to the unshielded transformer integrated into the unit as part of the power supply. The large, solitary peak at \qty{250}{\kHz} is due to the local oscillator of the integrated lock-in amplifier. The oscillator can be disabled completely by adjusting internal trimpots. This was not done for the noise measurement because the origin of the peak is known, deliberately placed there and had no bearing on the measurement.

The Vescent \device{D2-105-500} delivered a performance close the LNA noise limit discussed above. With a measured noise of \qty{120}{\pA \per \Hz\tothe{0.5}}, the actual noise floor is closer to \qty{100}{\pA \per \Hz\tothe{0.5}} when subtracting the amplifier noise, which is well below the conservatively specified \qty{<200}{\pA \per \Hz\tothe{0.5}} \cite{datasheet_vescent_laser_driver}. The driver is susceptible to mains hum though, most likely coupled magnetically. The power supply that came with driver, a Vescent \device{D2-005}, had a fairly short lead and used an E-core transformer inside, responsible for some magnetic leakage. The close proximity of the power supply in combination with the limited output impedance discussed in the previous section on page \pageref{fig:dgDrive_output_impedance_comparison} leads to a strong coupling. Due to the \qty{50}{\Hz} noise, the driver is not capable of meeting the required \qty{30}{\nA_{rms}} noise figure (see specification \ref{lst:dgDrive_specs_electrical}). At frequencies below \qty{10}{\Hz} no measurement was possible because the cutoff frequency of the LNA is \qty{10}{\Hz}. Using a larger resistor and the \device{SR560} was not feasible because the compliance voltage of the driver is limited to around \qty{2.5}{\V} and going above that, severe noise peaking was seen. Nonetheless, the noise corner frequency of the device at \qty{80}{\Hz} can be seen. This is due to the input current noise of the \device{AD797} op-amp used in the current source in combination with the setpoint filter as discussed in section \ref{sec:voltage_reference}. The flicker noise part is expected to start below this frequency. As a final note, all noise tests were conducted with the display board disconnected, as there was strong interference at \qty{22.5}{\kHz} and harmonics coming from this board. The issue was disclosed to Vescent in 2018-02 and reported fixed as of 2018-08 \cite{vescent_email}, but no retesting was done.

The Sisyph \device{SMC11} claims an even lower noise and indeed the noise floor reached \qty{12}{\pA \per \Hz\tothe{0.5}} at \qty{15}{\kHz} but was it not flat at all. The low noise figure seems to come from some very aggressive filtering of the current source using a very large inductor found on the PCB. In order to push the amplifier noise floor below that of the laser driver, the device was tested with shunt voltage of \qty{5}{\V} and a \qty{1}{\kilo\ohm} shunt as discussed above. While this marks the upper end of the compliance voltage as per the datasheet, it was still within the limits and given the low current of \qty{5}{\mA} no issues should be expected. Nonetheless, significant peaking around \qty{500}{\kHz} and above is seen, obliterating the noise performance of the driver. Additionally an issue, likely with the power supply that came with the unit, can be observed in the noise spectrum. There is a significant amount of sub-harmonics below the \qty{50}{\Hz} mains frequency present, which point towards inductive saturation of the power supply transformer. Another problem can be noticed by looking at the low frequency performance. One would typically expect a flicker noise behaviour below the filter cutoff with the noise increasing at a rate of \qty{20}{\decibel \per decade} coming from the reference and the op-amps. When comparing the low frequency performance of the \device{DgDrive-500-LN} it can clearly be seen that noise rises more like \qty{30}{\decibel \per decade} pointing towards a mix of random walk and drift as discussed in section \ref{sec:allan_deviation}. This will be picked up in the next section when discussing the stability of the driver.

The last device to be discussed is the \device{DgDrive-500-LN} (serial number: \#14), which is a low-noise \qty{500}{\mA} version. The noise measurement was again conducted using a \qty{1}{\kilo\ohm} shunt resistor with a compliance voltage of \qty{5}{\V}. The driver has a flat noise floor of \qty{65}{\pA \per \Hz\tothe{0.5}} up to around \qty{100}{\kHz} where it appears to drop off. This is due to the reduced output impedance as shown in figure \ref{fig:dgDrive_output_impedance_comparison} on page \pageref{fig:dgDrive_output_impedance_comparison}. The output impedance at \qty{100}{\kHz} is only \qty{5}{\kilo\ohm} and therefore a considerable influence of the \qty{1}{\kilo\ohm} shunt resistor, which forms a voltage divider can be seen. Towards the low frequency end, the noise rises with the expected \qty{20}{\decibel \per decade}. The flicker noise is mostly coming from the \device{AD797} op-amp input current noise as discussed in section \ref{sec:voltage_reference}. There is no additional noise coming from the mains or power supply and the noise spectrum is completely free of additional peaks. Electrical coupling from mains is suppressed by the filtered supply and magnetic coupling into the cable is efficiently suppressed using a twisted pair (DVI) cable along with the very high output impedance effectively preventing radiated noise from entering the cable. The performance of the the input filter can be seen again in figure \ref{fig:laser_driver_noise_hmp4040}, which shows the \device{DgDrive-500-LN} in comparison to another \device{DgDrive-500-LN} being powered by a R\&S \device{HMP4040} switch-mode supply. This power supply has substantial noise at the switching frequency of \qty{130}{\kHz} and its harmonics, which was confirmed by the author in a separate measurement not shown here, but an example of the noise spectrum can be found in \cite{hmp4040_noise}.
\begin{figure}[ht]
    \centering
    \input{images/laser_driver_noise_hmp4040.pgf}
    \caption{Current noise of two \device{DgDrive-500-LN}. One is powered by a R\&S \device{HMP4040} switch-mode supply, the other by a linear supply. There is no excess noise measurable at the switching frequency of \qty{130}{\kHz}.}
    \label{fig:laser_driver_noise_hmp4040}
\end{figure}

The noise floor of the two drivers is identical and only the high frequency behaviour is slightly different. This is due to a missing USB isolator between the \device{RSA306} spectrum analyser and the computer, which is required at this noise level to prevent ground loops. The simulation results, which contain an accurate noise model of the Zener diode and the DAC, shown as a solid black line, are in very good agreement with the measurements. The noise model was built by the author from noise measurements of the \device{LM399} and the \device{AD5781}. At low currents like in figure \ref{fig:laser_driver_noise_hmp4040}, most of the noise comes from the reference filter and the input current noise of the \device{AD797}. At currents above \qty{10}{\percent} of the maximum output, the \device{LM399} becomes the major contributor of noise below \qty{1}{\Hz}. This can only be improved by using a lower noise reference like the ADI \device{ADR1399} in future revisions, which is currently subject to testing.

Figure \ref{fig:laser_driver_noise_hmp4040} also includes the shot noise limit
\begin{equation}
    S_{shot} = \sqrt{2 e I}
\end{equation}
for different laser diode injection currents. The shot noise limit translates into an amplitude noise limit at the quantum level for, e.g. optically pumped lasers. The drive current noise of a current source as described in this work can be well below the shot noise limit though. Given a high impedance current source such as the \device{DgDrive}, the laser light can be amplitude squeezed below the shot noise limit as demonstrated by \citeauthor{diode_laser_shot_noise1} \cite{diode_laser_shot_noise1}. While this property was not confirmed in a measurement because there is currently no application for amplitude squeezed light in the group, it can be estimated that the laser driver is sufficiently low noise to produce squeezed light. For this estimation a Thorlabs \device{L785H1} \cite{datasheet_thorlabs_780nm} laser diode is used as an example. The free-running laser diode is specified  for an output power of \qty{200}{\mW} at \qty{785}{\nm} and \qty{220}{\mA} of current. This leads to a current of
\begin{equation}
    I_{laser} = P_{out} \cdot \frac{\lambda}{h c} \cdot \frac{1}{\qty{6.242e18}{\coulomb}} \approx \qty{127}{\mA}
\end{equation}
involved in the lasing process. The free-running laser diode may therefore display amplitude squeezed light because the \qty{500}{\mA} driver is able beat the shot noise limit at \qty{20}{\mA} of drive current as can be seen in figure \ref{fig:laser_driver_noise_hmp4040}. For an ECDL with that same laser diode, the requirement are stricter because the efficiency is lower. Typically ECDLs built in the group are characterised with \qty{80}{\mW} at \qty{780}{\nm} and \qty{190}{\mA} \cite{thesis_tilman}. This leads to a limit of \qty{50}{\mA}, which is still above the noise limit of the driver. Unfortunately, the matter is not that simple as an additional source of noise stemming from the feedback of the laser diode, called longitudinal-mode-partition noise \cite{laser_squeezed_light2,laser_squeezed_light}, degrades the squeezing. Given the low output current noise of the laser driver further investigations into this matter are warranted in the future because amplitude squeezed light can offer interesting possibilities. Squeezed light can considerably increase the detection sensitivity beyond the standard quantum limit in applications where amplitude changes are observed, like Michelson interferometers \cite{shot_noise_ligo} or the detection of small amplitude modulations \cite{shot_noise_amplitude_modulation}.

A final aspect that must be mentioned is the behaviour of this type of current source with different load voltages. As discussed in section \ref{sec:compliance_voltage}, the MOSFET must be biased into saturation for optimal performance. Failing to do so, will create strong noise peaking due to the reduction in loop-gain, and hence the transconductance, of the precision current source. Since the design of the digital current driver is different and the issue less pronounced, as can be seen from the noise measurement with a load voltage of \qty{5}{\V} in figure \ref{fig:laser_driver_noise_hmp4040}, the Vescent \device{D2-105-500} is used here as an example instead. For this measurement a \qty{10}{\ohm} shunt resistor was used and the current was gradually increased, thus increasing the load voltage, which at the same time decreases the drain-to-source voltage $V_{DS}$ of the MOSFET. This behaviour effectively defines a maximum  usable compliance voltage, where the device is still within its noise specifications. This is unfortunately only a soft limit as the driver will still function beyond this limit and give no indication of the diminished performance. There is no possibility to sense the load voltage on the driver side with any of the commercial drivers tested. The \device{DgDrive}, on the other hand, reads out  the load voltage digitally and allows accesses via an integrated analog output to monitor the voltage.

Figure \ref{fig:vescent_gain_peaking} shows the consequence decreasing the drain-to-source voltage $V_{DS}$ from \qty{9.8}{\V} to \qty{0.5}{\V}. There are two apparent effects. The first is an increase in the noise floor of the driver. The origin of this is not the driver, but rather the amplifier. As discussed above, the noise of the amplifier increases with decreasing battery voltage and those measurements were all recorded with the same set of batteries over the course of several hours. The noise floor below \qty{200}{\pA \per \Hz\tothe{0.5}} therefore seems to increase between the measurements. This can be safely ignored and is not part of the discussion. The more interesting part is the noise at the high frequency end. With decreasing $V_{DS}$ a pronounced noise peak starts building up due to the reduced transconductance of the MOSFET as discussed in section \ref{sec:precision_current_source} and also observed by \citeauthor{laser_driver_mosfet_noise} \cite{laser_driver_mosfet_noise}. At $V_{DS} = \qty{0.5}{\V}$ the current source is past the maximum compliance voltage and it drops out of regulation causing a massive increase of noise over the whole spectrum bringing the driver well above its specification. The exact voltage of when this happens was not determined because as discussed in section \ref{sec:precision_current_source} the limit is expected to vary between individual samples of the device, but those number allow to estimate the maximum compliance voltage. The Vescent \device{D2-105-500} uses a \qty{11}{\V} supply voltage, a \qty{12}{\ohm} sense resistor and adds about \qty{1.3}{\ohm} of resistance after the MOSFET coming from an inductor and a small damping resistor. Using these numbers  and taking \qty{1.7}{\V} from figure \ref{fig:vescent_gain_peaking} as the minium $V_{DS}$, the maximum compliance voltage at the specified output current of \qty{500}{\mA} can be estimated as
\begin{align}
    V_{comp} &= V_{sup} - V_{sense} - V_{DS} - V_{inductor} \nonumber\\
    &= \qty{11}{\V} - \qty{500}{\mA} \cdot \qty{12}{\ohm} - \qty{1.7}{\V} - \qty{500}{\mA} \cdot \qty{1.3}{\ohm} \nonumber\\
    &= \qty{2.65}{\V}\,. \nonumber
\end{align}

Do note that the \qty{12}{\ohm} sense resistor and the typical \qty{7}{\V} reference voltage indicates a maximum output current of \qty{580}{\mA} but the driver is only specified for \qty{500}{\mA}, so the latter value is used for the estimation. The maximum compliance voltage of \qty{2.65}{\V} limits the use of this driver to NIR laser diodes when operating at full output current. Alternatively limiting the current to \qty{100}{\mA} allows to meet the requirement of \qty{8}{\V} for blue laser diodes as defined in specification \ref{lst:dgDrive_specs_electrical} at the expense of the higher current noise of a \qty{500}{\mA} driver in comparison to a \qty{100}{\mA} driver.
\begin{figure}[ht]
    \centering
    \input{images/vescent_gain_peaking.pgf}
    \caption{Increasing current noise peaking as the load voltage is increased up to a total failure of regulation when $V_{DS}$ has dropped to \qty{0.5}{\V}. Measured using a \qty{10}{\ohm} shunt resistor.}
    \label{fig:vescent_gain_peaking}
\end{figure}

To summarize the results of this section, it was shown that the unique architecture of the \device{DgDrive} combined with the ultra low noise performance ensures a predictable low noise performance of the current driver even under full load and high compliance voltage requirements. Other commercial current drivers tested had, in part, a noise floor magnitudes higher, stability problems and severe compliance voltage issues at higher output currents. Additionally due to the excellent filtering and very high output impedance, noise in the current source output is effectively suppressed and was not measurable and well below the noise floor of the device. This was demonstrated for both \qty{50}{\Hz} mains hum and noise from a switch-mode power supply used to power the driver. The current noise is so low that the \device{DgDrive-500-LN} beats the shot-noise limit at currents above \qty{20}{\mA}. The \device{DgDrive-500-LN} and the Sisyph \device{SMC11} are the only laser drivers to have less than \qty{30}{\nA_{rms}} noise over a bandwidth of \qty{100}{\kHz}. The Sisyph \device{SMC11} unfortunately demonstrates strong noise peaking at \qty{500}{kHz} that brings the driver well above the noise figure of the \device{DgDrive-500-LN} making the \device{DgDrive} the overall lowest noise laser driver available.

Figure \ref{fig:laser_driver_noise_measurement} on page \pageref{fig:laser_driver_noise_measurement} along with table \ref{tab:laser_driver_noise_measurement} can be used to judge the noise performance of the current state of the art systems commercially available. This allows intercomparison using a common basis.
\begin{table}[ht]
    \centering
    \begin{tabular}{lcc}
        \toprule
        Laser driver& Current noise, \qty{10}{\Hz} to \qty{100}{\kHz}& Current noise, \qty{10}{\Hz} to \qty{1}{\MHz}\\
        \midrule
        Toptica \device{DCC 110}& \qty{1.67}{\uA_{rms}}& \qty{1.74}{\uA_{rms}}\\
        LQO \device{LQprO}& \qty{471}{\nA_{rms}}& \qty{555}{\nA_{rms}}\\
        Moglabs \device{DLC-102}& \qty{128}{\nA_{rms}}& \qty{521}{\nA_{rms}}\\
        Vescent \device{D2-105}& \qty{42.0}{\nA_{rms}}& \qty{114}{\nA_{rms}}\\
        Sisyph \device{SMC11}& \qty{8.57}{\nA_{rms}}& \qty{76.9}{\nA_{rms}}\\
        \device{DgDrive-500-LN}& \qty{19.1}{\nA_{rms}}& \qty{27.7}{\nA_{rms}}\\
        \bottomrule
    \end{tabular}
    \caption{Integrated current noise for different bandwidths of the lasers drivers compared in figure \ref{fig:laser_driver_noise_measurement}. The table is ordered by the noise figure integrated over \qty{10}{\Hz} to \qty{1}{\MHz} in descending order.}
    \label{tab:laser_driver_noise_measurement}
\end{table}

\begin{center}
    \begin{deviceProperties}[label={lst:dgDrive_current_noise}]{DgDrive current noise performance}
    \begin{itemize}
        \item Current noise density \qty{<70}{\pA \per \Hz\tothe{0.5}} above \qty{100}{\Hz}
        \item Current noise density \qty{<=1.6}{\nA \per \Hz\tothe{0.5}} at \qty{1}{\Hz} for $I_{out} <= 0.1 I_{max}$
        \item Current noise density \qty{<=10}{\nA \per \Hz\tothe{0.5}} at \qty{1}{\Hz} for $I_{out} = I_{max}$
        \item Current noise of \qty{19.1}{\nA_{rms}} in \qty{10}{\Hz} to \qty{100}{\kHz} bandwidth
        \item Output noise is independent of the compliance voltage up to \qty{10}{\V}
        \item The noise spectrum is devoid of external noise even when using a switch-mode power supply
        \item \device{DgDrive-500-LN} is below the shot noise for $I_{out} \geq \qty{20}{\mA}$
    \end{itemize}
    \end{deviceProperties}
\end{center}

\subsection{Test Results: Temperature Stability}%
\label{sec:results_temperature_stability}
As it was shown in section \ref{sec:design_goal_environment}, the ambient temperature can vary by as much as \qty{2}{\kelvin} in a typical temperature stabilized environment. The laser driver must therefore be tested in a representative temperature range. The racks typically have a temperature of around \qty{26}{\celsius} when actively cooled. The laser driver was tested in a custom thermal chamber and the ambient temperature was swept several time from \qtyrange[range-units = single, range-phrase={~to~}]{20}{30}{\celsius}. At the same time, the voltage over a \qty{10}{\ohm} or \qty{100}{\ohm} Vishay \device{VPR221Z} shunt was measured using a Keysight \device{3458A}, depending on the output current of \qty{50}{\mA} and \qty{510}{\mA}. The shunt was mounted in an aluminium housing and its temperature was monitored using a Keithley \device{DMM6500} and a PT100 glued to the shunt.

Repeating the test for a low current output and additionally for the maximum output allows to discriminate between the temperature coefficient (tempco) resulting from offset drifts and voltage reference drifts because at low output values the effect of the reference voltage is scaled down. In case of the \device{DgDrive-500-LN} at \qty{50}{\mA} by factor of $50/510$ making it almost negligible. In this case op-amp offset drifts and other drifts from effects like thermal EMF dominate the temperature coefficient while effects that are proportional to the output are suppressed. At full output the voltage reference drift is fully added and also the drift of the sense resistor is more pronounced.

Another effect that can only be seen at full output is burst noise coming from the Zener diode used as a reference. This manifest a sudden jumps in the output current. The \device{DgDrive-500-LN} \#14 tested uses one of the earlier revisions of the reference board that contains an affected Zener diode, which was discovered during those tests. This issue and its solution is discussed in more detail in the next section.

As it was discussed in section \ref{sec:voltage_reference}, great care was taken to reduce the offset related drift, which can be seen in figure \ref{fig:dgDrive_tempco_50mA}. These efforts were rewarded with a very low temperature coefficient of $\qty{97}{\nA \per \K} \equiv \qty{0.19}{\uA \per \A \per \K}$ when running at \qty{10}{\percent} output current. At a maximum current of \qty{510}{\mA} the drift of the sense resistor and the Zener diode add to the result and the temperature coefficient increases to $\qty{348}{\nA \per \K} \equiv \qty{0.68}{\uA \per \A \per \K}$. These results are typical number for this batch as all sense resistors are from the same batch, ordered directly from Vishay. In addition, the summing and averaging of the two current sources reduces the spread between resistor samples even further.

Other laser driver were tested in a similar fashion if it was possible to fit them into the thermal chamber. Not all drivers were tested, because as can be seen on the timescale of figure \ref{fig:dgDrive_tempco_50mA}, these tests very slow temperature ramps to suppress hysteresis effects. Larger devices like the Moglabs \device{DLC-102} or the Vescent \device{D2-105} were placed in a cooling cabinet and once the current had stabilised, the door was opened to apply a step change of about \qty{10}{\K}. The results are summarised in table \ref{tab:temperature_coefficient_overview}.
\begin{table}[ht]
    \centering
    \begin{tabular}{lll}
        \toprule
        Device& Tempco at \qty{50}{\mA}& Tempco at full current \\
        \midrule
        LQO \device{LQprO} & \qty{8.6}{\uA \per \A \per \K}& --\\
        Moglabs \device{D2-105} & \qty{1.3}{\uA \per \A \per \K}& --\\
        Vescent \device{DLC-102} & \qty{3.5}{\uA \per \A \per \K}& --\\
        \device{DgDrive-500-LN} & \qty{0.19}{\uA \per \A \per \K}& \qty{0.68}{\uA \per \A \per \K}\\
        \bottomrule
    \end{tabular}
    \caption{Tempco of several laser drivers tested. Scaled to full scale output.}
    \label{tab:temperature_coefficient_overview}
\end{table}

The \device{SMC11} was also tested, but not found stable enough over time to make out a temperature coefficient against the drift and low frequency noise of the device. It is therefore not included in table \ref{tab:temperature_coefficient_overview}. The low frequency noise encountered is shown in figure \ref{fig:stability_smc11} and discussed in section \ref{sec:results_stability}.

\begin{figure}[hp]
    \centering
    \input{images/dgDrive_tempco_50mA.pgf}
    \caption{Output current drift of a \device{DgDrive-500-LN} running at \qty{50}{\mA} over an ambient temperature range of \qtyrange[range-units = single, range-phrase={~to~}]{20}{30}{\celsius}.}
    \label{fig:dgDrive_tempco_50mA}
\end{figure}
\begin{figure}[hp]
    \centering
    \input{images/dgDrive_tempco_510mA.pgf}
    \caption{Output current drift of a \device{DgDrive-500-LN} running at \qty{510}{\mA} over an ambient temperature range of \qtyrange[range-units = single, range-phrase={~to~}]{20}{30}{\celsius}.}
    \label{fig:dgDrive_tempco_510mA}
\end{figure}
\clearpage

To conclude, the temperature coefficient of the {DgDrive-500-LN} was tested to be better than
\begin{equation}
    \qty{0.1}{\uA \per \K} + \qty{0.5}{\uA \per \A \per \K} \cdot I_{out}\,.
\end{equation}

This is well below the required target of \qty{<= 1}{\uA \per \A \per \K} set in table \ref{lst:dgDrive_specs_environment}. Since the tests typically take a week or more, only the most promising commercial drivers were tested. Unfortunately, no other driver was able to meet the target, although the Vescent \device{D2-105} came close with \qty{1.3}{\uA \per \A \per \K}. The SISYPH \device{SMC11} could not be tested because it was not stable enough to allow any distinction between a temporal drift and a temperature coefficient. This topic will be discussed in the next section.
\begin{center}
    \begin{deviceProperties}[label={lst:dgDrive_temperature_stability}]{DgDrive temperature stability}
    \begin{itemize}
        \item \device{DgDrive-500-LN}, \qty{50}{\mA}: $\qty{97}{\nA \per \K} \equiv \qty{0.19}{\uA \per \A \per \K}$
        \item \device{DgDrive-500-LN}, \qty{510}{\mA}: $\qty{348}{\nA \per \K} \equiv \qty{0.68}{\uA \per \A \per \K}$
        \item Combined temperature coefficient: $\qty{0.1}{\uA \per \K} + \qty{0.5}{\uA \per \A \per \K} \cdot I_{out}$
    \end{itemize}
    \end{deviceProperties}
\end{center}

\subsection{Test Results: Stability over Time}%
\label{sec:results_stability}
The stability measurements were conducted for \qty{24}{\hour} and the output current was recorded using a Keysight \device{34470A} DMM and a Vishay \device{VPR221Z} \qty{10}{\ohm} shunt resistor, which proved more stable than the internal shunt resistor of the \device{34470A}. The shunt voltage was recorded at the \qty{1}{\V} range with \qty{10}{\plc} and autozeroing enabled. Both the DMM and the laser driver were warmed up for \qty{8}{\hour} prior to the measurement. Ambient data of the lab, like temperature and humidity, was recorded using the LabKraken software (see section \ref{sec:res_labkraken} for details of the software). The devices themselves were not placed in a thermal chamber to reflect a typical use case. The lab temperature was kept within \qty{0.5}{\K} though. All measurements were done at \qty{50}{\mA} to align with the noise measurements. Do note, at such low currents the reference noise is strongly attenuated and therefore the burst noise of the commercial drivers can not be judged from those measurements. This issue with the \device{LM399} was only discovered later and retesting of the commercial drivers was no longer possible. The burst noise issue is discussed in more detail in section \ref{sec:zener_diode_selection}.

All devices but one showed no obvious issues regarding the short-term stability. For reasons of brevity these measurements are not shown in detail here. The only device found unsuitable for the use in high precision spectroscopy was the Sisyph \device{SMC11} as it exhibited large drifts, which were in part due to the trimmer resistor used to set the output current. This was already seen in section \ref{sec:results_current_noise} where it manifested itself as a large low frequency noise contribution. The effect in the time domain can be seen in figure \ref{fig:stability_smc11}, where the \device{SMC11} shows these severe short-term drift issues with a varying output current of up to \qty{1}{\uA} over the course of minutes. The drift after a setpoint change is not shown because the driver was warmed at the operating current before the measurement as mentioned above, but drifts of up to \qty{10}{\uA} were observed. This makes adjusting the driver difficult, especially if a lock to an atomic reference or a high finesse resonator is desired. Regarding the blue spectroscopy laser system for the ARTEMIS experiment with a stability margin of only few tens of \unit{\uA} as discussed in section \ref{sec:design_goal_environment}, this behaviour renders the driver incompatible with the ARTEMIS experiment. For comparison the output of the output of \device{DgDrive-500-LN} over the same time frame and transposed by \qty{-2}{\uA} is also shown in figure \ref{fig:stability_smc11}. This highlights the enormous low frequency noise component present in the Sisyph \device{SMC11}.
\begin{figure}[ht]
    \centering
    \input{images/stability_smc11.pgf}% data/plot_generic.py
    \caption{Output current stability of the \device{SMC11} at \qty{50}{\mA} over the course of \qty{24}{\hour}. For reference the output of the \device{DgDrive-500-LN} is also shown.}
    \label{fig:stability_smc11}
\end{figure}

The performance of the \device{DgDrive-500-LN} is again shown in figure \ref{fig:stability_dgDrive} in full. No discernible drift over the \qty{24}{\hour} period can made out from figure \ref{fig:stability_dgDrive} as the data is entirely obscured by the measurement uncertainty and noise of the \device{34470A}.
\begin{figure}[h!]
    \centering
    \input{images/stability_dgDrive.pgf}% data/plot_generic.py
    \caption{Output current stability of the \device{DgDrive-500-LN} at \qty{50}{\mA} over the course of \qty{24}{\hour}.}
    \label{fig:stability_dgDrive}
\end{figure}

The 2-$\sigma$ uncertainty of the DMM \cite{datasheet_keysight34470A} with these measurement settings is $\qty{10}{\uA \per \A} + \qty{0.4}{\uA} = \qty{0.9}{\uA}$, not including the shunt resistor, which renders a discussion about the apparent drift of \qty{30}{\nA} seen in figure \ref{fig:stability_dgDrive} questionable.

To get a more definitive answer on the actual drift, the measurement should be repeated with a lower noise and more stable multimeter like the \device{3458A} or alternatively a differential measurement between the shunt voltage and the Fluke \device{5440B} calibrator can be carried out. Nonetheless, an upper bound of less than \qty{50}{\nA \per \day} can be given. Regarding the long-term drift, the annual calibration of the laser drivers currently in use can be evaluated. The first batch of laser drivers, which has been in use for more than one year was measured against a freshly calibrated \device{3458A} and a drift of \qty{< 1 \pm 2}{\uA \per \A \per a} was found. This surpasses the requirements put up by the specification of \qty{240}{\uA \per \A \per 30 \day} given in table \ref{lst:dgDrive_specs_environment} on page \pageref{lst:dgDrive_specs_environment} by a far margin.
%To get an even better understanding of the long-term drift of the \device{DgDrive} more data needs to be collected on the drivers currently in use, but requires more calibration cycles and therefore time.
\begin{center}
    \begin{deviceProperties}[label={lst:dgDrive_temporal_stability}]{DgDrive stability over time}
    \begin{itemize}
        \item Short-term drift: \qty[per-mode = symbol]{<0.1 \pm 2}{\uA \per \A \per \day}
        \item Long-term drift: \qty[per-mode = symbol]{< 1 \pm 2}{\uA \per \A \per a}
    \end{itemize}
    \end{deviceProperties}
\end{center}

\subsection{Zener Diode Selection}%
\label{sec:zener_diode_selection}
As hinted in section \ref{sec:results_temperature_stability}, early temperature stability tests of the laser driver with an ADI \device{LM399} Zener diode as a voltage reference confirmed what the data sheet of the Zener diode \cite{datasheet_LM399} already suggest in the \textit{Low Frequency Noise Voltage} plot. There are random bi-stable voltage step changes. This phenomenon is called burst noise or popcorn noise. The theoretical model to describe it is discussed in more detail in section \ref{sec:theory_burst_noise} on page \pageref{sec:theory_burst_noise}.
\begin{figure}[ht]
    \centering
    \input{images/lm399_popcorn_noise.pgf}% data/plot_popcorn_noise.py
    \caption{Popcorn noise in different samples of the \device{LM399} over a \qty{24}{\hour} period as recorded by the scanner system using a Keithley \device{Model 2002} as discussed in this section.}
    \label{fig:popcorn_noise_lm399}
\end{figure}

Figure \ref{fig:popcorn_noise_lm399} shows two samples of the \device{LM399} that exhibit popcorn noise, while the last one does not.

The sources of popcorn noise in semiconductor devices are not yet fully understood, but some sources have been identified. Defects in the semiconductor crystal lattice and contamination of the semiconductor material have been linked to popcorn noise \cite{technote_ti_popcorn_noise}. This problem has improved over the years as manufacturing processes and wafer quality has evolved. Unfortunately the \device{LM399} is built around a process from 1991, as can be seen etched into the silicon die \cite{lm399_richi}.

The popcorn noise caused by defects and contamination can be reduced by lowering the strain on the lattice and removing surface contaminants on the die. This can be achieved using a high-temperature burn-in process. Manufacturers like Fluke and Keysight use similar techniques in their products. Fluke, for example, uses a period of \qty{60}{\day} burn-in for their references \cite{zener_popcorn_noise}.

Fortunately, the \device{LM399} is a heated reference, which heats itself to \qty{90}{\celsius} when turned on, so it is only required put the Zener diodes in a simple test circuit to apply a burn-in procedure. The use of a separate test setup instead of the final circuit has both advantages and disadvantages. The disadvantage is that the Zener diode will subjected to mechanical stress after burn-in when soldered in the final PCB. This stress will, of course, not be removed by the burn-in process as, but this mainly affects the voltage drift properties of the Zener diode and not the popcorn noise. The drift of the diode is only of secondary concern for the laser current driver as the output drift is mainly caused by the drift of the reference resistors, which is typically at least an order of magnitude worse than the drift of the Zener diode judging by the data sheet \cite{datasheet_LM399,datasheet_VPR}.

The advantage of testing the Zener diodes separately, on the other hand, is that more diodes can be tested at the same time using a compact test fixture. It is also simpler to remove unsuitable diodes from such a test fixture, because sockets instead of solder joints can be used. Building such a test setup is detailed in the next sections.

\subsection{Building a Test Setup for Zener Diodes}
There are several ways to measure the popcorn noise of semiconductor devices. The most trivial one is to directly monitor the device in the time-domain. In this case, the Zener voltage can be measured with a long-scale multimeter. This requires a low noise DMM that can reliably distinguish between both voltage levels, which are about \qty{4}{\micro \volt} apart.

A related option is to use a second reference, whose voltage is close in value to the device under test (DUT). Measuring only the voltage difference between the two references, a lower resolution is required. Comparing the difference of two references using a millivolt meter is, for example, commonly applied for intercomparing primary voltage references. This method, however, increases the measurement noise by a factor of $\sqrt{2}$ assuming both references produce the same amount of uncorrelated noise. The noise of the \device{LM399} measured with a \qty{100}{\plc} integration time (\qty{2}{\second}) is about \qty{1.5}{\micro \volt_{pp}} as can be determined from the data in figure \ref{fig:popcorn_noise_lm399}. Measuring the voltage difference between two references would then result in around \qty{2.1}{\micro \volt} of noise. This makes distinguishing the two voltage levels possible, but challenging.

%TODO: Measure reference noise with the SR560 and compare a diode with
A third option is to use a high-pass filter and an amplifier. Additionally, the signal can be low-pass filtered to remove any excess high frequency noise. This approach also requires a lower resolution than directly measuring the Zener voltage because the signal-to-noise-ratio is improved due to the amplifier. It is therefore possible to use an off-the-shelf analog-to-digital converter (ADC). One such circuit, along with some examples, is demonstrated in \cite{technote_ti_popcorn_noise,kay2012operational}. It must be noted, that due to the high-pass filtering, it not possible to evaluate voltage drifts of the Zener diode using this method.

The fourth and final option discussed here, is to approach the problem in the frequency domain and requires a low-noise amplifier with a low frequency cutoff. As discussed in section \ref{sec:theory_burst_noise}, popcorn noise is found to have a frequency dependence of $1/f^2$. This property can be used to distinguish it from other random noise processes that show a frequency dependence of $1/f$. A good example of an op-amp that has excessive burst noise in comparison to a good sample is given in \textit{The Art of Electronics} \citep[p. 478]{horowitz1989}. Evaluating the frequency spectrum below \qty{10}{\Hz} allows to sort the references by their noise spectrum.

Considering these four options, one can see that going from the first to the last option, the test setup becomes simpler and the requirements for the data acquisition front end are more relaxed because either the common mode voltage is reduced or more filtering is applied. On the other hand, the interpretation of the measurement results becomes more challenging and requires more a priori knowledge. For example, comparing the voltage difference between two references, a known good sample is required to reliably determine the presence of burst noise in the DUT. The other two options also require a baseline to compare samples to. At the start of the evaluation, most of the data available about the \device{LM399} came from the data sheet. Compiling a reference dataset with the performance of dozens of \device{LM399} was considered too expensive and time consuming. The only measurement schemes explored further are therefore the first two options. The focus of the next sections lies on the selection of a scanner system and a digital long-scale multimeter to satisfy the requirements for testing multiple \device{LM399} Zener diodes at once.

\subsection{Choosing a Multimeter for Testing Zener Diodes}
The DMM used plays an important role for the test setup as it mostly defines the signal to noise ratio and the measurement speed. In this section, some of the challenges that can be encountered when selecting a multimeter will be discussed. The expected amplitude of the popcorn noise produced by the \device{LM399} Zener diode is around \qty[per-mode=symbol]{0.5}{\micro\volt \per \volt} or \qty{3.5}{\micro\volt} of the output voltage when considering the \qty{7}{\volt} Zener voltage of the \device{LM399}. Those \qty{7}{\volt} will typically be measured on the \qty{10}{\volt} range of a DMM, which is not a trivial task, because a signal-to-noise-ratio of \qty[per-mode=symbol]{0.35}{\micro\volt \per \volt} or more than \qty{130}{\decibel} is required. This calls for an instrument, that not only has the required resolution, but also the stability over time and temperature to ensure the measurement will not be distorted by the DMM. A voltmeter with lower noise and a more stable reference than the DUT is therefore mandatory. This only leaves the class of very low noise \num{7.5} or \num{8.5} digit multimeters. These multimeters come with a different type of voltage reference, because the \device{LM399} is not suitable for such instruments due to its noise. The only Zener diodes that meet those requirements are the ADI \device{LTZ1000} \cite{datasheet_LTZ1000}, the Motorola \device{SZA263} (out of production) and the Linear Technology (LT) \device{LTFLU-1}, a proprietary design by Fluke and LT. The \device{LTZ1000}, for example, is specified for a typical noise of \qty{1.2}{\micro\volt_{pp}} in a frequency range of \qtyrange{0.1}{10}{\Hz} \cite{datasheet_LTZ1000} as opposed to \qty{4}{\uV_{pp}} of the \device{LM399}. Additionally, in comparison to the \device{LM399} those high performance Zener diodes do not suffer from popcorn noise issues to this extend.

Comparing only \num{7.5} and \num{8.5} digit voltmeters narrows down the choice of multimeters considerably. The market for high-end \num{8.5} digit DMMs is limited and every device on the market caters for a certain niche. It is therefore prudent to look at the individual specifications to choose the correct instrument for this purpose. Table \ref{tab:list_of_dmms} contains a list of popular \num{8.5} DMMs that were considered for this application. Several models included in the table are already discontinued but these DMMs can still be acquired on the second-hand market. While the author has not tested every multimeter in table \ref{tab:list_of_dmms}, it is possible to judge most of them a priori by their specifications. A quick overview will be given next to limit the options presented in table \ref{tab:list_of_dmms} to the most promising devices. In order to reach a high throughput of tested \device{LM399} the DMM must deliver fast reading speeds, ideally multiple samples per second including autozeroing, combined with a low input noise to distinguish the burst noise voltage levels. This already rules out many DMMs in table \ref{tab:list_of_dmms}.
\begin{table}[ht]
    \centering
    \begin{tabular}{lll}
        \toprule
        Manufacturer& Model& Remarks\\
        \midrule
        Advantest& \device{R6581}& Discontinued. Scanner cards available.\\
        ADCMT& \device{7481}& In production.\\
        Datron/Wavetek& \device{1812}& Discontinued. Wavetek was bought by Fluke.\\
        Fluke& \device{8508A}& Discontinued. \qty{20}{\volt} range. Slow\\
        Fluke& \device{8588A}& In production. \\
        Keithley/Tektronix& \device{2002} &In production. Scanner card available. \qty{20}{\volt} range.\\
        Keysight& \device{3458A}& In Production.\\
        Solartron& \device{7081}& Discontinued. Slow.\\
        Transmille& \device{8104}& In Production. External scanner available. Slow.\\
        \bottomrule
    \end{tabular}
    \caption{Overview of \num{8.5} digit multimeters. The discontinued models listed were still available on the secondhand market at the time of writing.}
    \label{tab:list_of_dmms}
\end{table}

The instruments considered unsuitable due to their conversion speed are the Solartron \device{7081} (also sold as a Guildline \device{9578}), the Fluke \device{8508A}, the Wavetek \device{1812} and the Transmille \device{8104}. The Solartron \device{7081} takes \qty{52}{\s} for a measurement with \num{8.5} digits of resolution. Both the Fluke \device{8508A} and the Wavetek \device{1812}, which are very similar devices because Fluke bought Wavetek in 2000, are fairly slow, taking \qty{25}{\second} for a conversion at \num{8.5} digits. The \device{8104} takes \qty{4}{\s} for each conversion using its fastest setting \cite{datasheet_transmille8104}, not including autozeroing. The ADCMT \device{7481} is made by the Japanese company ADC Corporation, which split off from Advantest in 2003. Both the Advantest \device{R6581} and ADCMT \device{7481} are hard to come by in Europe as there are no official distributors available. These instruments were therefore not considered for this setup.

Having removed slow and unavailable instruments from the list, this leaves only a few devices for the test setup. The Fluke \device{8588A}, the Keysight \device{3458A}, and the Keithley \device{Model 2002}. The Fluke \device{8588A} excels at stability and features a modern user interface whereas the Keysight \device{3458A} is unbeaten in linearity and noise. A detailed comparison of those two meters can be found in the work of \citeauthor{article_fluke_8588A_noise} \cite{article_fluke_8588A_noise}. The Keithley \device{Model 2002} focuses on its scanning capability. To narrow it down even further, several \num{7.5} and \num{8.5} digit multimeters were tested. The results of those tests will be discussed here to give an impression of the performance of these devices. The tested multimeters are the Keysight \device{3458A}, the Keithley \device{Model 2002}, a Keysight \device{34470A} and a Keithley \device{DMM6500}. The \device{3458A} was selected because of its low noise and the \device{Model 2002} was chosen for its internal scanning unit. The \device{34470A} was picked as a lower-end and cheaper alternative to see if such an instrument could be used as well. Finally the \device{DMM6500} is on the list to give an impression of an instrument that uses an \device{LM399} voltage reference instead of the superior \device{LTZ1000} used in the other multimeters.

Two tests were carried out to asses both the ADC noise and the stability of the DMM. The noise is mostly determined by the front end amplifier and the ADC including the autozeroing algorithm as discussed in section \ref{sec:autozero}. The stability is determined by the reference voltage and the stability front end amplifier gain. The first test is implemented by taking measurements with a shorted input. The stability of the DMM can only be evaluated with a known stable test signal. The second test was therefore run against a Fluke \device{5440B} calibrator that supplied \qty{10}{\volt} to all multimeters and readings were taken over the course of a week. This data was used to estimate the stability of the multimeters and also reveals any burst noise coming from the multimeter reference. The noise of a DMM at \qty{10}{\volt} is typically not found in the datasheet because the performance is usually quoted for shorted inputs, which does not include the internal reference noise, in order to benchmark the ADC. The test was done at \qty{10}{\V} instead of the expected \qty{7}{\V} of the \device{LM399}, because \qty{10}{\V} is a more common value for such tests as primary voltage references use this value. Using this voltage allows better intercomparison and promotes a broader application of the results. The calibrator has a specified output noise of \qty{< 1.5}{\micro \volt} within a bandwidth of \qtyrange{0.1}{10}{\Hz} at \qty{1}{\volt} and is stable to within \qty{5}{\micro \volt_{rms}} over \qty{30}{\day}, a specification far superior to the \device{LM399}.

The test was conducted in a stable and monitored lab environment, with a temperature deviation of at most $\Delta T = \qty{\pm 0.5}{\kelvin}$. All multimeters were connected to same calibrator output. Although this might potentially cause interference between the multimeters due to the pump out current spikes caused by the switching intervals, no ill effects, like voltage offsets or increased noise, were observed during the tests. A more detailed discussion of the pump out current with a focus on the \device{3458A} can be found in \cite{article_3458A_input_impedance}. All instruments under test were connected using shielded cables, either Pomona \device{1167-60} or self-made cables with gold-plated copper spades crimped to twisted and shielded \device{M27500A 18WJ4T24} PTFE insulated cables. The GUARD terminal of the calibrator was connected to chassis GROUND at the calibrator and then connected to the cable shields. On the \device{3458A}, the shield was connected to the GUARD terminal and the GUARD switch was set to open according to the manual \cite{manual_keysight3458a}. For the other multimeters that do not have a GUARD terminal, the shield was left floating at the DMM side. Finally, the autocalibration routine of the Fluke \device{5440B} calibrator, the \device{3458A} and the \device{34470A} was run prior to the measurement. The detailed settings used for the DMMs can be found in the appendix \ref{appendix:dmm_test} on page \pageref{appendix:dmm_test}, a summary is given in table \ref{tab:dmm_settings_concise} to show the important differences.
\begin{table}[ht]
    \centering
    \begin{tabular}{lc}
        \toprule
        DMM& Integration time in \unit{\plc}\\
        \midrule
        \device{HP 3458A}& 100\\
        \device{Keithley Model 2002} & 40\\
        \device{Keysight 34470A}& 100\\
        \device{Keithley DMM6500}& 90\\
        \bottomrule
    \end{tabular}
    \caption{ADC conversion speeds of the tested DMMs configured to give a total measurement time of \qty{2}{\s}. More details on the configuration can be found in appendix \ref{appendix:dmm_test} on page \pageref{appendix:dmm_test}.}
    \label{tab:dmm_settings_concise}
\end{table}

All DMMs were configured for the same total measurement time of \qty{2}{\s}. Depending on the ADC conversion speed, this leads to different integration times that are given in power line cycles (PLC) at \qty{50}{\Hz}. The \device{Model 2002} takes considerable longer for a measurement than the Keysight multimeters. The reason is the auto-zero function, which is shown in figure \ref{fig:dmm_autozero_comparison} on page \pageref{fig:dmm_autozero_comparison} . Recounting section \ref{sec:autozero}, the \device{Model 2002} does three steps when doing auto-zeroing. It measures the signal, the zero point for an offset compensation and also the reference voltage for a gain correction. In comparison, the \device{3458A} only corrects for the offset drift. The gain correction is only applied once by using the autocalibration routine as was done at the start of the test. The auto-zero routine of the \device{Model 2002} therefore takes longer but proves more stable for long-term measurements.

A short \qty{28}{\hour} excerpt of the measurement is shown in figure \ref{fig:dmm_comparison_fluke5440B} because it captures the distinct properties of each multimeter very well and be used for a qualitative discussion. A more precise conclusion can only be drawn from the Allan deviation introduced in section \ref{sec:allan_deviation}.
\begin{figure}[ht]
    \centering
    \input{images/dmm_comparison_fluke5440B.pgf}% data/plot_generic.py
    \caption{Comparison of several DMMs measuring the \qty{10}{\V} output of a Fluke \device{5400B} for \qty{28}{\hour}. The traces are spaced \qty{10}{\uV} apart.}
    \label{fig:dmm_comparison_fluke5440B}
\end{figure}

From the data shown in figure \ref{fig:dmm_comparison_fluke5440B} several conclusion can already be drawn. Looking at the \device{DMM6500}, the \num{6.5} digit multimeter, two things that are immediately apparent are the limited resolution and towards the end of the measurement series there is an indisputable burst noise event. The latter aspect alone disqualifies the instrument for this task but nicely demonstrates the intricate matter of selecting the correct multimeter for the task. The magnitude of the burst noise event depends on the internal scaling of the reference voltage and in this case is very pronounced in comparison to the samples shown in figure \ref{fig:popcorn_noise_lm399} on page \pageref{fig:popcorn_noise_lm399}. The \device{34470A} fared better in terms of resolution but there is either a temperature coefficient or drift visible. Its short-term noise is slightly lower than the noise seen from the \device{Model 2002}. The Keithley \device{Model 2002} demonstrates the most stable behaviour of all DMMs tested due to the more robust auto-zeroing. These first impressions can be quantified in numbers using the Allan deviation. The Allan deviation of the measurement series was calculated using the \textit{AllanTools} Python library \cite{allantools}. The algorithm chosen to estimate the Allan deviation was the Total deviation. This is a modified version of the Allan deviation estimator and extends the idea by appending the same dataset to the original record and thereby extracting more useful information from otherwise unused samples \cite{totdev,totdev_2}. This better suppresses end-of-data errors which are discussed in section \ref{sec:allan_deviation}. The \qty{10}{\V} dataset of the measurement against the calibrator is discussed first and shown in figure \ref{fig:dmm_comparison_fluke5440B_adev}. This test can be used to estimate the long-term stability of the DMM, mostly affected by the ADC gain and the internal reference. The former is greatly affected by ambient temperature changes. Do note, that the measurement at \qty{10}{\V} instead of \qty{7}{V}, which is the actual Zener voltage of the \device{LM399} to be measured by the scanner system, overestimates the noise figure of the \device{Model 2002} due to the gain correction part of the auto-zero algorithm. The gain correction adds an additional scaled part of the ADC noise to the measurement as shown in section \ref{sec:autozero_gain} on page \pageref{sec:autozero_gain}. This noise contribution is only relevant at small values of $\tau$, because the ADC noise contribution, which is mostly white after applying the auto-zeroing, quickly drops due to the averaging at longer ADC integration times as demonstrated in section \ref{sec:autozero_offset_nulling}.
\begin{figure}[ht]
    \centering
    \input{images/dmm_comparison_fluke5440B_adev.pgf}% data/allan_variance.py
    \caption{Allan deviation of several DMMs measuring the \qty{10}{\V} output of a Fluke \device{5440B} calibrator. The Allan deviation was estimated using the Total deviation.}
    \label{fig:dmm_comparison_fluke5440B_adev}
\end{figure}

The Allan deviation shown in figure \ref{fig:dmm_comparison_fluke5440B_adev} confirms what has already been found from figure \ref{fig:dmm_comparison_fluke5440B}. To put the numbers of figure \ref{fig:dmm_comparison_fluke5440B_adev} into perspective, the burst noise of the \device{LM399} to be measured is expected to be around \qty{3.5}{\uV}. The uncertainty of the measurement should be at least one order of magnitude lower to guarantee a good signal to noise ratio. Both the Keysight \device{34470A} and the \device{3458A} can deliver this performance at short integration times $\tau$. The Allan deviation of all DMMs but the \device{Model 2002} is similar in shape. Comparing with table \ref{tab:adev_alpha} on page \pageref{tab:adev_alpha}, the flat $\tau^0$ part of the Allan deviation can be attributed to the flicker noise content caused by the DMM reference circuit and the front end gain as the offset drift is removed by the auto-zeroing. The \device{Model 2002} starts at a higher noise floor with an Allan deviation of \qty{5.5}{\uV} and needs an integration time of \qty{200}{\second} to reach the desired \qty{3.5}{\uV} uncertainty. At longer integration times the superior stability of the \device{Model 2002}, due to the automatic gain correction, shows. At \qty{2000}{\s} (\qty{0.5}{\hour}) the noise performance is on par with the \device{3458A}, which is renowned for its low noise ADC. At this time scale temperature effects play a dominant role which can be seen from the data of all other multimeters because the Allan deviation starts increasing at around $\tau = \qty{2000}{\second}$. Above \qty{e5}{\second} (\qty{24}{\hour}) the plot shows the typical oscillations from the end-of-data errors as explained in section \ref{sec:allan_deviation}. The decreasing Allan deviation observed for some multimeters is a clear indicator.

Overall, the measurement shows that all DMMs but the \num{6.5} digit multimeter can be used for the scanner system although the higher noise of the \device{Model 2002} makes detecting the burst noise more difficult on short time scales. Going to longer time scales the superior stability of the \device{Model 2002} allows to clearly observe the initial drift of the Zener diodes with happens on timescales of a few days. The Allan deviation of the DMMs with shorted input reveals the performance of the ADC without the internal reference gives even more insight into the instruments. This is shown in figure \ref{fig:dmm_comparison_shorted_adev}.
\begin{figure}[ht]
    \centering
    \input{images/dmm_comparison_shorted_adev.pgf}% data/allan_variance.py
    \caption{Allan deviation of several DMMs with shorted inputs. The Allan deviation was estimated using the Total deviation.}
    \label{fig:dmm_comparison_shorted_adev}
\end{figure}

Without the internal reference and the ADC front end drift the performance of the ADC can be evaluated and different noise types according to table \ref{tab:adev_alpha} on page \pageref{tab:adev_alpha} can be identified. The Allan deviation of the Keysight \device{3458A} is in good agreement with the simulated Allan deviation shown in figure \ref{fig:autozero_raw_psd} on page \pageref{fig:autozero_raw_psd}. Up to $\tau = \qty{e4}{\second}$ a $\tau^{-\frac{1}{2}}$ dependence can be seen, indicating only white noise. The noise is around \qty{2}{\nV_{rms}} or \qty{0.2}{\nV_{rms} \per \V} which is the resolution limit of the ADC. The  curve progression matches the theoretical limit and represents the high performance of the ADC implemented in the \device{3458A}.

The behaviour of the \device{Model 2002} is similar although there a notable plateau between $\tau = \qty{e3}{\second}$ and $\tau = \qty{e4}{\second}$. This can be seen with all Keithley multimeters and is also present in the noise of the \device{DMM6500} albeit at a different integration time. The cause of this is likely to be found in the software of the multimeter. Keithley is using more parameters than just the offset voltage for the auto-zeroing algorithm. Due to the proprietary nature of the firmware an exact cause for the issue cannot be given. At longer intervals the curve seems to keep following a $\tau^{-\frac{1}{2}}$ dependency but due to end-of-data error this cannot be configure good uncertainty. A longer measurement would be required.

For the \device{34470A}, Keysight seems to also deviate from the classic auto-zeroing procedure. Although the ADC delivers very good noise performance at high frequencies and low $\tau$. Going to higher $\tau$, the instrument seem to follow a $\tau^{-\frac{1}{2}}$ dependency indicating some correlation between the samples, which should not be present after auto-zeroing. The nature of this effect is again hidden in the proprietary firmware. At long intervals this behaviour becomes a serious problem and therefore limits the use of the instrument to monitor long-term drifts over days like the initial drift of the \device{LM399} Zener diodes.

The Allan deviation shows that for a Zener diode test setup an \num{8.5} digit multimeter is recommended, yet a low noise DMM like the \device{34470A} can be used, but only limited statements about the stability of the Zener diode can be made in this case due to the increased drift of the observed. If cost is the driving factor of the setup such a multimeter can be considered, but an \num{8.5} digit instrument is recommended. A \num{6.5} digit multimeter was shown to be inadequate both from the perspective of the ADC performance and the burst noise of the internal voltage reference. The next section discusses the second part of the scanner system, namely the multiplexer used to test several Zener diodes at once to increase the throughput of the DMM.
%
%These measurements were done by measuring the output voltage of a pre-production version of the reference PCB for the digital current driver. The reference board was kept at \qty{23}{\celsius} in a custom thermal chamber. The chamber is detailed in section \ref{}. Additionally, a \qty{500}{\g}  bag of Bentonite desiccant was added to keep the references at a low humidity of around \qty{20}{\percent} relative humidity. The reference board inserted into a motherboard holding up to 4 reference modules. The motherboard, also called LM399 breakout board, provides the voltage regulators and the operational amplifier for the kelvin sensed pins of the reference. The multimeter was directly connected to the reference via a DB9 connector, without an other components in between the reference and the DMM like buffers, multiplexers or filters. The DMM itself was exposed to the ambient temperature of the lab. The setup is shown in figure \ref{fig:lm399_vs_34470a_setup}.

%\begin{figure}[ht]
%    \centering
%    \resizebox {0.8\textwidth} {!} {
%        \import{figures/}{34470A_vs_LM399.tex}
%    } % resizebox
%    \caption{Measurement setup for tesing an LM399 reference board with the \device{Keysight 34470A}}
%    \label{fig:lm399_vs_34470a_setup}
%\end{figure}

%The reference boards amplify the Zener voltage to \qty{10}{\volt}, which improves the signal to noise ratio, because it makes use of the full DMM range. The \qty{10}{\volt} range is typically the lowest (relative) noise and lowest drift range those multimeter because no internal preamplifiers of attenuators are required. It is important to keep the temperature drift of the DMM low or at least predictable, because the device is exposed to the ambient laboratory and not in a temperature controlled environment like the references.

%\newpage
%The reference is a negative \qty{10}{\volt} reference that uses a self-biasing technique to derive its \qty{1}{\mA} Zener current from its own \qty{-10}{\volt} output. The details of this circuit are discussed in section \ref{sec:voltage_reference}.

% \begin{figure}[h]
%     \centering
%     \scalebox{0.7}{%
%         \import{figures/}{lm399_reference_circuit.tex}
%     } % scalebox
%     \caption{Self-biased LM399 negative voltage reference.}
%     \label{fig:lm399_negative_10V}
% \end{figure}

%With the amplified output the expected burst noise step size of about \qty[per-mode=symbol]{0.5}{\micro\volt \per \volt}, becomes \qty{5}{\micro\volt}. The resolution of the \qty{10}{\volt} range of the \device{34470A} is \qty{100}{\nano \volt}, but the measurement is not limited by quantization. See section \ref{} of this work for a detailed characterisation.

%\begin{figure}[ht]
%    \centering
%    \input{images/LM399_vs_34470A.pgf}
%    \caption{Voltage deviation from the mean voltage of an LM399 negative \qty{-10}{\volt} reference measured with a Keysight 34470A at \qty{100}{\plc}.}
%    \label{fig:lm399_vs_34470a}
%\end{figure}

%Figure \ref{fig:lm399_vs_34470a} shows an example of such measurement. This measurement highlights one the problems encountered during those measurements. From this measurement it is unclear whether the features seen in the graph are only a result of ambient temperature changes due to the cycling of the air conditioning or popcorn noise on top of that. These results hightlight the fact, that sub-\unit{ppm} measurements not only requires high-end gear, but also a very stable environment. From the data it follows, that the temperature coefficient of the DMM in linear approximation is:
%\begin{equation}
%    \alpha_\device{34470A} \approx \frac{\qty{6.08}{\micro\volt}-(-\qty{9.30}{\micro\volt})}{(\qty{21.85}{\celsius}-\qty{19.96}{\celsius})\qty{10}{\volt}} = \qty[per-mode=symbol]{0.86}{\micro\volt \per \volt \per \kelvin}
%\end{equation}

%While the temperature coeeficient is vastly better than the specified \qty[per-mode=symbol]{2}{\micro\volt \per \volt \per \kelvin} \cite{datasheet_keysight34470A}, it is not low enough for this type of measurement. The multimeter must therefore be kept in a temperature controlled environment. This issue was resolved by replacing the stock air conditioning controller with a custom PID controller as discussed in section \ref{}. Lastly, the noise floor of the measurement is \qty{1.5}{\micro\volt_{rms}}, resulting in an estimated signal-to-noise ratio (SNR) of about \qty{10}{\decibel}, which is suffient to detect the popcorn noise.

%While the temperature issue was being worked on, testing of the Zener diodes continued. To work around the temperature drift of the DMM, the amplification of the reference voltage was increased to \qty{15}{\volt}, the same voltage required by the digital current driver, and a differential measurement was realized. This measurement was done against a primary \qty{15}{\volt} reference board. To ensure, that any popcorn noise found originates only in the DUT and not the primary reference used, several reference boards where tested against a \device{Fluke 5440B}. The \device{5440B} does not exhibit popcorn noise as it uses a different voltage reference ic, namely two Motorola SZA263 in series \cite{service_manual_fluke_5440b}. Finally, a board that did not show popcorn noise in a period of three days was selected. The serial number of this primary or golden reference is \textit{\#1}.

%Using this differential technique, the results greatly improved
%

\subsection{A Scanner System for Testing Zener Diodes}%
\label{sec:diode_scanner_system}
In order to test large amounts of Zener diodes, and considering the duration of the burn-in process, which can take anything between \qtyrange{100}{1000}{\hour}, it is necessary to have an automated setup that can observe multiple Zener diodes at once. A minimum of at least 10 diodes should be tested at the same time. Such a setup consists of a digital multimeter as discussed in the last section, a scanner and test board that holds the Zener diodes and provides the necessary infrastructure for the diodes. Several commercial scanner options currently available were considered for this project and are shown in table \ref{tab:list_of_daqs}.
\begin{table}[h]
    \centering
    \small
    \begin{tabular}{llllllll}
        \toprule
        \multirow{2}{*}{} & \multicolumn{2}{l}{Keysight} & \multicolumn{3}{l}{Keithley} & Fluke & Rigol \\
        \cmidrule{2-8}
        & DAQ973A & 34980A & DAQ6510 & 2750 & 3706 & 2680 & M300 \\
        \midrule
        DMM & \num{6.5} & \num{6.5} & \num{6.5} & \num{6.5} & \num{7.5} & \qty{18}{\bit} & \num{6.5} \\
        \midrule
        Channels & 3x20 & 8x40 & 2x10 & 5x20 & 6x60 & 6x20 & 5x32 \\
        \midrule
        Solid-state & \textcolor{green!60!black}{\checkmark} & \textcolor{green!60!black}{\checkmark} & \textcolor{green!60!black}{\checkmark} & \textcolor{green!60!black}{\checkmark} & \textcolor{green!60!black}{\checkmark} & \textcolor{red!80!black}{\ding{55}} & \textcolor{red!80!black}{\ding{55}} \\
        \midrule
        Voltage & \qty{120}{\volt} & \qty{80}{\volt} & \qty{60}{\volt} & \qty{60}{\volt} & \qty{200}{\volt} & \qty{75}{\volt} & \qty{300}{\volt} \\
        \midrule
        Scanner card & DAQM900A & 34925A & 7710 & 7710 & 3724 & 2680A-PAI & MC3132 \\
        \midrule
        USB & \textcolor{green!60!black}{\checkmark} & \textcolor{green!60!black}{\checkmark} & \textcolor{green!60!black}{\checkmark} & \textcolor{red!80!black}{\ding{55}} & \textcolor{green!60!black}{\checkmark} & \textcolor{red!80!black}{\ding{55}} & \textcolor{green!60!black}{\checkmark} \\
        \midrule
        Ethernet & \textcolor{green!60!black}{\checkmark} & \textcolor{green!60!black}{\checkmark} & \textcolor{green!60!black}{\checkmark} & \textcolor{red!80!black}{\ding{55}} & \textcolor{green!60!black}{\checkmark} & \textcolor{green!60!black}{\checkmark} & \textcolor{green!60!black}{\checkmark} \\
        \midrule
        GPIB & \textcolor{green!60!black}{\checkmark} & \textcolor{green!60!black}{\checkmark} & \textcolor{green!60!black}{\checkmark} & \textcolor{green!60!black}{\checkmark} & \textcolor{green!60!black}{\checkmark} & \textcolor{red!80!black}{\ding{55}} & \textcolor{green!60!black}{\checkmark} \\
        \bottomrule
    \end{tabular}
    \caption{Overview of scanner mainframes commercially available in \num{2023}. Features like integrated DMMs, the number of channels, the maximum voltage, solid-state relays and connectivity options are shown.}
    \label{tab:list_of_daqs}
\end{table}

A recent trend to more compact devices has led major manufacturers to include multimeters in the scanner mainframe creating so called data acquisition units. Legacy devices, that only have switching capabilities are no longer available. For example Keithley replaced the small desktop switch mainframe \device{Model 7001} with the \device{DAQ6510} and Keysight is offering the \device{DAQ973A}, a scanning \num{6.5} digit DMM that accepts extension cards. Unfortunately, for this project, as discussed above, an integrated \num{6.5} digit multimeter does not add any value.

The scanner card used to multiplex the DMM does have to meet several specifications. The most important aspects are the number of channels and the lifetime of the relays. Other factors, such as channel to channel isolation, the contact potential, resistance and maximum voltage are not the limiting factors for this setup, because the voltage is low, there is no ac component involved and the the typical input impedance of high-end multimeters is far more than \qty{100}{\giga\ohm} \cite{datasheet_fluke8588A,article_3458A_input_impedance_2,datasheet_keithley2002,article_3458A_input_impedance}. The lifetime of the scanner card can be greatly increased by using solid-state relays instead of mechanical relays. The number of actuations required for testing the expected \num{100} Zener diodes will be discussed in more detail below using a commercial scanner card as an example.

Given the prospect that all scanner mainframes contain currently on the market include a multimeter that is not going to be used, but has to be paid for nonetheless, additional options were explored. The simplest solution found was to go with an \num{8.5} digit multimeter that already includes a scanner option like the Keithley \device{Model 20020} or buy a used \device{Keithley 7001} from a second-hand dealer to use with the \device{3458A}. The author tested both options and the simplicity and space saving of only having a single device to connect and program makes the integrated scanner card of the \device{Model 2002} very attractive.

For this work the Keithley (now Tektronix) \device{Model 2002} was chosen for three reasons. It is a very compact system requiring only a half-sized 2U rack in comparison to other \num{8.5} digit DMMs that are typically full-sized 2U rack devices. The other two advantages are the integrated scanner card slot that allows to fit a 10 channel scanner card and finally the \qty{20}{\volt} measurement range. The latter is interesting for testing the final voltage reference boards, as these have a \qty{15}{\volt} output.

\begin{figure}[ht]
    \centering
    %\scalebox{0.7}{%
        \import{figures/}{simplified_scanner.tex}
    %} % scalebox
    \caption{Simplified schematic of the scanner front-end with parasitic elements.}
    \label{fig:simplified_scanner}
\end{figure}

The standard scanner card that comes with the \device{Model 2002} is the \device{Model 2000-SCAN} card. These cards have a number of 2-pole relays mounted to them as shown in figure \ref{fig:simplified_scanner} which have an expected lifetime of \numrange[range-phrase={~to~}]{e5}{e8} actuations. Considering \num{3} actuations per minute and a measurement interval \qty{1000}{\hour} per batch and \num{10} batches for a total of \num{100} Zener diodes, results in \num{e6} actuations. This could lead to premature failure of the test setup and unfortunately, there is no alternative scanner card available that has solid-state relays. To solve this issue, a solid-state scanner card replacement was developed. This card fits into the standard slot and uses the same connector as the original card which shown in figure \ref{fig:connector_scan200}. It is recognized as a \device{Model 2000-SCAN} card and can be used as a direct replacement.
\begin{figure}[ht]
    \centering
    \import{figures/}{DIN_41612.tex}
    \caption{The DIN 41612 \num{32} pin extension connector used in several Keithley multimeters.}
    \label{fig:connector_scan200}
\end{figure}
\begin{table}[ht]
    \centering
    \begin{tabular}{llll}
        \toprule
        Pin& Function& Pin& Function\\
        \midrule
        a1, b1& GND& a9, b9& $\overline{\text{NRST}}$\\
        a2, b2& GND& a10, b10& GND\\
        a3, b3& GND& a11, b11& STROBE/LATCH\\
        a4    & GND& a12, b12& GND\\
        b4    & ID, connect to \qty{5}{\V} or DATA& a13, b13& CLOCK\\
        a5, b5& \qty{5}{\V} supply& a14, b14& GND\\
        a6, b6& \qty{5}{\V} supply& a15, b15& DATA\\
        a7, b7& \qty{5}{\V} supply& a16, b16& GND\\
        a8, b8& \qty{5}{\V} supply&&\\
        \bottomrule
    \end{tabular}
    \caption{Pin layout of the backplane connector used for scanner cards by the Keithley \device{Model 2002}.}
    \label{tab:connector_scan200}
\end{table}

The scanner card is based on an \device{ICE40HX1K} FPGA and its design files are available open-source at \cite{git_scan2000}. This scanner card can either be equipped with \num{10} channels or \num{20} channels. The \device{Model 2002} only supports \num{10} channels, while newer Tektronix multimeters like the \device{DMM6500} support up to \num{20} channels. The multimeter backplane connector is the same for both versions of the card, yet the communication protocol has changed. Both protocols were implemented on the FPGA and are selectable by the user via a solder bridge during assembly of the PCB, but this solder bridge can also be changed later to convert a \num{20} channel card into a \num{10} channel card if the need arises. This is one of the reasons for using an FPGA instead of the simpler shift registers used by the original \device{Model 2000-SCAN}. An attempt was also made using a microcontroller, but the legacy protocol used by the \device{Model 2002} does not work well with an \qty{8}{\bit} aligned microcontroller. There are other devices apart from the scanner controller talking on the bus as well and both controllers have different packet sizes (and clock rates). The scanner card expects a \qty{24}{\bit} command from the DMM clocked in via the CLOCK and DATA lines. Once the command is done, the STROBE pin is used to push the command to the relays via a shift register. The shift register makes sure that only the final \qty{24}{\bit} before the STROBE pin is triggered are registered as a command. Any data sent before those \qty{24}{\bit} gets dropped. As said above the other device on bus has a different, slower, clock rate and sometimes one or two \unit{\bit} are sent in between the \qty{24}{\bit} commands of the scanner card. This poses a problem for a typical microcontroller. Most microcontroller are byte aligned and any number of bits, that is not a multiple of \num{8}, which is sent before the \qty{24}{\bit} command breaks the alignment. In addition, the high data rate of the scanner controller clocking at \qty{2}{\MHz} made sampling the signal in software impossible. An FPGA can easily mimic the shift register and also decode the more modern protocol of the \device{DMM6500}. More details on both protocols can be found with the design files of the scanner card at \cite{git_scan2000}. A picture of the finished board is shown in figure \ref{fig:scan200_pcb}.
\begin{figure}[h]
    \centering
    \includegraphics[width=0.75\textwidth]{images/BM1A2145_SCAN2000_lowres.JPG}
    \caption{A \num{10} channel solid-state scanner module developed for the Keithley \device{Model 2002} including the connector for the reference PCB.}
    \label{fig:scan200_pcb}
\end{figure}

With a scanner and multimeter selected, the focus now lies on the test fixture for the Zener diode. This test setup consists of a mounting PCB, that holds up to 20 Zener diodes \cite{git_lm399_burnin_board}. It provides power regulation and a minimal circuit required to support each diode. This circuit is shown in figure \ref{fig:zener_burnin}.
\begin{figure}[ht]
    \centering
    %\scalebox{0.7}{%
        \import{figures/}{zener_burnin.tex}
    %} % scalebox
    \caption{Circuit used for the burn-in of \device{LM399} and \device{ADR1399} Zener diodes.}
    \label{fig:zener_burnin}
\end{figure}

The compensation network is required when using the \device{ADR1399}, because of its very low dynamic impedance as recommended in the data sheet \cite{datasheet_ADR1399}. It is not strictly required for the \device{LM399}, but fitted nonetheless, because there are no downsides to it. This makes the board compatible with both types of references. Each Zener diode output is protected using a buffer, which provides isolation and short circuit protection. Finally there is a common mode filter at the output to suppress high frequency noise via ground loops.

Using this test setup, \num{102} \device{LM399} Zener diodes were tested up to this date (2023-04). Of those \num{39} were found suitable for the \device{DgDrive}. This low yield of only \qty{40}{\percent} is a matter of concern and has significantly delayed the development and production of the drivers. Using the automated test setup, the latter issue is manageable, but still slows down the production. Tests are currently conducted to replace the \device{LM399} with the newer \device{ADR1399} Zener diode, but unfortunately, it is still not available in quantities surpassing individual samples. Two of those samples were thoroughly tested and showed significantly better performance in terms of both lower white noise and reduced burst noise. Although these results are promising, more samples need to be tested to give a final verdict. Using the screened Zener diodes a first batch of \num{15} laser drivers was built.

\subsection{Summary}%
\label{sec_dgDrive_summary}
\begin{figure}[h]
    \centering
    \includegraphics[width=0.75\textwidth]{images/BM1A6451_dgDrive_lowres.JPG}
    \caption{Picture of the digital current driver \device{DgDrive}.}
\end{figure}

This section saw the evaluation of several commercial current driver representing the state of the art at the time of writing. These drivers were all found to be unsuitable to drive modern blue laser diodes like the Osram \device{PL 450B} \cite{datasheet_osram_pl450b} used in the ARTEMIS experiment for the \qty{453}{\nm} master laser. The most common problem identified was the limited compliance voltage especially with low-noise drivers like the Vescent \device{D2-105}, which can barely drive modern high power laser diodes like the Thorlabs \device{L785H1} \cite{datasheet_thorlabs_780nm} that require a compliance voltage of more than \qty{2.5}{\V} at high currents. The only solution with such driver is to use a higher output current model and run it at a reduced current. This strategy negatively impact the noise figure as higher current model have a higher output noise. Additionally, node of the low noise drivers have a digital interface to allow remote control.

To address these problems, a new laser driver design is presented that not only surpasses all commercial alternatives, both in performance and price, but also delivers the much needed digital interface to integrate into modern experimental setups. To address the compliance voltage issue which is an inherent problem in the original design by \citeauthor{libbrecht_hall} \cite{libbrecht_hall} upon which all of the driver tested rely one, a novel current source configuration was developed that separates the current source from the load. This ensures low noise, a high compliance voltage and strong noise immunity.

The current driver performance was demonstrated in several of the previous sections and a summary of those finding can be found in the following table.
\begin{center}
    \begin{deviceProperties}[label={lst:dgDrive_summary}]{DgDrive device properties}
    \begin{itemize}
        \item Maximum output current: \qty{500}{\mA} (p. \pageref{tab:dgDrive_configurations})
        \item Temperature coefficient: $\qty{0.1}{\uA \per \K} + \qty{0.5}{\uA \per \A \per \K} \cdot I_{out}$ (p. \pageref{fig:dgDrive_tempco_50mA})
        \item Stability: \qty{< 1 \pm 2}{\uA \per \A \per a} (p. \pageref{fig:stability_dgDrive})
        \item Noise: \qty{< 70}{\pA \per \Hz\tothe{0.5}} above \qty{100}{\Hz} (\pageref{fig:laser_driver_noise_measurement})
        \item Below shot noise above \qty{20}{\mA} for the \qty{500}{\mA} version. (p. \pageref{fig:laser_driver_noise_hmp4040})
        \item Modulation bandwidth: \qty{1}{\MHz} (p. \pageref{fig:dgDrive_modulation_amplitude})
        \item Output impedance: \qty{>1}{\giga\ohm} resulting in excellent noise immunity (p. \pageref{fig:dgDrive_output_impedance_comparison})
        \item Digital control
        \item Python API for remote control
    \end{itemize}
    \end{deviceProperties}
\end{center}

%\begin{figure}[h]
%    \centering
    %\import{figures/}{dgDrive_protocol.tex}
%\end{figure}

%Custom made cables with PTFE insulator, silver plated AWG18 copper wires with a braided shield, M27500

\clearpage








\begin{figure}[ht]
    \centering
\end{figure}





\begin{figure}[ht]
    \centering
\end{figure}

    \centering
        \toprule
        \midrule
        \bottomrule
    \end{tabular}
\end{table}


    \centering
\end{figure}


    \centering
\end{figure}


    \centering
\end{figure}




