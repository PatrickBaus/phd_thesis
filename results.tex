\chapter{Results}
\begin{chapquote}{Sir Terry Pratchett, \textit{A Hat Full of Sky}}
``It's still magic even if you know how it's done.''
\end{chapquote}

\section{Laser Current Driver}
For this project several commercial and publicly available laser current drivers were evaluated for their performance. The following devices were all tested for the requirements listed in \ref{lst:dgDrive_specs_environment} and \ref{lst:dgDrive_specs_electrical}.
\begin{itemize}
    \item Moglabs \device{DLC-202}
    \item Newport \device{TLB-6800-LN}
    \item SISYPH \device{SMC11 Puy Mary}
    \item Toptica \device{DCC 110}
    \item Vescent \device{D2-105}
    \item LQO \device{LQprO} \cite{datasheet_LQprO}
    \item A driver based on the work of \citeauthor{laser_driver_digital} \cite{laser_driver_digital}
\end{itemize}

As a disclaimer, Moglabs, Vescent and SISYPH provided demo units, free of charge to the author and without any obligations regarding this work. The opinions and measurements in this work are in no way biased by this service. All of these drivers claim low-noise in various comparative forms, but vary in features. The \device{DLC-202}, the \device{TLB-6800-LN} and the \device{D2-105} additionally include a peltier controller. The \device{DLC-202} and the \device{TLB-6800-LN} have a modulation source. The \device{TLB-6800-LN}, the \device{DCC 110} and the design by \citeauthor{laser_driver_digital} also feature a digital interface.

The drivers were all compared to our requirements. While not all drivers feature a remote accessible interface, their performance was assesed nonetheless to have a broader range of choices. A performance comparison can be found in section \ref{}. Unfortunately, none the drivers was able to properly drive the high compliance voltage required by the blue laser diode \device{PL 450B} of about \qtyrange[range-units = single]{6}{7}{\V} \cite{datasheet_osram_pl450b}. As it was discussed in section \ref{sec:compliance_voltage}, the compliance voltage of all laser drivers based on the design of \citeauthor{libbrecht_hall} \cite{libbrecht_hall} is limited to around \qtyrange[range-units = single]{2}{3}{\V} at full output (compare \ref{eqn:minimum_mosfet_vds} for details). Since the compliance voltage is rougly proportional to the reciprocal of the output current current, limiting the maximum output current to about \qtyrange[range-units = single]{30}{40}{\percent} increases the compliance voltage to the required level. Not only does this limit the choice of drivers, but also requiring a \qty{500}{\mA} driver for a \qty{150}{\mA} laser diode seems excessive and does not help with the noise requirements, because the output noise of those drivers scales roughly with $I_{max}$ as detailed in section \ref{sec:current_source_noise}, since the op-amp noise is the limiting factor. This lead to the decision to design a current source that meets all of our requirements, while surpassing all available alternative and tackling the compliance voltage limit. This design and its individual components are discussed in the following sections. First, the state of the art is presented, then the problems we encountered are outlined and finally our design, that resolves these issues is presented and the caveats and technical challenges are discussed.

\subsection{The State of the Art in Laser Current Drivers}
Prior to this work, all laser drivers for scientific purposes, were more or less strictly following the design proposed by \citeauthor{libbrecht_hall} \cite{libbrecht_hall}. This design was presented in 1993 and back then, blue laser diodes were were not available and only developed in 1996. See \cite{blue_laser_diodes_history} for an interesting historic summary. Finally, the efforts of Isamu Akasaki, Hiroshi Amano and Shuji Nakamura were rewarded with the Nobel Prize in Physics in 2014. The original laser driver design was therefore created for laser diodes requiring a low current and low compliance voltage compared to modern laser diodes. While the design remains useful for many low power near-infrared (NIR) laser diodes, these shortcommings were never addressed or even acknowleged by commercial alternatives. Sadly, the topic of the compliance voltage is usually not even mentioned in the datasheets -- the Moglabs \device{DLC-202} and SISYPH \device{SMC11} are notable exceptions, but it is unclear from the datasheet to which version and/or currents of the devices the numbers relate. The Newport \device{TLB-6800-LN} is a bit different to the rest of the drivers tested, because it comes with Newport laser heads and reads its configuration data from the laser head. Ours came with a \device{Vantage TLB-7100} and the laser head needs to be connected for it to work. Without some reverse engineering, these drivers can only be used with certain Newport laser heads. The \device{TLB-6800-LN} is included in the list of devices anyway to give an idea of its performance in existing systems.

\begin{table}[ht]
    \centering
    \begin{tabularx}{0.95\linewidth}{l>{\raggedright\arraybackslash}Xl>{\raggedright\arraybackslash}X}
        Laser driver& Output current& Compliance voltage & Additional features \\
        \midrule
        Moglabs \device{DLC-202} & \textbf{\qty[text-series-to-math, reset-text-series = false, reset-math-version = false]{100}{\mA}}, \qty{250}{\mA}, \qty{500}{\mA}& \qty{3.1}{\V} & TEC, PID, Piezo\\
        Newport \device{TLB-6800-LN} & & --& TEC, Piezo, Digital\\
        SISYPH \device{SMC11} & \qty{210}{\mA}, \textbf{\qty[text-series-to-math, reset-text-series = false, reset-math-version = false]{470}{\mA}}& \qty{5}{\V}&\\
        Toptica \device{DCC 110} & \textbf{\qty[text-series-to-math, reset-text-series = false, reset-math-version = false]{100}{\mA}}, \qty{500}{\mA}, \qty{3}{\A}, \qty{5}{\A} & --&\\
        Vescent \device{D2-105} & \qty{200}{\mA}, \textbf{\qty[text-series-to-math, reset-text-series = false, reset-math-version = false]{500}{\mA}} &  --& TEC\\
        LQO \device{LQprO} & \textbf{\qty[text-series-to-math, reset-text-series = false, reset-math-version = false]{140}{\mA}}, \qty{400}{\mA} & --&
    \end{tabularx}
    \caption{Overview of laser current drivers tested. Marked in bold is the version tested in this work. A dash denotes that no official information is available.}
    \label{tab:laser_current_drivers_tested}
\end{table}

The drivers shown in table \ref{tab:laser_current_drivers_tested} will now be discussed in a little more detail to familiarize with them.

Starting with the Moglabs \device{DLC-202}, which is fully integrated unit, that leaves little functions to be desired, it includes the current driver, a pizo driver, a temperature controller for a thermoelectric cooler (TEC) and finally a lock-in amplifier with a PID controller. It is the most integrated solution, that was tested and brings all features required to set up an ECDL locked to an atomic transition. Some of its features are accessible via pin headers. The current source can be remotely enabled and the PID controller can be manipulated to allow relocking the laser or deliberately taking it out lock remotely. There is no way directly adjust the output current over the whole range. It also features a broad range of protection mechanisms for the laser diode, for example disconneting the driver in case of a short or open condition. All relavant quantities can be adjusted and read back from the front panel display. The manual is fairly comprehensive and gives a lot of examples to set up a laser system.

The Vescent \device{D2-105} also features more than just the laser driver and includes a TEC controller as well. Unfortunately, adjusting this temperature controller prooved fairly cumbersome, because the driver has to be opened to adjust trimpots inside the driver. When the unit is placed in a rack, this might even be impossible to realize. The laser current is normally adjusted via a 10-turn potentiometer and can also be steered via an external input, but the stability of the current then depends on the external control voltage. It does not feature any protection features like open or short detection, so disconnecting and reconnecting the cable to the laser will most likely damage the laser diode. The display can be switched to show all relavant quantities. Moreover, the manual is not as comprehensive as the manual of the \device{DLC-202}, but covers all relavant settings of the driver.

The SISYPH \device{SMC11} does not include any additional features, but covers the most important protection features like an open detection and shuts down the driver accordingly. It is fully rackmountable, unlike the drivers discussed so far. The setpoint of the driver is adjusted via a recessed trimpot using a screwdriver, which has prooven troublesome to adjust in the lab when not directly in front of the unit. The current can be externally adjusted using an input connector, but again this limits the stability to that of the external source. The driver does not have any display and all setpoints must either be adjusted blindly or a volmeter must be attached to the monitoring connector limiting the usefulness in a lab environment. The user manual covers only the basic settings and gives no details regaring the layout of the pin headers or external connectors making it hard to understand without having the device at hand.

The Toptica \device{DCC 110} is also only a current source and is rack mounted. It comes with a separate display module, which connect via the backplane. The setpoint is adjusted via 10-turn potentiometer and can additionally be adjusted via the backplane with an external signal, again limiting the stability of the driver to the external source. The manual is fairly comprehensice and covers all essentials.

The Newport \device{TLB-6800-LN} is the only driver, that has a digital interface and supports Standard Commands for Programmable Instruments (SCPI) commands. It incorporates a TEC controller and a piezo controller. Unfortunately, it only works with a limited number of lasers, because it reads some parameters, like the maximum output current from the laser head at startup. The user manual covers all device functions, but gives little detail about the hardware, making this a closed system.

The results of the performance tests conducted prior to building our own solution will be presented on the following pages, including problems typically encountered and their solution. These tests include the stability, current noise and output impedance of the drivers. Not all drivers were put through the full test, if it was already clear that they could not perform in our setup for a laser system for the spectroscopy of highly charged ions driving a blue laser diode.

\clearpage
\subsection{Laser Driver: Design Concept}
In order to interpret the results in sections \ref{sec:results_current_noise}, \ref{sec:results_stability}, it it helpful to discuss in more detail the design concept of the current state of the art, which is based on the driver design presented by \citeauthor{libbrecht_hall} \cite{libbrecht_hall}. The design can be split into the four building blocks shown in figure \ref{fig:laser_driver_libbrecht_hall_concept}. A supply voltage input filter, a reference voltage to create the setpoint, a unidrectional current source and some form of bidirectional current source used for modulating the laser current at high frequency.

\begin{figure}[ht]
    \centering
    %\resizebox {0.8\textwidth} {!} {
        \import{figures/}{laser_driver_libbrecht_hall_concept.tex}
    %} % resizebox
    \caption{Building blocks of a laser driver based on \cite{libbrecht_hall}.}
    \label{fig:laser_driver_libbrecht_hall_concept}
\end{figure}

The original design is the most straightforward approach and it is possible to reproduce it even on prototype printed circuit boards (PCBs). \citeauthor{laser_driver_digital} \cite{laser_driver_digital} replaced the potentiometer with a DAC, but left the other parts untouched. \citeauthor{laser_driver_qcl_taubman} \cite{laser_driver_qcl_taubman,laser_driver_qcl_taubman_multiplexer} published some extensive modifications, which not only replaced the reference circuit with a DAC and an \device{LTZ1000} reference, but also added extensive filtering of the supply. The next sections will discuss these different elements separately and give some in insight into the different versions of the elements found in literature. The sections also details problems discoverd and the solution proposed in the design presented here.

\clearpage
\subsection{Supply Filtering}
The supply section of the design by \citeauthor{libbrecht_hall} was shown simplified in figure \ref{fig:laser_driver_libbrecht_hall_concept}. The original filteronly consists of a CLC filter or sometimes called \pi-filter shown in figure \ref{fig:laser_driver_libbrecht_hall_filter}. Do note, that due to the small input capacitance, the filter is basically just an LC-filter.

\begin{figure}[ht]
    \centering
    %\resizebox {0.8\textwidth} {!} {
        \import{figures/}{laser_driver_libbrecht_hall_supply_filter.tex}
    %} % resizebox
    \caption{Power supply filter of a laser driver based on \cite{libbrecht_hall}. The op-amps are supply by the filtered voltage and the current source is supplied by the \device{LM317}.}
    \label{fig:laser_driver_libbrecht_hall_filter}
\end{figure}

The LC-filter is best suited for a low impedance source like a power supply, because it has a high input impedance. From the transfer function
\begin{equation}
    H(s) = \frac{Z_{out}}{Z_{in}} = \frac{\frac{1}{sC}}{sL + \frac{1}{sC}} = \frac{1}{s^2LC +1} = \frac{\frac{1}{LC}}{s^2 + \frac{1}{LC}} = \frac{\frac{1}{LC}}{\left(s+i\frac{1}{\sqrt{LC}}\right)\left(s-i\frac{1}{\sqrt{LC}}\right)}\,, \label{eqn:transfer_function_lc_filter}
\end{equation}
one can deduce, that the passband gain at DC is \num{1} (obviously) and additionally, there are two complex poles in the imaginary plane at $s = \frac{\pm i}{\sqrt{LC}}$, putting the cutoff frequency of the 2\textsuperscript{nd} order filter at $f_c = \qty{2.3}{\kHz}$. Do note, due to the imaginary poles, there is some gain peaking at $f_c$. Normally, this is damped by the parasitic resistance of the inductor and capacitor. A more detailed analysis follows below, because the cutoff frequency is all that is of interest right now.

In this design, the op-amps are directly driven off the filtered supply rail. Using this information it is possible to estimate the effectiveness of the filter. Using the \qty{30}{\nA_{rms}} in a \qty{100}{\kHz} bandwidth current noise requirement from table \ref{lst:dgDrive_specs_electrical}, the voltage noise at the sense resistor (\qty{14}{\ohm}, (see section \ref{sec:component_selection}) must be no more than \qty{420}{\nV_{rms}}. Now, taking for example a low-noise switch-mode power supply like the Rohde \& Schwarz \device{HMP4040} used at CERN \cite{hmp4040_noise}, which does have fairly pronouced noise at the switching frequency of around \qty{170}{\kHz} and harmonics. The author measured these glitches to be about \qty{3}{\mV_{pp}}. The noise will have to go through the filter and the supply rejection ratio (PSRR) of the op-amp. The PSRR of the \device{LT1028} at \qty{170}{\kHz} is about \num{e-2} under ideal conditions \cite{datasheet_LT1028} and the filter adds another \num{e-2} when accounting for a \qty{0.5}{\ohm} series resistance of the output capacitor. The total filtering adds up to about \num{e-4}, which still leaves \qty{21}{\nA_{pp}} of ripple on the drive current in a very small bandwidth.

To have a better rejection of such switch-mode noise, the filter must be improved. The paper presented by \citeauthor{laser_driver_qcl_taubman} \cite{laser_driver_qcl_taubman} shows a brute-force approach. They applied extremely high values for the capacitor $C_{LC}$ of the LC filter of \qty{10}{\milli\farad} and then put a second filter based on a so-called capacitance multiplier behind it. This implementation is shown in a simplified form in figure \ref{fig:laser_driver_taubman_filter} and briefly discussed now. For a more detailed schematic and part names see \cite{laser_driver_qcl_taubman}.

\begin{figure}[ht]
    \centering
    %\resizebox {0.8\textwidth} {!} {
        \import{figures/}{laser_driver_taubman_filter.tex}
    %} % resizebox
    \caption{Power supply filter using a capacitance multiplier for a cutoff frequency of \qty{0.5}{\Hz}. This is a simplified schematic based on \cite{laser_driver_qcl_taubman}. Only the positive rail is shown.}
    \label{fig:laser_driver_taubman_filter}
\end{figure}

\citeauthor{laser_driver_qcl_taubman} built this filter for a driver with a driving capacity of \qty{2}{\A}, which limits the size of the inductor that can be used, in order to make up for that, he is forced to use giant capacitors. The second stage of the filter comprises a capacitance multiplier, which is formed by wrapping a feedback loop around the 2\textsuperscript{nd} order filter created by $R_1 C_1$ and $R_2 C_2$. This feedback loop removes the main current from the filter resistors, to allow larger values for $R_1$ and $R_2$, while maintaining a fairly low output impedance of the filter. The properties of this construction will be discussed now.

As a first note, the circuit presented by \citeauthor{laser_driver_qcl_taubman} misses a detail, which should included, when handling such capacitances. The circuit must include a reverse polarity protection, or rather a reverse current protection. If the input is shorted by accident, the \qty{10}{\milli\farad} of capacitance would immediately discharge via the parasitic body diode of the slow start-up transistor, likely vaporizing everything in its path. This could be implemented by adding another transistor to act as a reverse current protection.

% TODO: Add an appendix about the capacitance multiplier. See capacitance multipler/The Capacitance Multiplier Theory.pdf
The following explanation relies on some basic knowlegde about transistors. A good introduction to transistors is the Transistor Manual \cite{transistor_bible}, some even call the bible of transistors. Armed with some basic knowledge, the capacitance multiplier can be discussed and it must already be said, that the term capacitance multiplier is a bit misleading. It neither multiplies the capacitance, nor does is behave like a real 2\textsuperscript{nd} order filter. The only thing that is multiplied by the gain of the transitor, is the output capacitance seen by load, making the capacitor look more ideal. Unfortunately, it  highly depends on the properties of the transistor(s) and the gain of transistors drops with increasing output current (although it rises with temperature). Make sure to consult the datasheet, which typically gives a plot of the ac current gain $h_{fe}$ vs the collector curren $I_C$ to see at which load current, $h_{fe}$ starts dropping. Another issue is the bandwidth of the circuit, because $h_{fe}$ of any transistor rolls off with frequency. The high frequency resonse of this filter then becomes constant. This limits the suppression at around \qty{1}{\kHz} (depending on the output current of course) to around \numrange{500}{1000}. It is usefuly at low frequencies though, as it is shown in the publication of \citeauthor{laser_driver_qcl_taubman}. Another point is the maximum ripple voltage, that can be filtered. The muliplied capacitance does, of course, not store the same amount of energy as a real capacitor. This means the maximum peak-to-peak input ripple is limited to about one diode drop of \qty{0.68}{\V} from the Collector-Emitter diode. If more ripplle rejection is required an additional resistor from the base of $Q_2$ to ground like shown in figure \ref{fig:laser_driver_taubman_filter} can be applied. This reduces the output voltage further though. In this design, the current through $R_m$ is sufficient.

As a final remark regarding the capacitance multiplier is the output impedance. The transistor has an output impedance like a diode, so it increases with decreasing current. This means it will also drop about \qty{1.2}{\V} at \qty{500}{\mA} and about \qty{0.3}{\V} at \qty{1}{\mA}. This behaviour must be taken care of by the voltage regulator following the capacitance multiplier. The \qty{2}{\V} drop is also not a problem in this use case and even comes in handy. If just the supply rail of the laser diode current is fed through the capacitance multiplier, as it is the most sensitive, and the supply rail for the op-amps is not, then those extra \qty{2}{\V} will do not be a problem. In section \ref{sec:component_selection} it was already mentioned, that for example the \device{AD797} op-amp needs a supply that is \qty{3}{\V} above the diode supply. This means, that less voltage needs to be dropped by the linear regulator that follows the filter. To sum it up, the capacitance multiplier behaves like an ordinary $RC$ filter, but with a lower output impedance and only works at low ripple voltages, is limited in the high frequency domain.

% Note: 'Minimizing Input Filter Requirements In Military Power Supply Designs' has a more elaborate design
The power supply filters applied in this design use a passive LC filter for the negative and positive rail, then a capacitance multiplier on the diode supply. The negative rail is simply mirrored from the positive rail and pnp instead of npn transistors and vice versa are used. The combined filter is shown in figure \ref{fig:laser_driver_dgdrive_filter}. The diode supply and the analog rail, which is taken before the capacitance multiplier, are fed to low noise post-regulators, the \device{LT3045} and its negative counterpart, the \device{LT3094}. Both regulators have excellent power supply ripple rejection (PSRR) out to at least \qty{1}{\MHz} of more than \num{e3}. At low frequency the PSRR is even higher and more than \num{e5} can be expected. This allows a combined PSRR of better than \num{e6} from low to high frequencies, even beyond \qty{1}{\MHz}.

\begin{figure}[ht]
    \centering
    %\resizebox {0.8\textwidth} {!} {
        \import{figures/}{laser_driver_dgdrive_supply_filter.tex}
    %} % resizebox
    \caption{Power supply filter of the digital current driver.}
    \label{fig:laser_driver_dgdrive_filter}
\end{figure}

Regarding the filter circuit shown in figure \ref{fig:laser_driver_dgdrive_filter} a few explaining words on the choice of components are in order before proceeding to the measurement of the PSRR. Going back to equation \ref{eqn:transfer_function_lc_filter}, we saw, that the undamped second filter has excessive ringing at the cutoff frequency, because the filter poles are imaginary. To address this, there are several solutions. The most simple one is adding a damping element, either in parallel to the capacitor or in parallel the inductor. In this case a damping element in parallel to the capacitor was chosen, because using a a damping element parallel to the inductor will degrade the filter performance by making the blocking inductor lossy. Using the arangement shown in figure \ref{fig:laser_driver_dgdrive_filter}, the transfer function can be calculated.
\begin{align}
    H(s) &= \frac{Z_{out}}{Z_{in}} \nonumber\\
    Z_{out} &= \left(R_d + Z_{C_d}\right) || Z_{C_1} = \left(R_d + \frac{1}{s C_d}\right) || \frac{1}{s C_1} = \left(\left(R_d + \frac{1}{sC_d}\right)^{-1} + sC_1\right)^{-1} \nonumber\\
    &= \frac{s C_d R_d +1}{s^2 C_1 C_d R_d + s \left(C_1 C_d\right)}\\
    Z_{in} &= sL_1 + \left(R_d + Z_{C_d}\right) \nonumber\\
    H(s) &= \frac{\frac{s C_d R_d +1}{s^2 C_1 C_d R_d + s \left(C_1 C_d\right)}}{s L_1  + \frac{s C_d R_d +1}{s^2 C_1 C_d R_d + s \left(C_1 + C_d\right)}} = \frac{s C_d R_d +1}{s^3 L_1 C_1 C_d R_d + s^2 L_1 \left(C_1 + C_d\right) + s C_d R_d +1 }
\end{align}

% TODO: Add derivation, because the Middlebrook paper is hard to come by. This is already prepared in 'Input Filter Derivation.pdf' and Input Filter Theory.pdf', but needs to be checked again.
This is the transfer function of a 3\textsuperscript{rd} order filter. This type of filter was discussed by \citeauthor{input_filter_middlebrook} \cite{input_filter_middlebrook} (reprinted in \cite{input_filter_middlebrook_reprint1} and \cite{input_filter_middlebrook_reprint2}). \citeauthor{input_filter_middlebrook} derived, that there is an optimal value for the series resitance $R_d$ given a capacitance $C_d$ and the filter components $L_1$ and $C_1$. This optimal value has minimal gain peaking, hence a minimal quality factor $Q$ at the resonance freuency. The existance of such an optimal value can be easily understood from the fact, that if $R_d = \infty$ the resonance frequency is $\omega_0 = \frac{1}{\sqrt{L_1 C_1}}$ and in case $R_d = 0$ it is $\omega_1 = \frac{1}{\sqrt{L_1 \left(C_1 + C_d\right)}}$. In between $\omega_0$ and $\omega_1$, there is a lossy zone, where $R_d$ due to its lossy nature reduces $Q$, but at both ends $Q = \infty$, so there must be a minimum in between. By calculating, the minimum value of the transfer function at the point of resonance, \citeauthor{input_filter_middlebrook} found the following results:
\begin{align}
    R_0 &\coloneqq \sqrt{\frac{L_1}{C_1}}\\
    n &\coloneqq \frac{C_d}{C_1} \Rightarrow C_d = n C_1 \label{eqn:lc_filter_cd}\\
    Q_{optimal} &= \sqrt{\frac{(4+3 n) (2+n)}{2 n^2 (4+n)}}\\
    R_d &= R_0 \cdot Q_{optimal} \label{eqn:lc_filter_rd}
\end{align}

% TODO: Derive the 2x / 10 K rule. This is prepared in 'Capacitor life doubles theory.pdf'.
From these equations, it can be seen, that the damping capacitor $C_d$ needs to be fairly large, depending on $n$. A critically damped system with $Q = \num{0.5}$ would be preferred, but this would require $n \approx 6$ making the $C_d$ prohibitively large. For this filter $n=4$ was chosen, so making the filter slightly underdamped, so a slight gain peaking at the resonace can be expected. The following componets were chosen. First, a large, low resistance inductor $L_1$ capable of carrying at least \qty{1}{\A} was chosen. In this case a Coilcraft \device{MSS1210-125KEB}. High reliability capacitors were chosen to ensure a long lifetime of the device. Choosing capacitors rated with a lifetime of \qty{5000}{\hour} at \qty{105}{\celsius} gives a expected service life of more than \qty{10}{\year}, when assuming an Arrhenius law with a doubling of the lifetime every \qty{10}{\kelvin}. Apart from the reliability of the capacitors, there are no special requirements for them as there is little ripple current to be expected. The input power supply is supposed to be a filtered low noise supply and not the unfiltered output of a DC/DC regulator. So it is possible to maximize $L_1$ and choose a physically smaller $C_1$ since board space is limited. This results in the following design values, calculated from equations \ref{eqn:lc_filter_cd} and \ref{eqn:lc_filter_cd}, given the components values discussed above.
\begin{align}
    C_1 &= \qty{100}{\uF} \nonumber\\
    n &= 4 \nonumber\\
    Q_{optimal} &\approx \num{0.61} \nonumber\\
    R_d &= \num{0.61} \approx R_0 \approx \qty{2}{\ohm} \nonumber\\
    C_d &= \qty{400}{\uF} \approx \qty{390}{\uF} \nonumber\\
    f_c &\approx \qty{300}{\Hz} \nonumber
\end{align}

Do note, that $R_d$ does include the equivalent series resistance (ESR) of $C_d$, so the ESR of the capacitor must be subtracted from the final value of the damping resistor placed on the board. This may even absolve one from the need for a discrete resistor if the ESR of the capacitor is high enough. The transistors chose were a combination of a Toshiba \device{TTA004B}/\device{TTC004B} and Onsemi \device{BC817-40}/\device{BC807-40} for the positive/negative rail. The \device{TTA004B}/\device{TTC004B} are good up to about \qty{500}{\mA}. At this point the gains start dropping. A higher power transistor like the Onsemi \device{D45H8}/\device{D44H8} used by \citeauthor{laser_driver_qcl_taubman} is recommended for $Q_1$ and $Q_3$.

Finally, one last part of the capacitance multiplier should be explained. Highlighted in green in figure \ref{fig:laser_driver_dgdrive_filter} is a fast startup circuit. At startup, the capacitor $C_m$ is discharged and \qty{15}{\V} will be applied, it will then begin to charge with a current of \qty{1.5}{\mA} through the \qty{10}{\kilo\ohm} resistor. Because the $Q_2$ is an emitter follower, hence the emitter follows the voltage at the base (minus a diode drop for the base-emitter diode). As a sidenote, when using this kind of circuit, since $Q_2$ is an emitter follower, all output capacitors, that follow the capacitance multiplier will charge at the same rate as $C_m$, voltage-wise, this means, that for every \qty{10}{\uF} of output capacitance, a current of \qty{1.5}{\mA} will flow. While this not significant at this moment it become so, when looking at the fast startup circuit. Applying the input voltage of \qty{15}{\V} at startup over the LED, a \qty{625}{\nm} WÃ¼rth Elektronik \device{150080RS75000}, it will start conducting, resulting in a \qtyrange[range-units = single]{1.8}{2}{\V} drop. The current flowing into $C_m$ is therefore dependent on the diode series resistor, which was chosen to be \qty{510}{\ohm}, a value not particularily important in this case. So at startup about \qty{25}{\mA} will flow into $C_m$, which means \qty{2.5}{\mA \per \uF} will flow through $Q_1$ and $Q_2$. Assuming roughly \qty{100}{\uF} of distributed bypassing capacitance around the board, this is around \qty{500}{\mA}. All these values are still well below the damage threshold of the transistors (\qty{2.5}{\A} and \qty{0.5}{\A}) and the LED (\qty{30}{\mA}), but these values must be kept in mind, when adding larger output capacitors. The fast startup circuit ensures an output voltage of \qty{13}{\V} within \qty{100}{\ms} instead of around \qty{0.5}{\second}, reducing the time to boot and leaving more time for self-checks without impacting the user experience.

After choosing the values above, the filter was simulated using LTSpice to assert the validity of the parameters chosen. The simulation was conducted with a load current of \qty{500}{\mA} running through the capacitance multiplier to simulate the worst case. As discussed above, the gain of the transistor $h_{fe}$ drops at higher currents as the transistor saturates. This particularily affects the high frequency behaviour above \qty{10}{\kHz}. The source file can be found in \external{source/spice/input\_filter\_dgdrive.asc}. The simulation additionally includes the series resistance and parasitic parallel capacitance of $L_1$, the latter will induce some ringing at the self resonance frequency of the inductor at \qty{1}{\MHz} and limit the useful attenuation beyond that to around \num{e3} due to the capacitive coupling of the conductor windings. At the \qty{170}{\kHz} discussed before, the damping is about the same figure of merit, \num{e3}.

The suppression is an order of magnitude better than the filter used by \citeauthor{libbrecht_hall} and it does not even include the high performance regulators that follow. The transfer function for both the damped LC filter and the LC filter with the capacitance multiplier in series is plotted in figure \ref{fig:laser_driver_input_filter}. The self resonance peak at \qty{1}{\MHz} can be clearly seen and is not damped, but from the output impedance shows shows that, there is enough capacitance present to compensate for this. The output impedance above \qty{1}{\MHz}, it is dominated by the local bypass capacitors and not accurately represented by the simulation. It can be expected to by lower than the simulated results, which do not include those capacitors.
\begin{figure}[ht]
    \centering
    \input{images/input_filter_dgdrive.pgf}
    \caption{Simulated response of input filter used in the digital current driver. Both magnitude and output impedance of the stages are shown.}
    \label{fig:laser_driver_input_filter}
\end{figure}

At \qty{300}{\Hz}, the LC filter cutoff frequency, the output imedance of the LC filter shows some gain peaking. This is due to the underdamped response chosen and discussed above. This peaking increases the output impeance of \qty{1.2}{\ohm} in the passband, which is mostly the resistance of the inductor, to a total of \qty{1.8}{\ohm}. This can be easily compensated for by the regulators downstream.

The rejection ratio of the LC filter and the capacitance multiplier is better than \num{e3} at at \qty{100}{\kHz} an above, delivering the performance estimated above. This is expected to keep switch-mode noise away from the laser driver current.

The high rejection ratio of the filter is expected to make the the experimental validation rather challenging, because there are a number of complications that derive from the active nature of the circuit. The capacitance multiplier must be loaded, preferably at the maximum current to show the worst case and additionally, the ripple voltage must be low enough to not saturate the capacitance multiplier.

This requires a highly sensitive VNA, that has a low frequency range. This setup uses an Omicron Lab \device{Bode 100}, which can measure from \qty{1}{\Hz} to \qty{50}{\MHz} with an exceptionally low noise floor of about \qty{180}{\nV \Hz\tothe{-0.5}} \cite{datasheet_bode100}. Additionally a Stanford Research \device{SR560} was used as a pre-amplifier. To apply the ripple voltage to the power supply rails a Picotest \device{J2123A} negative line injector and a self-designed positive line injector was used. The positive line injector design is available open-source and be found in a Github repository at \cite{line_injector_github}. This injector is called \device{PB02}. During the measurement, it was found, that since the expected signal is extremely small, ground currents became an issue. There is an inherent ground loop issue built into the VNA. The outputs and inputs of the \device{Bode 100} are not isolated. The measrement is a 3-port measurement as shown in figure \ref{fig:laser_driver_supply_filter_measurement}. The \device{Bode 100} is driving the line injectors, measuring the signal going into the line injector and finally sampling the signal accross the output capacitor of the filter. The ground current now has two choices of flowing. One is through the low side of the measurement cables and their resistance, or through the ground plane of the VNA. The latter is the dreaded ground loop. This ground loop becomes more pronouced at higher frequencies, because the return path trough the cable is inductive and its impedance increases with frequency. Typically this problem would be addressed using a common-mode choke inserted into CH2. CH2 is the VNA input measuring the filter output. This common-mode choke prevents any current flowing through CH2, that has not flown through the cable.

%TODO: Add an image showing the ground loop, the Bode 100 and the 2-port shunt-thru measurement.
Unfortunately, the author did not have a suitable common mode choke at hand, so the only feasable solution to at least suppress the ground loop for low frequencies was to add transformers at the output and the CH2. This isolates the output and the battery powered \device{SR560} is driving the VNA via the transformer, isolating the input as well. The transformer used for isolating the VNA output, was an injection transformer named \device{PB01}. It is center tapped to create an anti-symmetrical output for the injection transformers. The center tap reduces the output amplitude by one half. The details regarding this device and its construction can be found in annex \ref{sec:injection_transformer}. The transformer used at the output of the \device{SR560} is a Picotest \device{J2123A}. Both transformers are unfortunately injection transformers and not dedicated isolation transformers as discussed in annex \ref{sec:injection_transformer}, yet the only transformers available at the time. The consequences of this subtle detail will become imminent in a moment.

\begin{figure}[ht]
    \centering
    \resizebox {0.9\textwidth} {!} {
        \import{figures/}{laser_driver_dgdrive_supply_filter_measurement_setup.tex}
    } % resizebox
    \caption{Power and grounding scheme for a low noise measurement of the line filter rejection ratio, minimizing the interfernce of circuit return currents.}
    \label{fig:laser_driver_supply_filter_measurement}
\end{figure}

The digital current driver is powered by the Rohde \& Schwarz \device{HMP4040} and there is a single point of ground connected to protective earth at the power supply. The power supply feeds into the line injectors, through which the current driver is powered. The output current is set to \qty{500}{\mA} accross a \qty{10}{\ohm} dummy resistor. The SR560 measures the ripple voltage after the LC-filter and drives the VNA input via the transformer. The measurement cable used is a short  twisted pair to reduce noise pickup.

The ouput of the VNA was set to \qty{-27}{\dB m} (\qty{10}{\mV_{rms}}), which must by multiplied by about $0.5 \cdot 0.975 = 0.485$ to give the ripple voltage on the positive supply, the latter term comes from the line injector \cite{line_injector_github}. Putting this into perspective, given a \qty{-60}{\dB} (\num{e-3}) suppression, results in a ripple voltage of only \qty{4.9}{\uV_{rms}}.

\begin{figure}[ht]
    \centering
    \input{images/dgDrive_supply_filter_bode.pgf}
    \caption{Measured response of input filter used in the digital current driver. Above \qty{10}{\kHz} capacitive coupling through the transformer can be seen.}
    \label{fig:laser_driver_input_filter}
\end{figure}

Figure \ref{fig:laser_driver_input_filter} shows the measurement of the LC-filter output. At low frequencies, there is good agreement with the simulation and the filter rolls off with \qty{-40}{\dB \per decade}. At around \qty{10}{\kHz} the noise floor of the measurement is reached at \qty{-55}{\dB}. Then the ground loop shows itself again coupling through the transformers. The magnitude rising with \qty{20}{\dB \per decade} is an artifact, which can be significantly influence by changing the type of probing and the location of probing, so at this point it is clear that for any usable data above \qty{10}{\kHz} a common-mode choke is required. Additionally the noise floor of the measurement is reached at around the same frequency, requiring a lower noise amplifier. Due to the lack of another amplifier and the choke, the author left the measurement as is. It is still a good example to show the pitfalls of a 2- or 3- measurement. This topic will be revisted later in section \ref{sec:results_current_noise}, when measuring the current noise of the driver.

To conclude, the measurements show that the LC supply filter is correctly damped with the expected corner frequency of \qty{300}{\Hz} and will likely perform as intended, but above \qty{10}{\kHz} the filter performance cannot be accurately measured due to the limited setup.


\clearpage
\subsection{TODO: Need title}
The author had actually intended to test the stability of the laser drivers first, but the plans were foiled by a misbehaving lab. First tests revealed, that depending on the temperature of cooling water supplied to the overhead air conditioning unit there were temperature fluctuation of up to \qty{2}{\K} observable in the lab. While the effect is not suprising, the observed temperature fluctuations impose a limit on the observable accuracy, due to the temperature coeficient of the multimeter used to record the data. To illustrate the effect, a sample measurement\footnote{\qty{100}{\mA} range, \qty{10}{\plc}, AZERO ON, $f_s = \qty{0.5}{\Hz}$} is shown in figure \ref{fig:laser_driver_aircon}. The Keysight \device{34470A} used to record the data is specified at \qty{6}{\uA \per \K} for a current of \qty{50}{\mA} on the \qty{100}{\mA} range.

\begin{figure}[ht]
    \centering
    \input{images/laser_driver_aircon.pgf}
    \caption{Measurering a \qty{50}{\mA} current using a Keysight \device{34470A} with changing ambient temperature. The current source is based on the design of \citeauthor{laser_driver_digital}.}
    \label{fig:laser_driver_aircon}
\end{figure}

Admittedly, the example in figure \ref{fig:laser_driver_aircon} does not reflect the correct way to measure current with high stability, but serves as an excellent example to highlight the problem. The room temperature heavily depends on the inner workings of the air conditioning system used in the building and the problem is not always present. Nonetheless, longer measurements over several days necessitated the development of a PID controller module to replace the stock temperaure controller of the air conditioning unit in the lab. This project is described in section \ref{sec:lab_temp_control}.

In the meantime, measurements, that only required short-term stability were conducted. Measurering the current noise of the drivers is one such measurement.

\clearpage
\subsection{Test Results: Current Noise}
\label{sec:results_current_noise}
The spectral current noise density is a quantity, that is both seemingly trivial to measure and also easy to understand and graphically compare, therefore many devices are emblazoned by such graphs. The upside is, that these numbers can used for reference. Defining the bandwidth of such a measurement is a matter of debate, the available measurement devices and depends of the future use-case of the current driver. We chose an upper frequency of \qty{1}{\MHz} for two reason, first, to limit the number of amplifiers required. As the noise power rises with the bandwidth (in the best case as $\sqrt{\Delta f}$ for white noise) and impedance matching comes into play, a higher power amplifier is required, a trait that does not bode well with low noise, low frequency frontends. So for frequencies above a few \unit{\MHz} different amplifiers are called for. More amplifiers make the whole measurement more intricate, because the amplifiers are the most critical parts in the whole chain.

The second reason does not root in the lazyness of the researcher, but has a physical origin. Cables used in the lab like RG-58 or RG-223 have a capacitance of about \qty{100}{\pF \per \m}. With a cable length of around \qty{3}{\m} resulting in \qty{300}{\pF}, one finds, that at \qty{10}{\MHz} the impedance seen by the laser diode approaches \qty{50}{\ohm}, not unsurprising, given that the cable impedance is about \qty{50}{\ohm} and a signal at \qty{10}{\MHz} has a wavelength of $\lambda \approx \qty{2}{\m}$. This is aproaching the quarter-wave rule beyond which one should treat the cable as a transmission line. It is therefore reasonable to limit the noise measurement to \qty{1}{\MHz}, beyond which a design specific implementation including the laser head is called for anyway.

\clearpage
\subsection{Test Results: Stability}
\label{sec:results_stability}
When remotely controlling a laser system, stability of the laser driver is of immediate concern, because uninterrupted operation of the system is a key requirement and if the laser cannot be locked again remotely, it is time consuming, if possible at all, to go to the remote laser lab and readjust the laser current driver. The development of the past years have also shown a greater demand of remote working rendering readjustment unfeasable. To assure the specifications given in \ref{lst:dgDrive_specs_environment}, the current drivers were first tested for \qty{24}{\hour} to ensure. This test was refined several times over the course of this work, to reflect the need for a better signal so noise ratio. The first tests were done by feeding the output current of the laser driver into a (calibrated) Keysight \device{34470A} and measuring the output over \qty{24}{\hour}. The \device{34470A} was warmed up for \qty{8}{\hour} and so was the laser driver. The ambient temperature and humidity were recorded by the lab monitoring system descibed in section \ref{}.


\subsection{Zener Diode Selection}
\label{sec:zener_diode_selection}
Early tests of the LM399 Zener diode as a reference have confirmed, what the data sheet \cite{datasheet_LM399} already suggest in the 'Low Frequency Noise Voltage' plot. There are random bi-stable voltage step changes. This phenomenon is called burst noise or popcorn noise.

\begin{figure}[ht]
    \centering
    \input{images/lm399_popcorn_noise.pgf}
    \caption{Popcorn noise in different samples of the LM399 over a \qty{24}{\hour} period.}
    \label{fig:popcorn_noise_lm399}
\end{figure}

Figure \ref{fig:popcorn_noise_lm399} shows two samples of the LM399, that exhibit popcorn noise, while the last one does not.

The sources of popcorn noise in semiconductor devices are not yet fully understood, but some sources have been identified. Defects in the semiconductor crystal lattice and contamination of the semiconductor material have been linked to popcorn noise \cite{technote_ti_popcorn_noise}. This problem has improved over the years as manufacturing processes and wafer quality has evolved. Unfortunately the LM399 is built around a process from 1991, as can be seen etched into the die \cite{lm399_richi}.

The popcorn noise caused by defects and contamination can be reduced by lowering the strain on the lattice and removing surface contaminants on the die. This can be can be achieved using a high-temperature burn-in process. Manufacturers like Fluke and Keysight use similar techniques in their products. Fluke, for example, uses a period of \qty{60}{\day} burn-in for their references \cite{zener_popcorn_noise}.

Fortunately, the LM399 is a heated reference, which regulates its die to \qty{90}{\celsius} when turned on, so it is only required put the diodes in a simple test circuit and wait. The use of a separate test setup instead of the final circuit has both advantages and disadvantages. The disadvantage is, that the Zener diode will subjected to mechanical stress when soldered, this stress will not be removed by the burn-in process as it happens after the testing, when diode is soldered into the final circuit, but this mainly affects the voltage drift properties of the Zener diode and not the popcorn noise. The drift of the diode is also only of secondary concern in our setup, as the drift is mainly caused by the reference resistors used and are typically at least an order of magnitude worse than the the drift of the diode judging by the data sheet \cite{datasheet_LM399,datasheet_VPR}.

The advantages of testing the Zener diodes separately, on the other hand, are, that more diodes can be tested at the same time, as a special compact test fixture can be used. It is also simpler to remove the diodes from the test fixture, because they be socketed. Therefore for our application a separate test board was used. Building this test setup is detailed in the next sections.

\subsection{Building a Test Setup for Zener Diodes}
There are several ways to measure the popcorn noise of semiconductor devices. The most trivial one is to directly monitor the device in the time-domain. In this case, the Zener voltage can be monitored with a long-scale multimeter. It requires a low noise DMM, that can reliably distinguish between both voltage levels, which are about \qty{4}{\micro \volt} apart.
A related option is to use a second reference, whose voltage is similar to the device under test (DUT). Measuring the the voltage difference between the two references, less resolution is required. Directly comparing the difference of two references using a millivolt meter is commonly done when intercomparing primary voltage references. This method, however, increases the measurement noise by a factor of $\sqrt{2}$, if both references produce the same level of uncorrelated noise. The noise of the LM399 with a \qty{100}{\plc} integration time (\qty{2}{\second}) is about \qty{1.5}{\micro \volt_{pp}} as can be determined from the data in figure \ref{fig:popcorn_noise_lm399}.

\begin{figure}[ht]
    \centering
    %\input{figures/lm399_popcorn_noise.pgf}
    \includegraphics[width=0.75\textwidth]{example-image-golden}
    \caption{Voltage noise of an LM399, measured with a bandwidth of \qtyrange{0.1}{10}{\Hz}.}
    \label{fig:noise_lm399}
\end{figure}

Measuring two references against each other would then result in around \qty{2.1}{\micro \volt} of noise. This make distinguishing the jumps possible, but challenging.

A third option is to use a high-pass filter and an amplifier. Additionally, the signal can be low-pass filtered to remove any excess high frequency noise. This approach also requires less resolution than directly measuring the voltage, because the signal-to-noise-ratio is improved du the amplifier. It is therefore possible to use an off-the-shelf analog-to-digital converter (ADC). One such circuit, along with some examples, is demonstrated in \cite{technote_ti_popcorn_noise,kay2012operational}. It must be noted, that due to the high-pass filtering, it not possible to measure slow voltage drifts using this method.

The forth and final option presented here, is approaching the problem in the frequency domain and requires a low-noise amplifier with a low frequency cutoff. As it was already discussed in section \ref{sec:theory_burst_noise}, popcorn noise is found to have a frequency dependence of $1/f^2$. This can be used to distinguish it from other random noise processes that show a frequency dependence of $1/f$. A good example of an op-amp, that has excessive burst in comparison to a good sample is given in \textit{The Art of Electronics} \citep[p. 478]{horowitz1989}. Going to frequencies below \qty{10}{\Hz}, one can sort the references by their noise spectrum.

In this work only options one and two were were tested, as it was said above, with options three and four there is a chicken and egg problem. One needs a number on known good devices to compare other DUTs to. At the start of the evaluation, most of the data available about the LM399 was from the data sheet. Compiling a dataset of the performance of dozens of LM399 is expensive and time consuming and companies typically treat such data as a closely guarded secret.

The next section deals with the choice of multimeter to satisfy the requirements test the Zener diodes according to options one and two, so either directly measuring the output voltage or difference of a known good sample against the DUT.

\subsection{Choosing a Multimeter for Testing Zener Diodes}
The DMM used plays an important role for the test setup. In this section, some of the challenges, that can be encountered will be discussed. The expected amplitude of the popcorn noise is around \qty[per-mode=symbol]{0.5}{\micro\volt \per \volt} or \qty{3.5}{\micro\volt} of the output voltage, when considering the \qty{7}{\volt} Zener voltage of the LM399 diode.

The \qty{7}{\volt} will typically be measured on the \qty{10}{\volt} range. It is not a trivial task, because a signal-to-noise-ratio of \qty[per-mode=symbol]{0.35}{\micro\volt \per \volt} or more than \qty{130}{\decibel} is required. This calls for a device, that not only has the required resolution, but also the stability over time and temperature to ensure the measurement will not be distorted by the DMM.

Therefore, a voltmeter with lower noise and a more stable reference, than the DUT is mandatory. This only leaves the class of very low noise \num{7.5} or \num{8.5} digit multimeters. These multimeters feature a different type of voltage reference, because the LM399 is not suitable due to its noise. The only Zener diodes that meet those requirements are the Analog Devices LTZ1000 \cite{datasheet_LTZ1000}, the Motorola SZA263 (out of production) and the Linear Technology (LT) LTFLU-1, a proprietary design by Fluke and LT. The LTZ1000, for example, is specified for a typical noise of \qty{1.2}{\micro\volt_{pp}} in a frequency range of \qtyrange{0.1}{10}{\Hz} \cite{datasheet_LTZ1000}. Additionally, in comparison to the LM399, those Zener diodes do not suffer from the popcorn noise issue.

The equipment manufacturers typically have a preference for one of those diodes. Keysight utilizes the LTZ1000, Fluke uses the SZA263 (in older devices) or the LTFLU-1 in newer model, while Keithley employs the LTZ1000 in their \device{Model 2002} and the LTFLU-1 in the newer \device{DMM7510}, because they were bought by Fortive, the same company that owns Fluke. To sum it it up, Keysight uses the LTZ1000 and Fluke/Keithley the LTFLU-1 in their top end meters.

Comparing only \num{7.5} and \num{8.5} digit voltmeters, narrows down the choice of multimeters considerably. The market for high-end \num{8.5} digit DMMs is limited and therefore every device on the market caters for a certain niche. It is therefore prudent to look at their specifications to choose the correct device for this purpose. In table \ref{tab:list_of_dmms} a list of popular \num{8.5} DMMs can be found. Several models included in the table, are already discontinued, but these DMMs can still be acquired on the second-hand market.

\begin{table}[h]
    \centering
    \begin{tabular}{ |l|l|l| }
        \hline
        Manufacturer & Model & Remarks \\
        \hline
        Advantest & \device{R6581} & Discontinued. Scanner cards available. \\
        Datron/Wavetek & \device{1812} & Discontinued. Wavetek was bought by Fluke. \\
        Fluke & \device{8508A} & Discontinued. \qty{20}{\volt} range. \\
        Fluke & \device{8588A} & In production. \\
        Keithley/Tektronix & \device{2002} & In production. Scanner card available. \qty{20}{\volt} range. \\
        Keysight & \device{3458A} & In Production. \\
        Solartron & \device{7081} & Discontinued. Slow. \\
        Transmille & \device{8104} & In Production. External scanner available. Slow. \\
        \hline
    \end{tabular}
    \caption{Overview of \num{8.5} digit multimeters.}
    \label{tab:list_of_dmms}
\end{table}

While the author has not tested every multimeter in table \ref{tab:list_of_dmms}, it is possible to judge some of them apriori by their specifications. The \device{Solartron 7081} (also sold as \device{Guildline 9578}) is a less optimal choice, because a conversion takes \qty{52}{\s} for \num{8.5} digits. The discontinued \device{Fluke 8508A} and the \device{Wavetek 1812} multimeter are very similar devices, because Fluke bought Wavetek in 2000 and as a result, the \device{Fluke 8508A} is more of an update to the \device{Wavetek 1812} than a new device. They are both in included in the list, because it is very rare to see one of the Fluke devices on the second hand market, while the \device{Wavetek 1812} can be found with a bit of patience. Again they are fairly slow, taking \qty{25}{\second} for a conversion at \num{8.5} digits.

The other multimeters are still in production and similar in price, but their field of use is slightly is different. The \device{Fluke 8588A} excels at stability and features a modern user interface, whereas the \device{Keysight 3458A} is unbeaten in linearity and noise. A detailed comparison of those two meters can be found in the work of \citeauthor*{article_fluke_8588A_noise} \cite{article_fluke_8588A_noise}. The \device{Keithley Model 2002} focuses on its scanning capability and the \device{Transmille 8104} does have electrometer functions. Unfortunately, the \device{8104} is also fairly slow at \num{8.5} digit with conversions taking \qty{4}{\s} at its fastest setting \cite{datasheet_transmille8104}, so it will not be considered.

To narrow it down even further, several \num{7.5} and \num{8.5} digit multimeters were tested. The results of those tests will be discussed here to give an impression of the performance of these devices. The tested multimeters are the \device{Keysight 3458A}, the \device{Keithley Model 2002}, the \device{Keysight 34470A} and a \device{Keithley DMM6500}. The \device{3458A} was chosen, because it is very fast and already used in section \ref{} of this work. The \device{Model 2002} was chosen for its internal scanning unit. The \device{34470A} was chosen as a lower-end and cheaper alternative and because it is a fairly low noise device. Finally the \device{DMM6500} is on the list to compare a DMM with an LM399 reference. A \device{Fluke 8588A} was not tested, because it was not released at the time of testing and the older model \device{8508A} is considered too slow as mentioned above.

\minisec{The tests}

Two test were run on this selection of devices. The first one was done using a \device{Fluke 5440B} calibrator supplying \qty{10}{\volt} to all mulimeters and taking readings over the course of a week. This data was used to estimate the noise and the stability of the multimeters, including burst noise. The noise of the DMM at \qty{10}{\volt} is typically not found in the datasheet, because the noise performance is usually quoted for shorted inputs, which does not include the internal reference noise. This test allows to check for popcorn noise of the internal reference. The calibrator has a specified output noise of \qty{< 1.5}{\micro \volt} within a bandwidth of \qtyrange{0.1}{10}{\Hz} at \qty{1}{\volt} and is stable to within \qty{5}{\micro \volt_{rms}} over \qty{30}{\day}, a specification far superior to the LM399.

The second test was done using a known bad LM399 voltage reference instead of the calibrator. This test was done to see how well a DMM can make out the popcorn noise.

Based on these two tests, a multimeter was chosen for an automated test setup to bin the LM399s.

\minisec{Test Setup}

The tests were done in a stable and monitored lab environment, with a temperature deviation of at most $\Delta T = \qty{\pm 0.2}{\kelvin}$. All multimeters were connected to the same DUT. Although this might potentially cause interference between the multimeters due to the pump out current spikes caused by the switching interals, no ill effects, like voltage offsets or increased noise, were observed during the setup of the tests. A more detailed discussion of the pump out current of the \device{3458A} can be found in \cite{article_3458A_input_mpedance}.

The three \num{8.5} and \num{7.5} digit multimeters were connected using shielded cables, either Pomona 1167-60 or self-made cables. See section \ref{} for details on the self-made cables. The GUARD terminal of the calibrator was connected to chassis GROUND at the calibrator and then connected to the cable shield. On the \device{3458A}, the shield was connected to the GUARD terminal and the GUARD switch was set to open according to the manual \cite{manual_keysight3458a}. For the other multimeters, that do not have a GUARD terminal, the shield was left floating at the DMM side. Additionally the \device{Fluke 5440B}, the \device{HP 3458A} and the \device{Keysight 34470A} have an autocalibration routine, which was run once prior to the measurement. The detailed settings used for the DMMs can be found in the appendix \ref{appendix:dmm_test} on page \pageref{appendix:dmm_test}, a summary ist given in table \ref{tab:dmm_settings_concise} to show the important differences.

\begin{table}[ht]
    \centering
    \begin{tabular}{lcc}
        \toprule
        DMM& Integration time in \unit{NPLC}& Conversion time in \unit{\s}\\
        \midrule
        \device{HP 3458A}& 100 & \qty{0}{\s}\\
        \device{Keithley Model 2002} & 40& \qty{0}{\s}\\
        \device{Keysight 34470A}& 100    & \qty{0}{\s}\\
        \device{Keithley DMM6500}& 90& \qty{0}{\s}\\
        \bottomrule
    \end{tabular}
    \caption{Concise list of differences in the settings used for comparing the DMMs.}
    \label{tab:dmm_settings_concise}
\end{table}

All DMMs were configured to have a similar conversion time. This lead to different integration times, which are given in power line cycles at \qty{50}{\Hz}. The \device{Model 2002} takes considerable longer for a measurement than the Keysight multimeters. The reason is the auto-zero function, which is shown in figure \ref{fig:dmm_autozero_comparison}. The \device{Model 2002} does three steps when doing auto-zeroing, it measures the signal, the zero point for an offset compensation and also the reference voltage for a gain correction. In comparison, the \device{3458A} only corrects for the offset drift. The gain is adjusted when using the ACAL function. The former auto-zero routine, therefore takes longer by one half, but results in more stable measurements.

These measurements were done by measuring the output voltage of a pre-production version of the reference PCB for the digital current driver. The reference board was kept at \qty{23}{\celsius} in a custom thermal chamber. The chamber is detailed in section \ref{}. Additionally, a \qty{500}{\g}  bag of Bentonite desiccant was added to keep the references at a low humidity of around \qty{20}{\percent} relative humidity. The reference board inserted into a motherboard holding up to 4 reference modules. The motherboard, also called LM399 breakout board, provides the voltage regulators and the operational amplifier for the kelvin sensed pins of the reference. The multimeter was directly connected to the reference via a DB9 connector, without an other components in between the reference and the DMM like buffers, multiplexers or filters. The DMM itself was exposed to the ambient temperature of the lab. The setup is shown in figure \ref{fig:lm399_vs_34470a_setup}.

\begin{figure}[ht]
    \centering
    \resizebox {0.8\textwidth} {!} {
        \import{figures/}{34470A_vs_LM399.tex}
    } % resizebox
    \caption{Measurement setup for tesing an LM399 reference board with the \device{Keysight 34470A}}
    \label{fig:lm399_vs_34470a_setup}
\end{figure}

The reference boards amplify the Zener voltage to \qty{10}{\volt}, which improves the signal to noise ratio, because it makes use of the full DMM range. The \qty{10}{\volt} range is typically the lowest (relative) noise and lowest drift range those multimeter because no internal pre-amplifiers of attenuators are required. It is important to keep the temperature drift of the DMM low or at least predictable, because the device is exposed to the ambient laboratory and not in a temperature controlled environment like the references.

\newpage
The reference is a negative \qty{10}{\volt} reference that uses a self-biasing technique to derive its \qty{1}{\mA} Zener current from its own \qty{-10}{\volt} output. The details of this circuit are discussed in section \ref{}.

% \begin{figure}[h]
%     \centering
%     \scalebox{0.7}{%
%         \import{figures/}{lm399_reference_circuit.tex}
%     } % scalebox
%     \caption{Self-biased LM399 negative voltage reference.}
%     \label{fig:lm399_negative_10V}
% \end{figure}

With the amplified output the expected burst noise step size of about \qty[per-mode=symbol]{0.5}{\micro\volt \per \volt}, becomes \qty{5}{\micro\volt}. The resolution of the \qty{10}{\volt} range of the \device{34470A} is \qty{100}{\nano \volt}, but the measurement is not limited by quantization. See section \ref{} of this work for a detailed characterization.

\begin{figure}[ht]
    \centering
    \input{images/LM399_vs_34470A.pgf}
    \caption{Voltage deviation from the mean voltage of an LM399 negative \qty{-10}{\volt} reference measured with a Keysight 34470A at \qty{100}{\plc}.}
    \label{fig:lm399_vs_34470a}
\end{figure}

Figure \ref{fig:lm399_vs_34470a} shows an example of such measurement. This measurement highlights one the problems encountered during those measurements. From this measurement it is unclear whether the features seen in the graph are only a result of ambient temperature changes due to the cycling of the air conditioning or popcorn noise on top of that. These results hightlight the fact, that sub-\unit{ppm} measurements not only requires high-end gear, but also a very stable environment. From the data it follows, that the temperature coefficient of the DMM in linear approximation is:
\begin{equation}
    \alpha_\device{34470A} \approx \frac{\qty{6.08}{\micro\volt}-(-\qty{9.30}{\micro\volt})}{(\qty{21.85}{\celsius}-\qty{19.96}{\celsius})\qty{10}{\volt}} = \qty[per-mode=symbol]{0.86}{\micro\volt \per \volt \per \kelvin}
\end{equation}

While the temperature coeeficient is vastly better than the specified \qty[per-mode=symbol]{2}{\micro\volt \per \volt \per \kelvin} \cite{datasheet_keysight34470A}, it is not low enough for this type of measurement. The multimeter must therefore be kept in a temperature controlled environment. This issue was resolved by replacing the stock air conditioning controller with a custom PID controller as discussed in section \ref{}. Lastly, the noise floor of the measurement is \qty{1.5}{\micro\volt_{rms}}, resulting in an estimated signal-to-noise ratio (SNR) of about \qty{10}{\decibel}, which is suffient to detect the popcorn noise.

While the temperature issue was being worked on, testing of the Zener diodes continued. To work around the temperature drift of the DMM, the amplification of the reference voltage was increased to \qty{15}{\volt}, the same voltage required by the digital current driver, and a differential measurement was realized. This measurement was done against a primary \qty{15}{\volt} reference board. To ensure, that any popcorn noise found originates only in the DUT and not the primary reference used, several reference boards where tested against a \device{Fluke 5440B}. The \device{5440B} does not exhibit popcorn noise as it uses a different voltage reference ic, namely two Motorola SZA263 in series \cite{service_manual_fluke_5440b}. Finally, a board that did not show popcorn noise in a period of three days was selected. The serial number of this primary or golden reference is \textit{\#1}.

Using this differential technique, the results greatly improved

In order to test a large amount of Zener diodes, and considering the duration of the burn-in process, which can take anything between \qtyrange{100}{1000}{\hour}, it is necessary to have an automated setup. This consists of a digital multimeter (DMM) a scanner and test board, that holds the Zener diodes and provides the necessary infrastructure for the diodes.



To conclude, we need a high performance DMM, a scanner, and a test fixture. The choices will detailed in the following sections.



\subsection{A Scanner System for Testing Zener Diodes}
As discussed before the diodes need to be tested for \qty{1000}{\hour} and it is not be feasible to test them individually. So a minimum of 10 diodes must be tested at the same time. To keep the system compact, the test setup a scanner to multiplex a single multimeter input. Several commercial options currently available were considered for this project and are shown in table \ref{tab:list_of_daqs}.

\begin{table}[h]
    \centering
    \small
    \begin{tabular}{ |l|l|l|l|l|l|l|l| }
        \hline
        \multirow{2}{*}{} & \multicolumn{2}{l|}{Keysight} & \multicolumn{3}{l|}{Keithley} & Fluke & Rigol \\
        \cline{2-8}
        & DAQ973A & 34980A & DAQ6510 & 2750 & 3706 & 2680 & M300 \\
        \hline
        DMM & \num{6.5} & \num{6.5} & \num{6.5} & \num{6.5} & \num{7.5} & \qty{18}{\bit} & \num{6.5} \\
        \hline
        Channels & 3x20 & 8x40 & 2x10 & 5x20 & 6x60 & 6x20 & 5x32 \\
        \hline
        FET & \textcolor{green!60!black}{\checkmark} & \textcolor{green!60!black}{\checkmark} & \textcolor{green!60!black}{\checkmark} & \textcolor{green!60!black}{\checkmark} & \textcolor{green!60!black}{\checkmark} & \textcolor{red!80!black}{\ding{55}} & \textcolor{red!80!black}{\ding{55}} \\
        \hline
        Voltage & \qty{120}{\volt} & \qty{80}{\volt} & \qty{60}{\volt} & \qty{60}{\volt} & \qty{200}{\volt} & \qty{75}{\volt} & \qty{300}{\volt} \\
        \hline
        Card & DAQM900A & 34925A & 7710 & 7710 & 3724 & 2680A-PAI & MC3132 \\
        \hline
        USB & \textcolor{green!60!black}{\checkmark} & \textcolor{green!60!black}{\checkmark} & \textcolor{green!60!black}{\checkmark} & \textcolor{red!80!black}{\ding{55}} & \textcolor{green!60!black}{\checkmark} & \textcolor{red!80!black}{\ding{55}} & \textcolor{green!60!black}{\checkmark} \\
        \hline
        Ethernet & \textcolor{green!60!black}{\checkmark} & \textcolor{green!60!black}{\checkmark} & \textcolor{green!60!black}{\checkmark} & \textcolor{red!80!black}{\ding{55}} & \textcolor{green!60!black}{\checkmark} & \textcolor{green!60!black}{\checkmark} & \textcolor{green!60!black}{\checkmark} \\
        \hline
        GPIB & \textcolor{green!60!black}{\checkmark} & \textcolor{green!60!black}{\checkmark} & \textcolor{green!60!black}{\checkmark} & \textcolor{green!60!black}{\checkmark} & \textcolor{green!60!black}{\checkmark} & \textcolor{red!80!black}{\ding{55}} & \textcolor{green!60!black}{\checkmark} \\
        %DMM & & & & & & & \\
        \hline
    \end{tabular}
    \caption{Overview of scanner mainframes}
    \label{tab:list_of_daqs}
\end{table}

A recent trend to more compact devices has led major manufacturers to include multimeters in the scanner mainframe creating so called data acquisition units. Legacy devices, that only have switching capabilities are no available. For example Keithley replaced the small desktop switch mainframe \device{Model 7001} with the \device{DAQ6510} and Keysight is offering the \device{DAQ973A}, a scanning \num{6.5} digit DMM, that accepts extension cards. Unfortunately, for this project, as discussed above, the integrated \num{6.5} digit multimeter does not add any value.

The simplest option is to go with an \num{8.5} digit multimeter that already included a scanner option or buy a used \device{Keithley 7001} from a second-hand dealer. The author has tested both options and the simplicity of only having a single device to connect and program makes the integrated scanner card of the \device{Model 2002} very attractive.

\begin{figure}[ht]
    \centering
    \scalebox{0.7}{%
        \import{figures/}{simplified_scanner.tex}
    } % scalebox
    \caption{Simplified schematic of the scanner front-end with parasitic elements}
\end{figure}

The scanner card used to multiplex the DMM does have to meet several specifications. The most important aspects are the number channels and the lifetime of the relays. Other factors, such as channel to channel isolation, the contact potential, resistance and maximum voltage is not the limiting factor.

The reason is, that in this case, the voltage is low, there is no ac component involved and the the typical input impedance of high-end multimeters is far more than \qty{100}{\giga\ohm} \cite{datasheet_fluke8588A,article_3458A_input_mpedance_2,datasheet_keithley2002,article_3458A_input_mpedance}.

In this work the Keithley (now Tektronix) \device{Model 2002} was chosen for three reasons. It is a very compact system requiring only a half-sized 2U rack in comparison to the other DMMs, that are typically full-sized 2U rack devices. The other two advantages are the integrated scanner card slot, that allows to to fit a 10 channel scanner card and finally the \qty{20}{\volt} range. The latter is interesting for testing the final voltage reference boards, as these have a \qty{15}{\volt} output, which is too much for the \qty{10}{\volt} range of most DMMs, so that testing the voltage reference Printed circuit boards
(PCBs) one would have to switch to the \qty{100}{\volt} range and forgo an extra digit of resolution and add more noise.

The test setup consists of a mounting PCB, that holds up to 20 Zener diode. It provides power regulation and a minimal circuit required to support each diode. This circuit is given here:

\begin{figure}[ht]
    \centering
    \scalebox{0.7}{%
        \import{figures/}{zener_burnin.tex}
    } % scalebox
    \caption{Circuit used for burning in the Zener diodes}
\end{figure}

The compensation network is required when using the ADR1399, because of its very low dynamic impedance as recommended in the data sheet \cite{datasheet_ADR1399}. It is not strictly required for the LM399, but fitted nonetheless, because there are no downsides to it. This makes the board compatible with both types of references. Each Zener output is protected using an output buffer, which provides isolation and short circuit protection. Finally there is a common mode filter at the output to suppress high frequency noise via ground loops.

The two key metrics of concern, that need to measured are popcorn noise and drift.

digital multimeter and a scanner card


\begin{figure}[ht]
    \centering
    \import{figures/}{DIN_41612.tex}
    \caption{The extension connector used in several Keithley multimeters}
\end{figure}

\begin{table}[ht]
    \centering
    \begin{tabular}{llllll}
        \toprule
        Pin    & Function    & Cable Colour    & Pin    & Function    &  Cable Colour\\
        \midrule
        a1, b1    & \SIrange[print-implicit-plus=true]{6}{20}{\volt}    & brown    & \num{6}    & GND    & green/white\\
        a2, b2    & PD cathode    & red    & \num{7}    & LD Cathode    & blue/white\\
        a3, b3    & LD case (GND)    & red/white    & \num{8}    & LD Anode    & blue\\
        a4    & PD anode (GND)    & red/white    & \num{9}    & LD current    & green\\
        a5    & \SIrange{-6}{-20}{\volt}    & brown/white\\
        \bottomrule
    \end{tabular}
\end{table}

As a sidenote, for the pure entertainment of the author, several batches of LM399 Zener diodes were purchased from non-authorized dealers. Some were marked as refurbished, the others were not marked as such, but clearly were. These so-called refurbished diodes are not to be used in production devices. To entertain and warn the reader a small selection of examples are shown here in figure \ref{fig:fake_lm399}. All but one diode, which is shown for comparison, are refurbished.

\begin{figure}[h]
    \centering
    %\includegraphics[width=0.75\textwidth]{images/foo.png}
    \caption{Refurbished LM399 Zener diodes. From left to right: }
    \label{fig:fake_lm399}
\end{figure}

As it can be clearly seen, the sellers have gone to some effort to hide the fact, that these diodes have been used before. When a through-hole is soldered to the PCB, its legs will be trimmed to match the PCB thickness. In order to conceal this, the legs need to be extended to their original length. The legs of the LM399 are Kovar, because the LM399 is hermetically sealed with a glass seal and Kovar has the same coefficient of expansion as borosilicate glass. The forgers typically weld steel legs to the Kovar legs and then either gold-plate or tin them, as can be seen in fig. \ref{fig:fake_lm399_legs}.

\begin{figure}[h]
    \centering
    %\includegraphics[width=0.75\textwidth]{images/foo.png}
    \caption{Fake steel legs of a refurbished LM399.}
    \label{fig:fake_lm399_legs}
\end{figure}

Much to the delight of the author the refurbished diodes prove valuable for educational purposes. As the origin and method of extraction from the original circuit is unknown, but can be imagined to be rather savage, the diodes are typically faulty. They can therefore be used to validate the test setup and demonstrate the popcorn noise found in the LM399. A very good example in shown in fig. \ref{fig:fake_lm399_popcorn_noise}.

\begin{figure}[h]
    \centering
    \input{images/refurb_lm399_popcorn_noise.pgf}
    \caption{Popcorn noise of a refurbished LM399 (\#15) over a period of \qty{15}{\minute}.}
    \label{fig:fake_lm399_popcorn_noise}
\end{figure}

TODO: Chinese/Ebay Zeners. Welded legs. Photots. Decap one of those.

%\begin{figure}[h]
%    \centering
    %\import{figures/}{dgDrive_protocol.tex}
%\end{figure}

%\subsection{Current Sources}
%Discuss Op amp choice (AD797)

%\subsection{Temperature Coeeficient}
%Discuss each section (Reference, DAC, Buffer/Divider, Filter, CC)
%\subsubsection{Voltage Reference}
%\subsubsection{DAC}
%\subsubsection{Divider}
%\subsubsection{Filter}
%Choice of components. Leakage current, size of resistor (input bias current of AD797), size of capacitor
